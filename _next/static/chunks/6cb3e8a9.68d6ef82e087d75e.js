"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[632],{19497:function(t,e,i){i.d(e,{$N:function(){return il},S$:function(){return tN},Vy:function(){return tE},fx:function(){return tP},qm:function(){return tA}});var r,s,n,o,a,l=i(58657),d=i(36582),c=i(91813),h=i(6216),u=i(88137),g=i(31379),p=i(81014),m=i(81092),v=i(1458),f=i(37808),y=i(29818),b=i(97225),_=i(24451),O=i(17788),w=i(91179),P=i(63791),A=i(72467),E=i(92955),S=i(96141),R=i(48614),x=i(46),I=i(74294),N=i(47647),k=i(27104),L=i(5042),C=i(33627),T=i(68074),D=i(45698),M=i(99299),j=i(69887),B=i(73743),H=i(17282),G=i(89793),F=i(58619),U=i(25525),Q=i(81571),V=i(1216),K=i(28240),z=i(33075),Z=i(75410),Y=i(22840),W=i(36160),X=i(23914);function J(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&0>e.indexOf(r)&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)0>e.indexOf(r[s])&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(i[r[s]]=t[r[s]]);return i}function $(t,e,i,r){return new(i||(i=Promise))(function(s,n){function o(t){try{l(r.next(t))}catch(t){n(t)}}function a(t){try{l(r.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?s(t.value):((e=t.value)instanceof i?e:new i(function(t){t(e)})).then(o,a)}l((r=r.apply(t,e||[])).next())})}function q(t,e,i,r){if("a"===i&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(t):r?r.value:e.get(t)}function tt(t,e,i,r,s){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!s)throw TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!s:!e.has(t))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(t,i):s?s.value=i:e.set(t,i),i}"function"==typeof SuppressedError&&SuppressedError;class te{inject(t){return $(this,void 0,void 0,function*(){let e;try{e=yield this.context.rpc.injectOperation(t)}catch(e){let t=". You may want to use --replace to provide adequate fee and replace it";if(e instanceof d.mk&&e.message.includes(t))throw function(t,e){let i=JSON.parse(t.body);if(!i[0]||!i[0].kind||!i[0].msg)return t;{let r=JSON.stringify({kind:i[0].kind,id:i[0].id,msg:i[0].msg.replace(e,"")});return new d.mk("Http error response: (".concat(t.status,") ").concat(r),t.status,t.statusText,r,t.url)}}(e,t);throw e}return e})}constructor(t){this.context=t}}class ti extends c.rJ{constructor(){super(),this.name="UnconfiguredSignerError",this.message="No signer has been configured. Please configure one by calling setProvider({signer}) on your TezosToolkit instance."}}class tr{publicKey(){return $(this,void 0,void 0,function*(){throw new ti})}publicKeyHash(){return $(this,void 0,void 0,function*(){throw new ti})}secretKey(){return $(this,void 0,void 0,function*(){throw new ti})}sign(t,e){return $(this,void 0,void 0,function*(){throw new ti})}}function ts(t){return new h.y(e=>(t.on("data",t=>{e.next(t)}),t.on("error",t=>{e.error(t)}),t.on("close",()=>{e.complete()}),()=>{t.close()}))}let tn={TZ1:169,TZ2:155,TZ3:445,TZ4:1674},to={TZ1:276,TZ2:276,TZ3:305,TZ4:477};(r=n||(n={})).Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",r.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",r.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",r.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",r.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",r.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",r.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",r.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",r.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",r.PsiThaCa="PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP",r.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",r.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",r.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",r.PtLimaPtL="PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW",r.PtMumbaii="PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc",r.PtMumbai2="PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1",r.PtNairobi="PtNairobiyssHuh87hEhfVBGCVrK3WnS8Z2FT4ymB5tAa4r1nQf",r.ProxfordY="ProxfordYmVfjWnRcgjWH36fW6PArwqykTFzotUxRs6gmTcZDuH",r.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK",n.Pt24m4xi,n.PsBABY5H,n.PsBabyM1,n.PsCARTHA,n.PsDELPH1,n.PtEdo2Zk,n.PsFLorena,n.PtGRANADs,n.PtHangz2,n.PsiThaCa,n.Psithaca2,n.PtJakart2,n.PtKathman,n.PtLimaPtL,n.PtMumbai2,n.PtNairobi,n.ProxfordY,n.ProtoALpha,(s=o||(o={})).MAINNET="NetXdQprcVkpaWU",s.CARTHAGENET="NetXjD3HPJJjmcd",s.DELPHINET="NetXm8tYqnMWky1",s.EDONET="NetXSgo1ZT2DRUG",s.FLORENCENET="NetXxkAx4woPLyu",s.GRANADANET="NetXz969SFaFn8k",s.HANGZHOUNET="NetXZSsxBpMQeAT",s.ITHACANET="NetXbhmtAbMukLc",s.ITHACANET2="NetXnHfVqm9iesp",s.JAKARTANET2="NetXLH1uAxK7CCh",s.KATHMANDUNET="NetXazhm4yetmff",s.LIMANET="NetXizpkH94bocH",s.MUMBAINET="NetXQw6nWSnrJ5t",s.MUMBAINET2="NetXgbcrNtXD2yA",s.NAIROBINET="NetXyuzvDo2Ugzb",s.OXFORDNET2="NetXxWsskGahzQB";let ta=t=>Math.round(37*tl(t)/10),tl=t=>{switch(t.substring(0,3)){case"tz1":return tn.TZ1;case"tz2":return tn.TZ2;case"tz3":return tn.TZ3;case"tz4":return tn.TZ4;default:throw Error("Cannot estimate reveal gas limit for ".concat(t))}},td=t=>Math.round(12*tc(t)/10),tc=t=>{switch(t.substring(0,3)){case"tz1":return to.TZ1;case"tz2":return to.TZ2;case"tz3":return to.TZ3;case"tz4":return to.TZ4;default:throw Error("Cannot estimate reveal fee for ".concat(t))}};class th extends c.Yy{constructor(t,e,i){super(),this.smartContractMethodName=t,this.sigs=e,this.invalidParams=i,this.name="InvalidParameterError",this.message="".concat(t," Received ").concat(i.length," arguments while expecting one of the following signatures (").concat(JSON.stringify(e),")")}}class tu extends c.Yy{constructor(t){super(),this.source=t,this.name="InvalidDelegationSource",this.message="Since Babylon delegation source can no longer be a contract address ".concat(t,". Please use the smart contract abstraction to set your delegate.")}}class tg extends c.Yy{constructor(t,e){super(),this.message=t,this.data=e,this.name="InvalidCodeParameter"}}class tp extends c.Yy{constructor(t,e){super(),this.message=t,this.data=e,this.name="InvalidInitParameter"}}class tm extends c.lt{constructor(t,e,i,r){super(),this.message=t,this.viewName=e,this.failWith=i,this.cause=r,this.name="ViewSimulationError"}}let tv=t=>{if(tf(t.body)){let e=JSON.parse(t.body);if(Array.isArray(e)&&"with"in e[e.length-1])return e[e.length-1].with}},tf=t=>{try{JSON.parse(t)}catch(t){return!1}return!0};class ty extends c.Yy{constructor(t){super(),this.info=t,this.name="InvalidViewSimulationContext",this.message="".concat(t," Please configure the context of the view execution in the executeView method.")}}class tb extends c.lt{constructor(t){super(),this.message=t,this.name="RevealOperationError"}}class t_ extends c.Yy{constructor(t){super(),this.message=t,this.name}}class tO extends c.Yy{constructor(t){super(),this.message=t,this.name="InvalidBalanceError"}}let tw=t=>{let{pkh:e,secret:i}=t;return $(void 0,void 0,void 0,function*(){return{kind:l.Qg.ACTIVATION,pkh:e,secret:i}})},tP=t=>{let{code:e,init:i,balance:r="0",delegate:s,storage:n,fee:o,gasLimit:a,storageLimit:d,mutez:c=!1}=t;return $(void 0,void 0,void 0,function*(){let t;if(void 0!==n&&void 0!==i)throw new t_("Storage and Init cannot be set a the same time. Please either use storage or init but not both.");if(!Array.isArray(e))throw new tg("Wrong code parameter type, expected an array",e);if(void 0!==n){let i=e.find(t=>"prim"in t&&"storage"===t.prim);if((null==i?void 0:i.args)===void 0)throw new tg("The storage section is missing from the script",e);t=new z.V_(i.args[0]).Encode(n)}else if(void 0!==i&&"object"==typeof i)t=i;else throw new tp("Wrong init parameter type, expected JSON Michelson",i);let h={code:e,storage:t};if(isNaN(Number(r)))throw new tO('Invalid Balance "'.concat(r,'", cannot be converted to a number'));let u={kind:l.Qg.ORIGINATION,fee:o,gas_limit:a,storage_limit:d,balance:c?r.toString():(0,Z.WU)("tz","mutez",r).toString(),script:h};return s&&(u.delegate=s),u})},tA=t=>{let{to:e,amount:i,parameter:r,fee:s,gasLimit:n,storageLimit:o,mutez:a=!1}=t;return $(void 0,void 0,void 0,function*(){return{kind:l.Qg.TRANSACTION,fee:s,gas_limit:n,storage_limit:o,amount:a?i.toString():(0,Z.WU)("tz","mutez",i).toString(),destination:e,parameters:r}})},tE=t=>{let{delegate:e,source:i,fee:r,gasLimit:s,storageLimit:n}=t;return $(void 0,void 0,void 0,function*(){return{kind:l.Qg.DELEGATION,source:i,fee:r,gas_limit:s,storage_limit:n,delegate:e}})},tS=(t,e)=>{let{fee:i,gasLimit:r,storageLimit:s}=t;return $(void 0,void 0,void 0,function*(){return{kind:l.Qg.DELEGATION,fee:i,gas_limit:r,storage_limit:s,delegate:e}})},tR=(t,e,i)=>{let{fee:r,gasLimit:s,storageLimit:n}=t;return $(void 0,void 0,void 0,function*(){return{kind:l.Qg.REVEAL,fee:r,public_key:i,source:e,gas_limit:null!=s?s:ta(e),storage_limit:n}})},tx=t=>{let{value:e,source:i,fee:r,gasLimit:s,storageLimit:n}=t;return $(void 0,void 0,void 0,function*(){return{kind:l.Qg.REGISTER_GLOBAL_CONSTANT,value:e,fee:r,gas_limit:s,storage_limit:n,source:i}})},tI=t=>{let{ticketContents:e,ticketTy:i,ticketTicketer:r,ticketAmount:s,destination:n,entrypoint:o,source:a,fee:d,gasLimit:c,storageLimit:h}=t;return $(void 0,void 0,void 0,function*(){return{kind:l.Qg.TRANSFER_TICKET,fee:d,gas_limit:c,storage_limit:h,source:a,ticket_contents:e,ticket_ty:i,ticket_ticketer:r,ticket_amount:s,destination:n,entrypoint:o}})},tN=t=>{let{source:e,fee:i,gasLimit:r,storageLimit:s,amount:n,destination:o}=t;return $(void 0,void 0,void 0,function*(){return{kind:l.Qg.INCREASE_PAID_STORAGE,source:e,fee:i,gas_limit:r,storage_limit:s,amount:n,destination:o}})},tk=t=>{let{consensus_key:e,delegate:i,destination:r}=t;return $(void 0,void 0,void 0,function*(){return{kind:l.Qg.DRAIN_DELEGATE,consensus_key:e,delegate:i,destination:r}})},tL=t=>{let{source:e,proposal:i,ballot:r}=t;return $(void 0,void 0,void 0,function*(){return{kind:l.Qg.BALLOT,source:e,proposal:i,ballot:r}})},tC=t=>{let{source:e,proposals:i}=t;return $(void 0,void 0,void 0,function*(){return{kind:l.Qg.PROPOSALS,source:e,proposals:i}})},tT=t=>{let{source:e,fee:i,gasLimit:r,storageLimit:s,pk:n}=t;return $(void 0,void 0,void 0,function*(){return{kind:l.Qg.UPDATE_CONSENSUS_KEY,source:e,fee:i,gas_limit:r,storage_limit:s,pk:n}})},tD=t=>{let{source:e,fee:i,gasLimit:r,storageLimit:s,message:n}=t;return $(void 0,void 0,void 0,function*(){return{kind:l.Qg.SMART_ROLLUP_ADD_MESSAGES,source:e,fee:i,gas_limit:r,storage_limit:s,message:n}})},tM=t=>{let{source:e,fee:i,gasLimit:r,storageLimit:s,pvmKind:n,kernel:o,parametersType:a}=t;return $(void 0,void 0,void 0,function*(){return{kind:l.Qg.SMART_ROLLUP_ORIGINATE,source:e,fee:i,gas_limit:r,storage_limit:s,pvm_kind:n,kernel:o,parameters_ty:a}})},tj=t=>{let{source:e,fee:i,gasLimit:r,storageLimit:s,rollup:n,cementedCommitment:o,outputProof:a}=t;return $(void 0,void 0,void 0,function*(){return{kind:l.Qg.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE,source:e,fee:i,gas_limit:r,storage_limit:s,rollup:n,cemented_commitment:o,output_proof:a}})},tB=(t,e)=>Object.assign(Object.assign({},t),{kind:e}),tH=(t,e)=>{if(Array.isArray(t)){let i=t.find(t=>t.kind===e);if(i&&tG(i,e))return i}},tG=(t,e)=>t.kind===e,tF=t=>t.kind===l.Qg.TRANSACTION&&!!t.parameters||-1!==["origination","register_global_constant","transfer_ticket","update_consensus_key","smart_rollup_add_messages","smart_rollup_originate"].indexOf(t.kind),tU=t=>-1!==["transaction","delegation","origination","reveal","register_global_constant","increase_paid_storage","transfer_ticket","update_consensus_key","smart_rollup_add_messages","smart_rollup_originate","smart_rollup_execute_outbox_message"].indexOf(t.kind),tQ=t=>-1!==["transaction","delegation","origination","register_global_constant","increase_paid_storage","transfer_ticket","update_consensus_key","smart_rollup_add_messages","smart_rollup_originate","smart_rollup_execute_outbox_message"].indexOf(t.kind),tV=t=>"metadata"in t,tK=t=>tV(t)&&"operation_result"in t.metadata,tz=t=>tV(t)&&"internal_operation_results"in t.metadata,tZ=t=>"with"in t;class tY extends c.lt{get id(){return this.lastError.id}get kind(){return this.lastError.kind}constructor(t,e,i){super(),this.errors=t,this.errorDetails=e,this.operationsWithResults=i,this.name="TezosOperationError",this.lastError=t[t.length-1],this.message="(".concat(this.kind,") ").concat(this.id),tZ(this.lastError)&&(this.lastError.with.string?this.message=this.lastError.with.string:this.lastError.with.int?this.message=this.lastError.with.int:this.message=JSON.stringify(this.lastError.with))}}class tW extends Error{constructor(t){super(),this.result=t,this.name="TezosPreapplyFailureError",this.message="Preapply returned an unexpected result"}}let tX=t=>{let e=Array.isArray(t)?t:[t],i=[];for(let t=0;t<e.length;t++)for(let r=0;r<e[t].contents.length;r++){let s=e[t].contents[r];tK(s)&&"fee"in s&&(i.push(Object.assign({fee:s.fee},s.metadata.operation_result)),Array.isArray(s.metadata.internal_operation_results)&&s.metadata.internal_operation_results.forEach(t=>i.push(t.result)))}return i},tJ=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"failed",i=Array.isArray(t)?t:[t],r=[];for(let t=0;t<i.length;t++)for(let s=0;s<i[t].contents.length;s++){let n=i[t].contents[s];if(tV(n)&&(tK(n)&&n.metadata.operation_result.status===e&&(r=r.concat(n.metadata.operation_result.errors||[])),tz(n)&&Array.isArray(n.metadata.internal_operation_results)))for(let t of n.metadata.internal_operation_results)"result"in t&&t.result.status===e&&(r=r.concat(t.result.errors||[]))}return r};class t$ extends c.WO{constructor(t){super(),this.message=t,this.name="OriginationOperationError"}}class tq extends c.Yy{constructor(t){super(),this.message=t,this.name="InvalidEstimateValueError"}}class t0 extends c.Yy{constructor(t){super(),this.invalidConfirmations=t,this.name="InvalidConfirmationCountError",this.message="Invalid confirmation count ".concat(t," expecting at least 1")}}class t1 extends c.F7{constructor(t){super(),this.message=t,this.name="ConfirmationTimeoutError"}}class t2 extends c.lt{constructor(t,e){super(),this.message=t,this.cause=e,this.name="RPCResponseError"}}class t4{get includedInBlock(){return this._foundAt}get revealOperation(){return Array.isArray(this.results)&&this.results.find(t=>"reveal"===t.kind)}get revealStatus(){return this.revealOperation?this.revealOperation.metadata.operation_result.status:"unknown"}get status(){return this.results.map(t=>tK(t)?t.metadata.operation_result.status:"unknown")[0]||"unknown"}confirmation(t,e){return $(this,void 0,void 0,function*(){if(void 0!==t&&t<1)throw new t0(t);let{defaultConfirmationCount:i,confirmationPollingTimeoutSecond:r}=this.context.config;this._pollingConfig$.next({timeout:e||r});let s=void 0!==t?t:i;return new Promise((t,e)=>{this.confirmed$.pipe((0,E.w)(()=>this.currentHead$),(0,S.h)(t=>t.header.level-this._foundAt>=s-1),(0,R.P)()).subscribe({error:t=>e(t),complete:()=>t(this._foundAt+(s-1))})})})}constructor(t,e,i,r){if(this.hash=t,this.raw=e,this.results=i,this.context=r,this._pollingConfig$=new u.t(1),this.currentHead$=this._pollingConfig$.pipe((0,E.w)(t=>new g.X(t).pipe((0,x.V)({each:1e3*t.timeout,with:()=>(0,p._)(()=>new t1("Confirmation polling timed out"))}))),(0,E.w)(()=>(0,m.P)(()=>ts(this.context.stream.subscribeBlock("head"))).pipe((0,E.w)(t=>{var e,i;let r=null!==(i=null===(e=this.lastHead)||void 0===e?void 0:e.header.level)&&void 0!==i?i:t.header.level-1;return(0,v.w)(r+1,t.header.level-r-1).pipe((0,I.b)(t=>this.context.readProvider.getBlock(t)),(0,N.l)(t))}),(0,k.b)(t=>this.lastHead=t))),(0,L.d)({refCount:!0})),this.confirmed$=this.currentHead$.pipe((0,C.U)(t=>{for(let e=3;e>=0;e--)t.operations[e].forEach(e=>{e.hash===this.hash&&(this._foundAt=t.header.level)});if(t.header.level-this._foundAt>=0)return this._foundAt}),(0,S.h)(t=>void 0!==t),(0,R.P)(),(0,L.d)()),this._foundAt=Number.POSITIVE_INFINITY,(0,Z.Ak)(this.hash)!==Z.nd.VALID)throw new c.e5(this.hash);this.confirmed$.pipe((0,R.P)(),(0,T.K)(()=>(0,f.of)(y.E))).subscribe()}}class t3 extends t4{sumProp(t,e){return t.reduce((t,i)=>e in i?Number(i[e])+t:t,0)}getOriginatedContractAddresses(){let t=this.results.filter(t=>"origination"===t.kind),e=[];for(let i of t)i.metadata.operation_result.originated_contracts&&(e=[...e,...i.metadata.operation_result.originated_contracts]);return e}get status(){return this.results.filter(t=>-1!==e_.indexOf(t.kind)).map(t=>tK(t)?t.metadata.operation_result.status:"unknown")[0]||"unknown"}get fee(){return this.sumProp(this.params,"fee")}get gasLimit(){return this.sumProp(this.params,"gas_limit")}get storageLimit(){return this.sumProp(this.params,"storage_limit")}get consumedGas(){return Y.Z.config({DECIMAL_PLACES:0,ROUNDING_MODE:Y.Z.ROUND_UP}),new Y.Z(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(tX({contents:this.results}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(tX({contents:this.results}),"paid_storage_size_diff"))}get errors(){return tJ({contents:this.results})}constructor(t,e,i,r,s,n){super(t,r,s,n),this.params=e,this.source=i}}class t7{get rpc(){return this.context.rpc}get signer(){return this.context.signer}forge(t){let{opOb:{branch:e,contents:i,protocol:r},counter:s}=t;return $(this,void 0,void 0,function*(){return{opbytes:yield this.context.forger.forge({branch:e,contents:i}),opOb:{branch:e,contents:i,protocol:r},counter:s}})}estimate(t,e){var{fee:i,gasLimit:r,storageLimit:s}=t,n=J(t,["fee","gasLimit","storageLimit"]);return $(this,void 0,void 0,function*(){let t=i,o=r,a=s;if(t&&t%1!=0)throw new tq("Fee value must not be a decimal: ".concat(t));if(o&&o%1!=0)throw new tq("Gas Limit value must not be a decimal: ".concat(o));if(a&&a%1!=0)throw new tq("Storage Limit value must not be a decimal: ".concat(a));if(void 0===i||void 0===r||void 0===s){let l=yield e(Object.assign({fee:i,gasLimit:r,storageLimit:s},n));null!=t||(t=l.suggestedFeeMutez),null!=o||(o=l.gasLimit),null!=a||(a=l.storageLimit)}return{fee:t,gasLimit:o,storageLimit:a}})}getRPCOp(t){return $(this,void 0,void 0,function*(){switch(t.kind){case l.Qg.TRANSACTION:return tA(Object.assign({},t));case l.Qg.ORIGINATION:return tP((yield this.context.parser.prepareCodeOrigination(Object.assign({},t))));case l.Qg.DELEGATION:return tE(Object.assign({},t));case l.Qg.REGISTER_GLOBAL_CONSTANT:return tx(Object.assign({},t));case l.Qg.INCREASE_PAID_STORAGE:return tN(Object.assign({},t));case l.Qg.TRANSFER_TICKET:return tI(Object.assign({},t));case l.Qg.SMART_ROLLUP_ADD_MESSAGES:return tD(Object.assign({},t));case l.Qg.SMART_ROLLUP_ORIGINATE:return tM(Object.assign({},t));case l.Qg.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE:return tj(Object.assign({},t));default:throw new Z.p(t.kind)}})}runOperation(t){return $(this,void 0,void 0,function*(){return{opResponse:yield this.rpc.runOperation(t),op:t,context:this.context.clone()}})}simulate(t){return $(this,void 0,void 0,function*(){return{opResponse:yield this.rpc.simulateOperation(t),op:t,context:this.context.clone()}})}isRevealOpNeeded(t,e){return $(this,void 0,void 0,function*(){return!!((yield this.isAccountRevealRequired(e))&&this.isRevealRequiredForOpType(t))})}isAccountRevealRequired(t){return $(this,void 0,void 0,function*(){return!(yield this.context.readProvider.isAccountRevealed(t,"head"))})}isRevealRequiredForOpType(t){let e=!1;for(let i of t)tQ(i)&&(e=!0);return e}signAndInject(t){return $(this,void 0,void 0,function*(){let e=yield this.signer.sign(t.opbytes,new Uint8Array([3]));t.opbytes=e.sbytes,t.opOb.signature=e.prefixSig;let i=[],r=yield this.rpc.preapplyOperations([t.opOb]);if(!Array.isArray(r))throw new tW(r);for(let t=0;t<r.length;t++)for(let e=0;e<r[t].contents.length;e++)i.push(r[t].contents[e]);let s=tJ(r);if(s.length)throw new tY(s,"Error occurred during validation simulation of operation",i);return{hash:yield this.context.injector.inject(t.opbytes),forgedBytes:t,opResponse:i,context:this.context.clone()}})}constructor(t){this.context=t}}class t8{withTransfer(t){let e=(0,Z.YN)(t.to);if(e!==Z.nd.VALID)throw new c.bS(t.to,(0,Z.f4)(e));return this.operations.push(Object.assign({kind:l.Qg.TRANSACTION},t)),this}withContractCall(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.withTransfer(t.toTransferParams(e))}withDelegation(t){var e;let i=(0,Z.YN)(null!==(e=t.delegate)&&void 0!==e?e:"");if(t.delegate&&i!==Z.nd.VALID)throw new c.bS(t.delegate,(0,Z.f4)(i));return this.operations.push(Object.assign({kind:l.Qg.DELEGATION},t)),this}withOrigination(t){return this.operations.push(Object.assign({kind:l.Qg.ORIGINATION},t)),this}withIncreasePaidStorage(t){let e=(0,Z.YN)(t.destination);if(e!==Z.nd.VALID)throw new c.bS(t.destination,(0,Z.f4)(e));return this.operations.push(Object.assign({kind:l.Qg.INCREASE_PAID_STORAGE},t)),this}mapOperation(t){return $(this,void 0,void 0,function*(){switch(t.kind){case l.Qg.TRANSACTION:return this.walletProvider.mapTransferParamsToWalletParams(()=>$(this,void 0,void 0,function*(){return t}));case l.Qg.ORIGINATION:return this.walletProvider.mapOriginateParamsToWalletParams(()=>$(this,void 0,void 0,function*(){return this.context.parser.prepareCodeOrigination(Object.assign({},t))}));case l.Qg.DELEGATION:return this.walletProvider.mapDelegateParamsToWalletParams(()=>$(this,void 0,void 0,function*(){return t}));case l.Qg.INCREASE_PAID_STORAGE:return this.walletProvider.mapIncreasePaidStorageWalletParams(()=>$(this,void 0,void 0,function*(){return t}));default:throw new c.p(JSON.stringify(t.kind))}})}with(t){for(let e of t)switch(e.kind){case l.Qg.TRANSACTION:this.withTransfer(e);break;case l.Qg.ORIGINATION:this.withOrigination(e);break;case l.Qg.DELEGATION:this.withDelegation(e);break;case l.Qg.INCREASE_PAID_STORAGE:this.withIncreasePaidStorage(e);break;default:throw new c.p(JSON.stringify(e.kind))}return this}send(){return $(this,void 0,void 0,function*(){let t=[];for(let e of this.operations)t.push((yield this.mapOperation(e)));let e=yield this.walletProvider.sendOperations(t);return this.context.operationFactory.createBatchOperation(e)})}constructor(t,e){this.walletProvider=t,this.context=e,this.operations=[]}}class t5{get walletProvider(){return this.context.walletProvider}pkh(){let{forceRefetch:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return $(this,void 0,void 0,function*(){return(!this._pkh||t)&&(this._pkh=yield this.walletProvider.getPKH()),this._pkh})}pk(){let{forceRefetch:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return $(this,void 0,void 0,function*(){return(!this._pk||t)&&(this._pk=yield this.walletProvider.getPK()),this._pk})}originate(t){return this.walletCommand(()=>$(this,void 0,void 0,function*(){let e=yield this.walletProvider.mapOriginateParamsToWalletParams(()=>this.context.parser.prepareCodeOrigination(Object.assign({},t))),i=yield this.walletProvider.sendOperations([e]);return this.context.operationFactory.createOriginationOperation(i)}))}setDelegate(t){var e;let i=(0,Z.YN)(null!==(e=t.delegate)&&void 0!==e?e:"");if(t.delegate&&i!==Z.nd.VALID)throw new c.bS(t.delegate,(0,Z.f4)(i));return this.walletCommand(()=>$(this,void 0,void 0,function*(){let e=yield this.walletProvider.mapDelegateParamsToWalletParams(()=>$(this,void 0,void 0,function*(){return t})),i=yield this.walletProvider.sendOperations([e]);return this.context.operationFactory.createDelegationOperation(i)}))}signFailingNoop(t){return $(this,void 0,void 0,function*(){let e={kind:l.Qg.FAILING_NOOP,arbitrary:t.arbitrary},i=yield this.context.readProvider.getBlockHash(t.basedOnBlock),r=yield this.context.forger.forge({branch:i,contents:[e]});return{signature:yield this.walletProvider.sign(r,Uint8Array.from([3])),bytes:r,signedContent:{branch:i,contents:[{kind:l.Qg.FAILING_NOOP,arbitrary:t.arbitrary}]}}})}registerDelegate(){return this.walletCommand(()=>$(this,void 0,void 0,function*(){let t=yield this.walletProvider.mapDelegateParamsToWalletParams(()=>$(this,void 0,void 0,function*(){return{delegate:yield this.pkh()}})),e=yield this.walletProvider.sendOperations([t]);return this.context.operationFactory.createDelegationOperation(e)}))}transfer(t){let e=(0,Z.YN)(t.to);if(e!==Z.nd.VALID)throw new c.bS(t.to,(0,Z.f4)(e));return this.walletCommand(()=>$(this,void 0,void 0,function*(){let e=yield this.walletProvider.mapTransferParamsToWalletParams(()=>$(this,void 0,void 0,function*(){return t})),i=yield this.walletProvider.sendOperations([e]);return this.context.operationFactory.createTransactionOperation(i)}))}increasePaidStorage(t){let e=(0,Z.YN)(t.destination);if(e!==Z.nd.VALID)throw new c.bS(t.destination,(0,Z.f4)(e));return this.walletCommand(()=>$(this,void 0,void 0,function*(){let e=yield this.walletProvider.mapIncreasePaidStorageWalletParams(()=>$(this,void 0,void 0,function*(){return t})),i=yield this.walletProvider.sendOperations([e]);return this.context.operationFactory.createIncreasePaidStorageOperation(i)}))}batch(t){let e=new t8(this.walletProvider,this.context);return Array.isArray(t)&&e.with(t),e}at(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t=>t;return $(this,void 0,void 0,function*(){let i=(0,Z.rY)(t);if(i!==Z.nd.VALID)throw new c.JH(t,(0,Z.f4)(i));let r=this.context.withExtensions().rpc,s=this.context.withExtensions().readProvider,n=yield s.getScript(t,"head"),o=yield s.getEntrypoints(t);return e(new ep(t,n,this,this.context.contract,o,r,s),this.context)})}getPK(){return $(this,void 0,void 0,function*(){return yield this.pk()})}constructor(t){this.context=t,this.walletCommand=t=>({send:t})}}let t9=function(t){let{ALLOCATION_BURN:e,ORIGINATION_BURN:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ALLOCATION_BURN:257,ORIGINATION_BURN:257};Y.Z.config({DECIMAL_PLACES:0,ROUNDING_MODE:Y.Z.ROUND_UP});let r=tX({contents:t}),s=new Y.Z(0),n=new Y.Z(0),o=new Y.Z(0),a=new Y.Z(0),l=new Y.Z(0),d=new Y.Z(0);return r.forEach(t=>{o=o.plus(t.fee||0),a=a.plus(Array.isArray(t.originated_contracts)?t.originated_contracts.length*i:0),l=l.plus("allocated_destination_contract"in t?e:0),s=s.plus(t.consumed_milligas||0),d=d.plus("paid_storage_size_diff"in t&&Number(t.paid_storage_size_diff)||0)}),n=n.plus(l).plus(a).plus(d),{totalFee:o,totalMilliGas:s,totalGas:s.dividedBy(1e3),totalStorage:n,totalAllocationBurn:l,totalOriginationBurn:a,totalPaidStorageDiff:d,totalStorageBurn:new Y.Z(n.multipliedBy(250))}};class t6 extends c.rJ{constructor(){super(),this.name="ConfirmationUndefinedError",this.message="Default confirmation count can not be undefined"}}class et extends c.F7{constructor(t){super(),this.message=t,this.name="ObservableError"}}class ee{operationResults(){return $(this,void 0,void 0,function*(){return this._operationResult.pipe((0,R.P)()).toPromise()})}receipt(){return $(this,void 0,void 0,function*(){let t=yield this.operationResults();if(!t)throw new et("Unable to get operation results");return t9(t)})}getCurrentConfirmation(){return $(this,void 0,void 0,function*(){return this._included?(0,b.a)([this._includedInBlock,(0,_.D)(this.context.readProvider.getBlock("head"))]).pipe((0,C.U)(t=>{let[e,i]=t;return i.header.level-e.header.level+1}),(0,R.P)()).toPromise():0})}isInCurrentBranch(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"head";return $(this,void 0,void 0,function*(){if(!this._included)return!0;let e=yield this.context.readProvider.getBlockLevel(t),i=yield this._includedInBlock.pipe((0,R.P)()).toPromise();if(!i)throw new et("Inclusion block is undefined");let r=e-i.header.level;if(r<=0)return!0;let s=Math.min(i.header.level+r,i.header.level+60);return new Set((yield this.context.readProvider.getLiveBlocks(s))).has(i.hash)})}confirmationObservable(t){if(void 0!==t&&t<1)throw new t0(t);let{defaultConfirmationCount:e}=this.context.config,i=void 0!==t?t:e;if(void 0===i)throw new t6;return(0,b.a)([this._includedInBlock,this.newHead$]).pipe((0,D.x)((t,e)=>{let[,i]=t,[,r]=e;return i.hash===r.hash}),(0,C.U)(t=>{let[e,r]=t;return{block:r,expectedConfirmation:i,currentConfirmation:r.header.level-e.header.level+1,completed:r.header.level-e.header.level>=i-1,isInCurrentBranch:()=>this.isInCurrentBranch(r.hash)}}),(0,M.o)(t=>{let{completed:e}=t;return!e},!0))}confirmation(t){return this.confirmationObservable(t).toPromise()}constructor(t,e,i){if(this.opHash=t,this.context=e,this._newHead$=i,this._operationResult=new u.t(1),this._includedInBlock=new u.t(1),this._included=!1,this.newHead$=this._newHead$.pipe((0,E.w)(t=>{var e,i;let r=null!==(i=null===(e=this.lastHead)||void 0===e?void 0:e.header.level)&&void 0!==i?i:t.header.level-1;return(0,v.w)(r+1,t.header.level-r-1).pipe((0,I.b)(t=>this.context.readProvider.getBlock(t)),(0,N.l)(t))}),(0,k.b)(t=>this.lastHead=t),(0,j.B)({connector:()=>new u.t(1),resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!1})),this.confirmed$=this.newHead$.pipe((0,C.U)(t=>{for(let e of t.operations)for(let i of e)if(i.hash===this.opHash)return this._included=!0,this._includedInBlock.next(t),this._operationResult.next(i.contents),t}),(0,S.h)(t=>void 0!==t),(0,R.P)(),(0,j.B)({connector:()=>new u.t(1),resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!1})),(0,Z.Ak)(this.opHash)!==Z.nd.VALID)throw new c.e5(this.opHash);this.confirmed$.pipe((0,R.P)(),(0,T.K)(()=>(0,f.of)(void 0))).subscribe()}}class ei extends ee{revealOperation(){return $(this,void 0,void 0,function*(){let t=yield this.operationResults();if(!t)throw new et("operationResult returned undefined");return t.find(t=>t.kind===l.Qg.REVEAL)})}transactionOperation(){return $(this,void 0,void 0,function*(){let t=yield this.operationResults();if(!t)throw new et("operationResult returned undefined");return t.find(t=>t.kind===l.Qg.TRANSACTION)})}status(){return $(this,void 0,void 0,function*(){if(!this._included)return"pending";let t=yield this.transactionOperation();return t?t.metadata.operation_result.status:"unknown"})}constructor(t,e,i){super(t,e,i),this.opHash=t,this.context=e}}class er extends ee{originationOperation(){return $(this,void 0,void 0,function*(){let t=yield this.operationResults();if(t)return tH(t,l.Qg.ORIGINATION);throw new et("Unable to fetch operation result")})}revealOperation(){return $(this,void 0,void 0,function*(){let t=yield this.operationResults();if(t)return tH(t,l.Qg.REVEAL);throw new et("Unable to fetch operation result")})}status(){return $(this,void 0,void 0,function*(){if(!this._included)return"pending";let t=yield this.originationOperation();return t?t.metadata.operation_result.status:"unknown"})}contract(){return $(this,void 0,void 0,function*(){let t=yield this.originationOperation(),e=((null==t?void 0:t.metadata.operation_result.originated_contracts)||[])[0];return this.context.wallet.at(e)})}constructor(t,e,i){super(t,e,i),this.opHash=t,this.context=e}}class es extends ee{revealOperation(){return $(this,void 0,void 0,function*(){let t=yield this.operationResults();if(t)return t.find(t=>t.kind===l.Qg.REVEAL);throw new et("Unable to fetch operation result")})}delegationOperation(){return $(this,void 0,void 0,function*(){let t=yield this.operationResults();if(t)return t.find(t=>t.kind===l.Qg.DELEGATION);throw new et("Unable to fetch operation result")})}status(){return $(this,void 0,void 0,function*(){if(!this._included)return"pending";let t=yield this.delegationOperation();return t?t.metadata.operation_result.status:"unknown"})}constructor(t,e,i){super(t,e,i),this.opHash=t,this.context=e}}class en{getPKH(){return $(this,void 0,void 0,function*(){return this.context.signer.publicKeyHash()})}getPK(){return $(this,void 0,void 0,function*(){return this.context.signer.publicKey()})}mapTransferParamsToWalletParams(t){return $(this,void 0,void 0,function*(){return tB((yield t()),l.Qg.TRANSACTION)})}mapOriginateParamsToWalletParams(t){return $(this,void 0,void 0,function*(){return tB((yield t()),l.Qg.ORIGINATION)})}mapDelegateParamsToWalletParams(t){return $(this,void 0,void 0,function*(){return tB((yield t()),l.Qg.DELEGATION)})}mapIncreasePaidStorageWalletParams(t){return $(this,void 0,void 0,function*(){return tB((yield t()),l.Qg.INCREASE_PAID_STORAGE)})}sendOperations(t){return $(this,void 0,void 0,function*(){return(yield this.context.batch.batch(t).send()).hash})}sign(t,e){return $(this,void 0,void 0,function*(){let{prefixSig:i}=yield this.context.signer.sign(t,e);return i})}constructor(t){this.context=t}}class eo{getSignature(){return this.isAnonymous?this.parameterSchema.ExtractSchema()[this.name]:this.parameterSchema.ExtractSchema()}send(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.provider instanceof t5?this.provider.transfer(this.toTransferParams(t)).send():this.provider.transfer(this.toTransferParams(t))}toTransferParams(){let{fee:t,gasLimit:e,storageLimit:i,source:r,amount:s=0,mutez:n=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{to:this.address,amount:s,fee:t,mutez:n,source:r,gasLimit:e,storageLimit:i,parameter:{entrypoint:this.isMultipleEntrypoint?this.name:ec,value:this.isAnonymous?this.parameterSchema.EncodeObject({[this.name]:this.args}):this.parameterSchema.EncodeObject(this.args)}}}constructor(t,e,i,r,s="unit",n=!0,o=!1){this.provider=t,this.address=e,this.parameterSchema=i,this.name=r,this.args=s,this.isMultipleEntrypoint=n,this.isAnonymous=o}}class ea{validateArgs(t,e,i){let r=e.ExtractSignatures();if(!r.find(e=>e.length===t.length))throw new th(i,r,t)}get schema(){return this.isAnonymous?this.parameterSchema.ExtractSchema()[this.name]:this.parameterSchema.ExtractSchema()}getSignature(){if(this.isAnonymous){let t=this.parameterSchema.ExtractSignatures().find(t=>t[0]===this.name);if(t)return t.shift(),t}else{let t=this.parameterSchema.ExtractSignatures();return 1==t.length?t[0]:t}}send(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.provider instanceof t5?this.provider.transfer(this.toTransferParams(t)).send():this.provider.transfer(this.toTransferParams(t))}toTransferParams(){let{fee:t,gasLimit:e,storageLimit:i,source:r,amount:s=0,mutez:n=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{to:this.address,amount:s,fee:t,mutez:n,source:r,gasLimit:e,storageLimit:i,parameter:{entrypoint:this.isMultipleEntrypoint?this.name:ec,value:this.isAnonymous?this.parameterSchema.Encode(this.name,...this.args):this.parameterSchema.Encode(...this.args)}}}constructor(t,e,i,r,s,n=!0,o=!1){this.provider=t,this.address=e,this.parameterSchema=i,this.name=r,this.args=s,this.isMultipleEntrypoint=n,this.isAnonymous=o}}class el{getSignature(){return{parameter:this._smartContractViewSchema.extractArgsSchema(),result:this._smartContractViewSchema.extractResultSchema()}}executeView(t){return $(this,void 0,void 0,function*(){this.verifyContextExecution(t);let e=yield this._readProvider.getChainId(),i=this.transformArgsToMichelson(),r={contract:this._contractAddress,view:this._smartContractViewSchema.viewName,input:i,chain_id:e,source:t.viewCaller};return t.source&&(r.payer=t.source),this.executeViewAndDecodeResult(r)})}verifyContextExecution(t){if(t.source&&(0,Z.YN)(t.source)!==Z.nd.VALID)throw new ty("The source account who initialized the view execution is invalid: ".concat(t.source,"."));if(!t.viewCaller||(0,Z.YN)(t.viewCaller)!==Z.nd.VALID)throw new ty("The contract which is the caller of view is invalid: ".concat(t.viewCaller,"."))}transformArgsToMichelson(){try{return this._smartContractViewSchema.encodeViewArgs(this._args)}catch(t){throw new c.Uj(this._smartContractViewSchema.viewName,this.getSignature(),this._args,t)}}adaptViewCodeToContext(t,e,i){let r={BALANCE:[{prim:"PUSH",args:[{prim:"mutez"},{int:i}]}],SENDER:[{prim:"PUSH",args:[{prim:"address"},{string:e}]}],SELF_ADDRESS:[{prim:"PUSH",args:[{prim:"address"},{string:this._contractAddress}]}],AMOUNT:[{prim:"PUSH",args:[{prim:"mutez"},{int:"0"}]}]};return t.forEach((s,n)=>{s.prim in r&&(t[n]=Object(r)[s.prim]),s.args&&0!==s.args.length?this.adaptViewCodeToContext(s.args,e,i):Array.isArray(s)&&this.adaptViewCodeToContext(s,e,i)}),t}executeViewAndDecodeResult(t){return $(this,void 0,void 0,function*(){let e;try{e=(yield this._rpc.runScriptView(t)).data}catch(e){let t=tv(e);throw t?new tm("The simulation of the on-chain view named ".concat(this._smartContractViewSchema.viewName," failed with: ").concat(JSON.stringify(t)),this._smartContractViewSchema.viewName,t,e):e}return this._smartContractViewSchema.decodeViewResult(e)})}constructor(t,e,i,r,s,n="Unit"){this._rpc=t,this._readProvider=e,this._contractAddress=i,this._smartContractViewSchema=r,this._contractStorageType=s,this._args=n}}class ed{createContractMethodFlatParams(t,e,i){let r=!(arguments.length>3)||void 0===arguments[3]||arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return new ea(this.provider,this.contractAddress,t,e,i,r,s)}createContractMethodObjectParam(t,e,i){let r=!(arguments.length>3)||void 0===arguments[3]||arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return new eo(this.provider,this.contractAddress,t,e,i,r,s)}createContractViewObjectParam(t,e,i,r,s){return new el(t,e,this.contractAddress,i,r,s)}constructor(t,e){this.provider=t,this.contractAddress=e}}let ec="default";class eh{read(t){return $(this,void 0,void 0,function*(){let e=(0,Z.VN)(null!=t?t:"");if((0,Z.rY)(null!=t?t:"")==Z.nd.VALID)throw new c.Rj("Since version 12, the lambda view no longer depends on a lambda contract. The read method no longer accepts a contract address as a parameter.");if(t&&e!==Z.nd.VALID)throw new c.hJ(t,(0,Z.f4)(e));let i=this.parameterSchema.Encode(...this.args),r=yield this.rpc.runView({contract:this.currentContract.address,entrypoint:this.name,input:i,chain_id:t||(yield this.readProvider.getChainId())});return this.callbackParametersSchema.Execute(r.data)})}constructor(t,e,i,r,s,n,o){this.currentContract=t,this.name=e,this.callbackParametersSchema=i,this.parameterSchema=r,this.args=s,this.rpc=n,this.readProvider=o}}let eu=(t,e,i)=>{let r=e.ExtractSignatures();if(!r.find(e=>e.length===t.length))throw new th(i,r,t)},eg=t=>{let e=!1;if("prim"in t&&"pair"===t.prim&&t.args){let i=t.args[t.args.length-1];"prim"in i&&"contract"===i.prim&&(e=!0)}return e};class ep{_initializeMethods(t,e,i,r){let s=this.parameterSchema,n=Object.keys(e);if(s.isMultipleEntryPoint)n.forEach(s=>{let n=new z.xJ(e[s]);this.methods[s]=function(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];return t.contractMethodFactory.createContractMethodFlatParams(n,s,i)},this.methodsObject[s]=function(e){return t.contractMethodFactory.createContractMethodObjectParam(n,s,e)},eg(e[s])&&(this.views[s]=function(){for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];let l=e[s].args[0],d=new z.xJ(l),c=e[s].args[1].args[0],h=new z.xJ(c);return eu(o,d,s),new eh(t,s,h,d,o,i,r)})}),Object.keys(s.ExtractSchema()).filter(t=>-1===Object.keys(e).indexOf(t)).forEach(e=>{this.methods[e]=function(){for(var i=arguments.length,r=Array(i),n=0;n<i;n++)r[n]=arguments[n];return t.contractMethodFactory.createContractMethodFlatParams(s,e,r,!1,!0)},this.methodsObject[e]=function(i){return t.contractMethodFactory.createContractMethodObjectParam(s,e,i,!1,!0)}});else{let e=this.parameterSchema;this.methods[ec]=function(){for(var i=arguments.length,r=Array(i),s=0;s<i;s++)r[s]=arguments[s];return t.contractMethodFactory.createContractMethodFlatParams(e,ec,r,!1)},this.methodsObject[ec]=function(i){return t.contractMethodFactory.createContractMethodObjectParam(e,ec,i,!1)}}}_initializeOnChainViews(t,e,i,r){let s=this.schema.val;r.forEach(r=>{this.contractViews[r.viewName]=function(n){return t.contractMethodFactory.createContractViewObjectParam(e,i,r,s,n)}})}storage(){return this.storageProvider.getStorage(this.address,this.schema)}bigMap(t){return this.storageProvider.getBigMapKey(this.address,t,this.schema)}constructor(t,e,i,r,s,n,o){this.address=t,this.script=e,this.storageProvider=r,this.entrypoints=s,this.rpc=n,this.readProvider=o,this.methods={},this.methodsObject={},this.views={},this.contractViews={},this.contractMethodFactory=new ed(i,t),this.schema=z.V_.fromRPCResponse({script:this.script}),this.parameterSchema=z.xJ.fromRPCResponse({script:this.script}),this.viewSchema=z.pO.fromRPCResponse({script:this.script}),0!==this.viewSchema.length&&this._initializeOnChainViews(this,n,this.readProvider,this.viewSchema),this.eventSchema=z.Q9.fromRPCResponse({script:this.script}),this._initializeMethods(this,this.entrypoints.entrypoints,this.rpc,this.readProvider)}}class em{getSaplingDiff(t){return $(this,void 0,void 0,function*(){return this.provider.getSaplingDiffByID(this.id.toString(),t)})}getId(){return this.id.toString()}constructor(t,e){this.id=t,this.provider=e}}class ev{get(t,e){return $(this,void 0,void 0,function*(){try{return yield this.provider.getBigMapKeyByID(this.id.toString(),t,this.schema,e)}catch(t){if(t instanceof d.mk&&t.status===d.MU.NOT_FOUND)return;throw t}})}getMultipleValues(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;return $(this,void 0,void 0,function*(){return this.provider.getBigMapKeysByID(this.id.toString(),t,this.schema,e,i)})}toJSON(){return this.id.toString()}toString(){return this.id.toString()}constructor(t,e,i){this.id=t,this.schema=e,this.provider=i}}let ef=t=>({big_map:(e,i)=>{if(!e||!("int"in e)||void 0===e.int)return{};{let r=new z.V_(i);return new ev(new Y.Z(e.int),r,t)}},sapling_state:e=>e&&"int"in e&&void 0!==e.int?new em(new Y.Z(e.int),t):{}}),ey=(t,e)=>{var i,r,s;return{fee:null!==(i=t.fee)&&void 0!==i?i:e.fee,gasLimit:null!==(r=t.gasLimit)&&void 0!==r?r:e.gasLimit,storageLimit:null!==(s=t.storageLimit)&&void 0!==s?s:e.storageLimit}};class eb extends t7{getBlockHash(t){return $(this,void 0,void 0,function*(){return this.context.readProvider.getBlockHash(null!=t?t:"head~2")})}getProtocolHash(){return $(this,void 0,void 0,function*(){return this.context.readProvider.getNextProtocol("head")})}getHeadCounter(t){var e;return $(this,void 0,void 0,function*(){return null!==(e=this.context.readProvider.getCounter(t,"head"))&&void 0!==e?e:"0"})}adjustGasForBatchOperation(t,e,i){return Y.Z.min(e,t.div(i+1))}getOperationLimits(t,e){return $(this,void 0,void 0,function*(){let{hard_gas_limit_per_operation:i,hard_gas_limit_per_block:r,hard_storage_limit_per_operation:s}=t;return{fee:0,gasLimit:e?Math.floor(this.adjustGasForBatchOperation(r,i,e).toNumber()):i.toNumber(),storageLimit:s.toNumber()}})}getFee(t,e,i){(!q(this,a,"f")[e]||q(this,a,"f")[e]<i)&&(q(this,a,"f")[e]=i);let r=++q(this,a,"f")[e];return{counter:"".concat(r),fee:void 0===t.fee?"0":"".concat(t.fee),gas_limit:void 0===t.gas_limit?"0":"".concat(t.gas_limit),storage_limit:void 0===t.storage_limit?"0":"".concat(t.storage_limit)}}getSource(t,e,i){return{source:void 0===t.source?i||e:t.source}}addRevealOperationIfNeeded(t,e){return $(this,void 0,void 0,function*(){if(tQ(t)){let i=[t],{publicKey:r,pkh:s}=yield this.getKeys();if(yield this.isAccountRevealRequired(e)){if(!r)throw new c.BZ(s);return i.unshift((yield tR({fee:td(s),storageLimit:0,gasLimit:ta(s)},e,r))),i}}return t})}getKeys(){return $(this,void 0,void 0,function*(){let t=this.context.isAnySignerConfigured();return{pkh:t?yield this.signer.publicKeyHash():yield this.context.walletProvider.getPKH(),publicKey:t?yield this.signer.publicKey():void 0}})}convertIntoArray(t){return Array.isArray(t)?[...t]:[t]}constructOpContents(t,e,i,r,s){return t.map(t=>{switch(t.kind){case l.Qg.ACTIVATION:case l.Qg.DRAIN_DELEGATE:return Object.assign({},t);case l.Qg.ORIGINATION:return Object.assign(Object.assign(Object.assign(Object.assign({},t),{balance:void 0!==t.balance?"".concat(t.balance):"0"}),this.getSource(t,i,r)),this.getFee(t,i,e));case l.Qg.TRANSACTION:{let s=Object.assign(Object.assign(Object.assign(Object.assign({},t),{amount:void 0!==t.amount?"".concat(t.amount):"0"}),this.getSource(t,i,r)),this.getFee(t,i,e));if(s.source.toLowerCase().startsWith("kt1"))throw new c.Rj("KT1 addresses are not supported as source since ".concat(n.PsBabyM1));return s}case l.Qg.REVEAL:case l.Qg.DELEGATION:case l.Qg.REGISTER_GLOBAL_CONSTANT:case l.Qg.UPDATE_CONSENSUS_KEY:case l.Qg.SMART_ROLLUP_ADD_MESSAGES:case l.Qg.SMART_ROLLUP_ORIGINATE:case l.Qg.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE:return Object.assign(Object.assign(Object.assign({},t),this.getSource(t,i,r)),this.getFee(t,i,e));case l.Qg.TRANSFER_TICKET:return Object.assign(Object.assign(Object.assign(Object.assign({},t),{ticket_amount:"".concat(t.ticket_amount)}),this.getSource(t,i,r)),this.getFee(t,i,e));case l.Qg.INCREASE_PAID_STORAGE:return Object.assign(Object.assign(Object.assign(Object.assign({},t),{amount:"".concat(t.amount)}),this.getSource(t,i,r)),this.getFee(t,i,e));case l.Qg.BALLOT:case l.Qg.PROPOSALS:if(void 0===s)throw new t2("Failed to get the current voting period index");return Object.assign(Object.assign({},t),{period:null==s?void 0:s.voting_period.index});default:throw new c.p(t.kind)}})}activate(t){let{pkh:e,secret:i}=t;return $(this,void 0,void 0,function*(){let t=yield tw({pkh:e,secret:i}),r=this.convertIntoArray(t),s=yield this.getBlockHash(),n=yield this.getProtocolHash();tt(this,a,{},"f");let o=parseInt((yield this.getHeadCounter(e)),10);return{opOb:{branch:s,contents:this.constructOpContents(r,o,e),protocol:n},counter:o}})}reveal(t){let{fee:e,gasLimit:i,storageLimit:r}=t;return $(this,void 0,void 0,function*(){let{pkh:t,publicKey:s}=yield this.getKeys();if(!s)throw new c.BZ(t);let n=yield this.context.readProvider.getProtocolConstants("head"),o=ey({fee:e,storageLimit:r,gasLimit:i},(yield this.getOperationLimits(n))),l=yield tR({fee:o.fee,gasLimit:o.gasLimit,storageLimit:o.storageLimit},t,s),d=this.convertIntoArray(l),h=yield this.getBlockHash(),u=yield this.getProtocolHash();tt(this,a,{},"f");let g=parseInt((yield this.getHeadCounter(t)),10);return{opOb:{branch:h,contents:this.constructOpContents(d,g,t),protocol:u},counter:g}})}originate(t,e){var{fee:i,storageLimit:r,gasLimit:s}=t,n=J(t,["fee","storageLimit","gasLimit"]);return $(this,void 0,void 0,function*(){let{pkh:t}=yield this.getKeys(),o=yield this.context.readProvider.getProtocolConstants("head"),l=yield this.getOperationLimits(o),d=yield tP((yield this.context.parser.prepareCodeOrigination(Object.assign(Object.assign({},n),ey({fee:i,storageLimit:r,gasLimit:s},l))))),c=yield this.addRevealOperationIfNeeded(d,t),h=this.convertIntoArray(c),u=yield this.getBlockHash(),g=yield this.getProtocolHash();tt(this,a,{},"f");let p=parseInt((yield this.getHeadCounter(t)),10);return{opOb:{branch:u,contents:this.constructOpContents(h,p,t,e),protocol:g},counter:p}})}transaction(t){var{fee:e,storageLimit:i,gasLimit:r}=t,s=J(t,["fee","storageLimit","gasLimit"]);return $(this,void 0,void 0,function*(){let{pkh:t}=yield this.getKeys(),n=yield this.context.readProvider.getProtocolConstants("head"),o=yield this.getOperationLimits(n),l=yield tA(Object.assign(Object.assign({},s),ey({fee:e,storageLimit:i,gasLimit:r},o))),d=yield this.addRevealOperationIfNeeded(l,t),c=this.convertIntoArray(d),h=yield this.getBlockHash(),u=yield this.getProtocolHash();tt(this,a,{},"f");let g=parseInt((yield this.getHeadCounter(t)),10);return{opOb:{branch:h,contents:this.constructOpContents(c,g,t,s.source),protocol:u},counter:g}})}delegation(t){var{fee:e,storageLimit:i,gasLimit:r}=t,s=J(t,["fee","storageLimit","gasLimit"]);return $(this,void 0,void 0,function*(){let{pkh:t}=yield this.getKeys(),n=yield this.context.readProvider.getProtocolConstants("head"),o=yield this.getOperationLimits(n),l=yield tE(Object.assign(Object.assign({},s),ey({fee:e,storageLimit:i,gasLimit:r},o))),d=yield this.addRevealOperationIfNeeded(l,t),c=this.convertIntoArray(d),h=yield this.getBlockHash(),u=yield this.getProtocolHash();tt(this,a,{},"f");let g=parseInt((yield this.getHeadCounter(t)),10);return{opOb:{branch:h,contents:this.constructOpContents(c,g,t,s.source),protocol:u},counter:g}})}registerDelegate(t,e){let{fee:i,storageLimit:r,gasLimit:s}=t;return $(this,void 0,void 0,function*(){let{pkh:t}=yield this.getKeys(),n=yield this.context.readProvider.getProtocolConstants("head"),o=ey({fee:i,storageLimit:r,gasLimit:s},(yield this.getOperationLimits(n))),l=yield tS({fee:o.fee,storageLimit:o.storageLimit,gasLimit:o.gasLimit},t),d=yield this.addRevealOperationIfNeeded(l,t),c=this.convertIntoArray(d),h=yield this.getBlockHash(),u=yield this.getProtocolHash();tt(this,a,{},"f");let g=parseInt((yield this.getHeadCounter(t)),10);return{opOb:{branch:h,contents:this.constructOpContents(c,g,t,e),protocol:u},counter:g}})}registerGlobalConstant(t){var{fee:e,storageLimit:i,gasLimit:r}=t,s=J(t,["fee","storageLimit","gasLimit"]);return $(this,void 0,void 0,function*(){let{pkh:t}=yield this.getKeys(),n=yield this.context.readProvider.getProtocolConstants("head"),o=yield this.getOperationLimits(n),l=yield tx(Object.assign(Object.assign({},s),ey({fee:e,storageLimit:i,gasLimit:r},o))),d=yield this.addRevealOperationIfNeeded(l,t),c=this.convertIntoArray(d),h=yield this.getBlockHash(),u=yield this.getProtocolHash();tt(this,a,{},"f");let g=parseInt((yield this.getHeadCounter(t)),10);return{opOb:{branch:h,contents:this.constructOpContents(c,g,t,s.source),protocol:u},counter:g}})}updateConsensusKey(t,e){var{fee:i,storageLimit:r,gasLimit:s}=t,n=J(t,["fee","storageLimit","gasLimit"]);return $(this,void 0,void 0,function*(){let{pkh:t}=yield this.getKeys(),o=yield this.context.readProvider.getProtocolConstants("head"),l=yield this.getOperationLimits(o),d=yield tT(Object.assign(Object.assign({},n),ey({fee:i,storageLimit:r,gasLimit:s},l))),c=yield this.addRevealOperationIfNeeded(d,t),h=this.convertIntoArray(c),u=yield this.getBlockHash(),g=yield this.getProtocolHash();tt(this,a,{},"f");let p=parseInt((yield this.getHeadCounter(t)),10);return{opOb:{branch:u,contents:this.constructOpContents(h,p,t,e),protocol:g},counter:p}})}increasePaidStorage(t){var{fee:e,storageLimit:i,gasLimit:r}=t,s=J(t,["fee","storageLimit","gasLimit"]);return $(this,void 0,void 0,function*(){let{pkh:t}=yield this.getKeys(),n=yield this.context.readProvider.getProtocolConstants("head"),o=yield this.getOperationLimits(n),l=yield tN(Object.assign(Object.assign({},s),ey({fee:e,storageLimit:i,gasLimit:r},o))),d=yield this.addRevealOperationIfNeeded(l,t),c=this.convertIntoArray(d),h=yield this.getBlockHash(),u=yield this.getProtocolHash();tt(this,a,{},"f");let g=parseInt((yield this.getHeadCounter(t)),10);return{opOb:{branch:h,contents:this.constructOpContents(c,g,t,s.source),protocol:u},counter:g}})}ballot(t){return $(this,void 0,void 0,function*(){let e;let{pkh:i}=yield this.getKeys(),r=yield tL(Object.assign({},t)),s=this.convertIntoArray(r),n=yield this.getBlockHash(),o=yield this.getProtocolHash();tt(this,a,{},"f");let l=parseInt((yield this.getHeadCounter(i)),10);try{e=yield this.rpc.getCurrentPeriod()}catch(t){throw new t2("Failed to get the current voting period index")}return{opOb:{branch:n,contents:this.constructOpContents(s,l,i,void 0,e),protocol:o},counter:l}})}proposals(t){return $(this,void 0,void 0,function*(){let e;let{pkh:i}=yield this.getKeys(),r=yield tC(Object.assign({},t)),s=this.convertIntoArray(r),n=yield this.getBlockHash(),o=yield this.getProtocolHash();tt(this,a,{},"f");let l=parseInt((yield this.getHeadCounter(i)),10);try{e=yield this.rpc.getCurrentPeriod()}catch(t){throw new t2("Failed to get the current voting period index")}return{opOb:{branch:n,contents:this.constructOpContents(s,l,i,void 0,e),protocol:o},counter:l}})}drainDelegate(t,e){return $(this,void 0,void 0,function*(){let{pkh:i}=yield this.getKeys(),r=yield tk(Object.assign({},t)),s=this.convertIntoArray(r),n=yield this.getBlockHash(),o=yield this.getProtocolHash();tt(this,a,{},"f");let l=parseInt((yield this.getHeadCounter(i)),10);return{opOb:{branch:n,contents:this.constructOpContents(s,l,i,e),protocol:o},counter:l}})}transferTicket(t){var{fee:e,storageLimit:i,gasLimit:r}=t,s=J(t,["fee","storageLimit","gasLimit"]);return $(this,void 0,void 0,function*(){let{pkh:t}=yield this.getKeys(),n=yield this.context.readProvider.getProtocolConstants("head"),o=yield this.getOperationLimits(n),l=yield tI(Object.assign(Object.assign({},s),ey({fee:e,storageLimit:i,gasLimit:r},o))),d=yield this.addRevealOperationIfNeeded(l,t),c=this.convertIntoArray(d),h=yield this.getBlockHash(),u=yield this.getProtocolHash();tt(this,a,{},"f");let g=parseInt((yield this.getHeadCounter(t)),10);return{opOb:{branch:h,contents:this.constructOpContents(c,g,t,s.source),protocol:u},counter:g}})}smartRollupAddMessages(t){var{fee:e,storageLimit:i,gasLimit:r}=t,s=J(t,["fee","storageLimit","gasLimit"]);return $(this,void 0,void 0,function*(){let{pkh:t}=yield this.getKeys(),n=yield this.context.readProvider.getProtocolConstants("head"),o=yield this.getOperationLimits(n),l=yield tD(Object.assign(Object.assign({},s),ey({fee:e,storageLimit:i,gasLimit:r},o))),d=yield this.addRevealOperationIfNeeded(l,t),c=this.convertIntoArray(d),h=yield this.getBlockHash(),u=yield this.getProtocolHash();tt(this,a,{},"f");let g=parseInt((yield this.getHeadCounter(t)),10);return{opOb:{branch:h,contents:this.constructOpContents(c,g,t,s.source),protocol:u},counter:g}})}smartRollupOriginate(t){var{fee:e,storageLimit:i,gasLimit:r}=t,s=J(t,["fee","storageLimit","gasLimit"]);return $(this,void 0,void 0,function*(){let{pkh:t}=yield this.getKeys(),n=yield this.context.readProvider.getProtocolConstants("head"),o=yield this.getOperationLimits(n),l=yield tM(Object.assign(Object.assign({},ey({fee:e,storageLimit:i,gasLimit:r},o)),s)),d=yield this.addRevealOperationIfNeeded(l,t),c=this.convertIntoArray(d),h=yield this.getBlockHash(),u=yield this.getProtocolHash();tt(this,a,{},"f");let g=parseInt((yield this.getHeadCounter(t)),10);return{opOb:{branch:h,contents:this.constructOpContents(c,g,t,s.source),protocol:u},counter:g}})}smartRollupExecuteOutboxMessage(t){var{fee:e,storageLimit:i,gasLimit:r}=t,s=J(t,["fee","storageLimit","gasLimit"]);return $(this,void 0,void 0,function*(){let{pkh:t}=yield this.getKeys(),n=yield this.context.readProvider.getProtocolConstants("head"),o=yield this.getOperationLimits(n),l=yield tj(Object.assign(Object.assign({},s),ey({fee:e,storageLimit:i,gasLimit:r},o))),d=yield this.addRevealOperationIfNeeded(l,t),c=this.convertIntoArray(d),h=yield this.getBlockHash(),u=yield this.getProtocolHash();tt(this,a,{},"f");let g=parseInt((yield this.getHeadCounter(t)),10);return{opOb:{branch:h,contents:this.constructOpContents(c,g,t,s.source),protocol:u},counter:g}})}batch(t,e){return $(this,void 0,void 0,function*(){let{pkh:i,publicKey:r}=yield this.getKeys(),s=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.getOperationLimits(s,t.length),o=yield this.isRevealOpNeeded(t,i),l=[];if(e)for(let i of t)if(tU(i)){let t=e.shift(),r=ey(i,{fee:t.suggestedFeeMutez,storageLimit:t.storageLimit,gasLimit:t.gasLimit});l.push((yield this.getRPCOp(Object.assign(Object.assign({},i),r))))}else l.push(Object.assign({},i));else for(let e of t)if(tU(e)){let t=ey(e,n);l.push((yield this.getRPCOp(Object.assign(Object.assign({},e),t))))}else l.push(Object.assign({},e));if(o){if(!r)throw new c.BZ(i);l.unshift((yield tR({fee:td(i),storageLimit:0,gasLimit:ta(i)},i,r)))}let d=yield this.getBlockHash(),h=yield this.getProtocolHash();tt(this,a,{},"f");let u=parseInt((yield this.getHeadCounter(i)),10);return{opOb:{branch:d,contents:this.constructOpContents(l,u,i),protocol:h},counter:u}})}contractCall(t){var e,i,r;return $(this,void 0,void 0,function*(){let s=yield this.getBlockHash(),n=yield this.getProtocolHash(),{pkh:o}=yield this.getKeys();tt(this,a,{},"f");let d=parseInt((yield this.getHeadCounter(o)),10),c=t.toTransferParams(),h=yield this.context.readProvider.getProtocolConstants("head"),u=yield this.getOperationLimits(h),g=ey({fee:c.fee,storageLimit:c.storageLimit,gasLimit:c.gasLimit},u),p={kind:l.Qg.TRANSACTION,fee:null!==(e=c.fee)&&void 0!==e?e:g.fee,gas_limit:null!==(i=c.gasLimit)&&void 0!==i?i:g.gasLimit,storage_limit:null!==(r=c.storageLimit)&&void 0!==r?r:g.storageLimit,amount:String(c.amount),destination:c.to,parameters:c.parameter},m=yield this.addRevealOperationIfNeeded(p,o),v=this.convertIntoArray(m);return{opOb:{branch:s,contents:this.constructOpContents(v,d,o),protocol:n},counter:d}})}toPreapply(t){return $(this,void 0,void 0,function*(){let{opOb:{contents:e,branch:i,protocol:r}}=t,s=this.toForge(t),n=yield this.context.forger.forge(s);return[{contents:e,branch:i,protocol:r,signature:(yield this.context.signer.sign(n,new Uint8Array([3]))).prefixSig}]})}toForge(t){let{opOb:{contents:e,branch:i}}=t;return{branch:i,contents:e}}constructor(t){super(t),this.context=t,a.set(this,void 0),tt(this,a,{},"f")}}a=new WeakMap;let e_=[l.Qg.ACTIVATION,l.Qg.ORIGINATION,l.Qg.TRANSACTION,l.Qg.DELEGATION];class eO extends t7{withTransfer(t){let e=(0,Z.YN)(t.to);if(t.amount<0)throw new c.xE(t.amount.toString());if(e!==Z.nd.VALID)throw new c.bS(t.to,(0,Z.f4)(e));return this.operations.push(Object.assign({kind:l.Qg.TRANSACTION},t)),this}withTransferTicket(t){let e=(0,Z.YN)(t.destination);if(e!==Z.nd.VALID)throw new c.bS(t.destination,(0,Z.f4)(e));return this.operations.push(Object.assign({kind:l.Qg.TRANSFER_TICKET},t)),this}withContractCall(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.withTransfer(t.toTransferParams(e))}withDelegation(t){var e;let i=(0,Z.YN)(t.source);if(t.source&&i!==Z.nd.VALID)throw new c.bS(t.source,(0,Z.f4)(i));let r=(0,Z.YN)(null!==(e=t.delegate)&&void 0!==e?e:"");if(t.delegate&&r!==Z.nd.VALID)throw new c.bS(t.delegate,(0,Z.f4)(r));return this.operations.push(Object.assign({kind:l.Qg.DELEGATION},t)),this}withActivation(t){let{pkh:e,secret:i}=t,r=(0,Z.vO)(e);if(r!==Z.nd.VALID)throw new c.Wo(e,(0,Z.f4)(r));return this.operations.push({kind:l.Qg.ACTIVATION,pkh:e,secret:i}),this}withOrigination(t){return this.operations.push(Object.assign({kind:l.Qg.ORIGINATION},t)),this}withRegisterGlobalConstant(t){return this.operations.push(Object.assign({kind:l.Qg.REGISTER_GLOBAL_CONSTANT},t)),this}withIncreasePaidStorage(t){return this.operations.push(Object.assign({kind:l.Qg.INCREASE_PAID_STORAGE},t)),this}withSmartRollupAddMessages(t){return this.operations.push(Object.assign({kind:l.Qg.SMART_ROLLUP_ADD_MESSAGES},t)),this}withSmartRollupOriginate(t){return this.operations.push(Object.assign({kind:l.Qg.SMART_ROLLUP_ORIGINATE},t)),this}withSmartRollupExecuteOutboxMessage(t){return this.operations.push(Object.assign({kind:l.Qg.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE},t)),this}getRPCOp(t){return $(this,void 0,void 0,function*(){switch(t.kind){case l.Qg.TRANSACTION:return tA(Object.assign({},t));case l.Qg.ORIGINATION:return tP((yield this.context.parser.prepareCodeOrigination(Object.assign({},t))));case l.Qg.DELEGATION:return tE(Object.assign({},t));case l.Qg.REGISTER_GLOBAL_CONSTANT:return tx(Object.assign({},t));case l.Qg.INCREASE_PAID_STORAGE:return tN(Object.assign({},t));case l.Qg.TRANSFER_TICKET:return tI(Object.assign({},t));case l.Qg.SMART_ROLLUP_ADD_MESSAGES:return tD(Object.assign({},t));case l.Qg.SMART_ROLLUP_ORIGINATE:return tM(Object.assign({},t));case l.Qg.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE:return tj(Object.assign({},t));default:throw new c.p(JSON.stringify(t.kind))}})}with(t){for(let e of t)switch(e.kind){case l.Qg.TRANSACTION:this.withTransfer(e);break;case l.Qg.ORIGINATION:this.withOrigination(e);break;case l.Qg.DELEGATION:this.withDelegation(e);break;case l.Qg.ACTIVATION:this.withActivation(e);break;case l.Qg.REGISTER_GLOBAL_CONSTANT:this.withRegisterGlobalConstant(e);break;case l.Qg.INCREASE_PAID_STORAGE:this.withIncreasePaidStorage(e);break;case l.Qg.TRANSFER_TICKET:this.withTransferTicket(e);break;case l.Qg.SMART_ROLLUP_ADD_MESSAGES:this.withSmartRollupAddMessages(e);break;case l.Qg.SMART_ROLLUP_ORIGINATE:this.withSmartRollupOriginate(e);break;case l.Qg.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE:this.withSmartRollupExecuteOutboxMessage(e);break;default:throw new c.p(JSON.stringify(e.kind))}return this}send(t){return $(this,void 0,void 0,function*(){let e=yield this.signer.publicKeyHash(),i=t&&t.source||e,r=yield this.estimator.batch(this.operations);r.length!==this.operations.length&&r.shift();let s=yield this.prepare.batch(this.operations,r),n=yield this.forge(s),{hash:o,context:a,forgedBytes:l,opResponse:d}=yield this.signAndInject(n);return new t3(o,s.opOb.contents,i,l,d,a)})}constructor(t,e){super(t),this.estimator=e,this.operations=[],this.prepare=new eb(this.context)}}class ew{batch(t){let e=new eO(this.context,this.estimator);return Array.isArray(t)&&e.with(t),e}constructor(t,e){this.context=t,this.estimator=e}}class eP extends ee{revealOperation(){return $(this,void 0,void 0,function*(){let t=yield this.operationResults();if(t)return t.find(t=>t.kind===l.Qg.REVEAL);throw new et("Unable to fetch operation results")})}status(){return $(this,void 0,void 0,function*(){if(!this._included)return"pending";let t=yield this.operationResults();if(t)return t.filter(t=>-1!==e_.indexOf(t.kind)).map(t=>tK(t)?t.metadata.operation_result.status:"unknown")[0]||"unknown";throw new et("Unable to fetch operation results")})}constructor(t,e,i){super(t,e,i),this.opHash=t,this.context=e,this.getOriginatedContractAddresses=()=>$(this,void 0,void 0,function*(){let t=yield this.operationResults();if(t){let e=t.filter(t=>"origination"===t.kind),i=[];for(let t of e)t.metadata.operation_result.originated_contracts&&(i=[...i,...t.metadata.operation_result.originated_contracts]);return i}throw new et("Unable to fetch operation results")})}}class eA extends ee{revealOperation(){return $(this,void 0,void 0,function*(){let t=yield this.operationResults();if(t)return t.find(t=>t.kind===l.Qg.REVEAL);throw new et("Unable to fetch operation result")})}increasePaidStorageOperation(){return $(this,void 0,void 0,function*(){let t=yield this.operationResults();if(t)return t.find(t=>t.kind===l.Qg.INCREASE_PAID_STORAGE);throw new et("Unable to fetch operation result")})}status(){return $(this,void 0,void 0,function*(){if(!this._included)return"pending";let t=yield this.increasePaidStorageOperation();return t?t.metadata.operation_result.status:"unknown"})}constructor(t,e,i){super(t,e,i),this.opHash=t,this.context=e}}let eE=(t,e,i)=>{var r;return t.pipe((r=1e3*e.config.confirmationPollingTimeoutSecond,function(t){return new g.X(null).pipe((0,x.V)({each:r,with:()=>(0,p._)(()=>new t1("Confirmation polling timed out"))}),(0,B.z)(()=>t))}),(0,j.B)({connector:()=>new u.t(1),resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!1}))};class eS{createNewHeadObservable(){return $(this,void 0,void 0,function*(){return eE(this.sharedHeadObs,this.context)})}createPastBlockWalker(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(0,_.D)(this.context.readProvider.getBlock(t)).pipe((0,E.w)(t=>1===e?(0,f.of)(t):(0,v.w)(t.header.level,e-1).pipe((0,H.O)(t),(0,I.b)(t=>$(this,void 0,void 0,function*(){return this.context.readProvider.getBlock("number"==typeof t?t:t.header.level)})))))}createHeadObservableFromConfig(t){let{blockIdentifier:e}=t;return $(this,void 0,void 0,function*(){let t=[];return e&&t.push(this.createPastBlockWalker(e)),t.push((yield this.createNewHeadObservable())),(0,O.z)(...t)})}createOperation(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return $(this,void 0,void 0,function*(){return new ee(t,this.context.clone(),(yield this.createHeadObservableFromConfig(e)))})}createBatchOperation(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return $(this,void 0,void 0,function*(){return new eP(t,this.context.clone(),(yield this.createHeadObservableFromConfig(e)))})}createTransactionOperation(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return $(this,void 0,void 0,function*(){return new ei(t,this.context.clone(),(yield this.createHeadObservableFromConfig(e)))})}createDelegationOperation(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return $(this,void 0,void 0,function*(){return new es(t,this.context.clone(),(yield this.createHeadObservableFromConfig(e)))})}createOriginationOperation(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return $(this,void 0,void 0,function*(){return new er(t,this.context.clone(),(yield this.createHeadObservableFromConfig(e)))})}createIncreasePaidStorageOperation(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return $(this,void 0,void 0,function*(){return new eA(t,this.context.clone(),(yield this.createHeadObservableFromConfig(e)))})}constructor(t){this.context=t,this.sharedHeadObs=(0,m.P)(()=>ts(this.context.stream.subscribeBlock("head")))}}class eR extends t7{getBalance(t){return $(this,void 0,void 0,function*(){let e=(0,Z.YN)(t);if(e!==Z.nd.VALID)throw new c.bS(t,(0,Z.f4)(e));return this.context.readProvider.getBalance(t,"head")})}getDelegate(t){return $(this,void 0,void 0,function*(){let e=(0,Z.YN)(t);if(e!==Z.nd.VALID)throw new c.bS(t,(0,Z.f4)(e));return this.context.readProvider.getDelegate(t,"head")})}activate(t,e){return $(this,void 0,void 0,function*(){let i=(0,Z.vO)(t);if(i!==Z.nd.VALID)throw new Z.Wo(t,(0,Z.f4)(i));let r=yield this.prepare.activate({pkh:t,secret:e}),s=yield this.forge(r),n="".concat(s.opbytes,"00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");return new t4((yield this.rpc.injectOperation(n)),Object.assign(Object.assign({},s),{opbytes:n}),[],this.context.clone())})}constructor(t){super(t),this.prepare=new eb(this.context)}}class ex{get burnFeeMutez(){return this.roundUp(Number(this.storageLimit)*Number(this.minimalFeePerStorageByteMutez))}get storageLimit(){return Math.max(Number(this._storageLimit),0)}get gasLimit(){return this.roundUp(Number(this._milligasLimit)/1e3)}get operationFeeMutez(){return .1*this.gasLimit+1*Number(this.opSize)}roundUp(t){return Math.ceil(Number(t))}get minimalFeeMutez(){return this.roundUp(this.operationFeeMutez+100)}get suggestedFeeMutez(){return this.roundUp(this.operationFeeMutez+120)}get usingBaseFeeMutez(){return Math.max(Number(this.baseFeeMutez),100)+this.roundUp(this.operationFeeMutez)}get totalCost(){return this.minimalFeeMutez+this.burnFeeMutez}get consumedMilligas(){return Number(this._milligasLimit)}static createEstimateInstanceFromProperties(t){let e,i=0,r=0,s=0,n=0;return t.forEach(t=>{i+=t.milligasLimit,r+=t.storageLimit,s+=t.opSize,n=Math.max(t.minimalFeePerStorageByteMutez,n),t.baseFeeMutez&&(e=e?e+t.baseFeeMutez:t.baseFeeMutez)}),new ex(i,r,s,n,e)}static createArrayEstimateInstancesFromProperties(t){return t.map(t=>new ex(t.milligasLimit,t.storageLimit,t.opSize,t.minimalFeePerStorageByteMutez,t.baseFeeMutez))}constructor(t,e,i,r,s=100){this._milligasLimit=t,this._storageLimit=e,this.opSize=i,this.minimalFeePerStorageByteMutez=r,this.baseFeeMutez=s}}class eI extends c.WO{constructor(){super(),this.name="RevealEstimateError",this.message="Public key is unknown, unable to estimate the reveal operation in Wallet API."}}class eN extends t7{getKeys(){return $(this,void 0,void 0,function*(){let t=this.context.isAnySignerConfigured();return{publicKeyHash:t?yield this.signer.publicKeyHash():yield this.context.walletProvider.getPKH(),publicKey:t?yield this.signer.publicKey():void 0}})}getEstimationPropertiesFromOperationContent(t,e,i,r){let s=tX({contents:[t]}),n=0,o=0;return(s.forEach(t=>{n+=Number(t.consumed_milligas)||0,o+=("allocated_destination_contract"in t?r:0)+("originated_contracts"in t&&Array.isArray(t.originated_contracts)?t.originated_contracts.length*r:0)+("storage_size"in t&&"global_address"in t&&Number(t.storage_size)||0)+("paid_storage_size_diff"in t&&Number(t.paid_storage_size_diff)||0)+("genesis_commitment_hash"in t&&Number(t.size)||0)}),tU(t))?{milligasLimit:tF(t)?n+Number(this.MILLIGAS_BUFFER):n,storageLimit:o>0?o+this.STORAGE_BUFFER:0,opSize:e,minimalFeePerStorageByteMutez:i.toNumber()}:{milligasLimit:0,storageLimit:0,opSize:e,minimalFeePerStorageByteMutez:i.toNumber(),baseFeeMutez:0}}calculateEstimates(t,e){return $(this,void 0,void 0,function*(){let{opbytes:i,opOb:{branch:r,contents:s}}=yield this.forge(t),n={operation:{branch:r,contents:s,signature:"edsigtkpiSSschcaCt9pUVrpNPf7TTcgvgDEDD6NCEHMy8NNQJCGnMfLZzYoQj74yLjo9wx6MPVV29CvVzgi7qEcEUok3k7AuMg"},chain_id:yield this.context.readProvider.getChainId()},{opResponse:o}=yield this.simulate(n),{cost_per_byte:a,origination_size:l}=e,d=[...tJ(o,"backtracked"),...tJ(o)];if(d.length)throw new tY(d,"Error occurred during estimation",o.contents);let c=1;return Array.isArray(t.opOb.contents)&&t.opOb.contents.length>1&&(c="reveal"===o.contents[0].kind?t.opOb.contents.length-1:t.opOb.contents.length),o.contents.map(t=>this.getEstimationPropertiesFromOperationContent(t,"reveal"===t.kind?this.OP_SIZE_REVEAL/2:(i.length+130)/2/c,a,null!=l?l:257))})}originate(t){return $(this,void 0,void 0,function*(){let e=yield this.prepare.originate(t),i=yield this.context.readProvider.getProtocolConstants("head"),r=yield this.calculateEstimates(e,i);return"reveal"===e.opOb.contents[0].kind&&(r.shift(),r[0].opSize-=this.OP_SIZE_REVEAL/2),ex.createEstimateInstanceFromProperties(r)})}transfer(t){var e,{fee:i,storageLimit:r,gasLimit:s}=t,n=J(t,["fee","storageLimit","gasLimit"]);return $(this,void 0,void 0,function*(){let t=(0,Z.YN)(n.to);if(t!==Z.nd.VALID)throw new c.bS(n.to,(0,Z.f4)(t));let o=(0,Z.YN)(null!==(e=n.source)&&void 0!==e?e:"");if(n.source&&o!==Z.nd.VALID)throw new c.bS(n.source,(0,Z.f4)(o));if(n.amount<0)throw new c.xE(n.amount.toString());let a=yield this.prepare.transaction(Object.assign({fee:i,storageLimit:r,gasLimit:s},n)),l=yield this.context.readProvider.getProtocolConstants("head"),d=yield this.calculateEstimates(a,l);return"reveal"===a.opOb.contents[0].kind&&(d.shift(),d[0].opSize-=this.OP_SIZE_REVEAL/2),ex.createEstimateInstanceFromProperties(d)})}transferTicket(t){var e,{fee:i,storageLimit:r,gasLimit:s}=t,n=J(t,["fee","storageLimit","gasLimit"]);return $(this,void 0,void 0,function*(){let t=(0,Z.YN)(n.destination);if(t!==Z.nd.VALID)throw new c.bS(n.destination,(0,Z.f4)(t));let o=(0,Z.YN)(null!==(e=n.source)&&void 0!==e?e:"");if(n.source&&o!==Z.nd.VALID)throw new c.bS(n.source,(0,Z.f4)(o));let a=yield this.context.readProvider.getProtocolConstants("head"),l=yield this.prepare.transferTicket(Object.assign({fee:i,storageLimit:r,gasLimit:s},n)),d=yield this.calculateEstimates(l,a);return"reveal"===l.opOb.contents[0].kind&&(d.shift(),d[0].opSize-=this.OP_SIZE_REVEAL/2),ex.createEstimateInstanceFromProperties(d)})}setDelegate(t){var e,{fee:i,gasLimit:r,storageLimit:s}=t,n=J(t,["fee","gasLimit","storageLimit"]);return $(this,void 0,void 0,function*(){let t=(0,Z.YN)(n.source);if(n.source&&t!==Z.nd.VALID)throw new c.bS(n.source,(0,Z.f4)(t));let o=(0,Z.YN)(null!==(e=n.delegate)&&void 0!==e?e:"");if(n.delegate&&o!==Z.nd.VALID)throw new c.bS(n.delegate,(0,Z.f4)(o));let a=yield this.prepare.delegation(Object.assign({fee:i,storageLimit:s,gasLimit:r},n)),l=yield this.context.readProvider.getProtocolConstants("head"),d=yield this.calculateEstimates(a,l);return"reveal"===a.opOb.contents[0].kind&&(d.shift(),d[0].opSize-=this.OP_SIZE_REVEAL/2),ex.createEstimateInstanceFromProperties(d)})}batch(t){return $(this,void 0,void 0,function*(){let e=yield this.context.readProvider.getProtocolConstants("head"),i=yield this.prepare.batch(t),r=yield this.calculateEstimates(i,e);return ex.createArrayEstimateInstancesFromProperties(r)})}registerDelegate(t,e){var{fee:i,storageLimit:r,gasLimit:s}=t,n=J(t,["fee","storageLimit","gasLimit"]);return $(this,void 0,void 0,function*(){let t=(yield this.getKeys()).publicKeyHash,o=yield this.context.readProvider.getProtocolConstants("head"),a=yield this.prepare.registerDelegate(Object.assign({fee:i,storageLimit:r,gasLimit:s},n),e||t),l=yield this.calculateEstimates(a,o);return"reveal"===a.opOb.contents[0].kind&&(l.shift(),l[0].opSize-=this.OP_SIZE_REVEAL/2),ex.createEstimateInstanceFromProperties(l)})}reveal(t){return $(this,void 0,void 0,function*(){let{publicKeyHash:e,publicKey:i}=yield this.getKeys();if(!i)throw new eI;if(yield this.isAccountRevealRequired(e)){let e=yield this.context.readProvider.getProtocolConstants("head"),i=t?yield this.prepare.reveal(t):yield this.prepare.reveal({}),r=yield this.calculateEstimates(i,e);return ex.createEstimateInstanceFromProperties(r)}})}registerGlobalConstant(t){var{fee:e,storageLimit:i,gasLimit:r}=t,s=J(t,["fee","storageLimit","gasLimit"]);return $(this,void 0,void 0,function*(){let t=yield this.prepare.registerGlobalConstant(Object.assign({fee:e,storageLimit:i,gasLimit:r},s)),n=yield this.context.readProvider.getProtocolConstants("head"),o=yield this.calculateEstimates(t,n);return"reveal"===t.opOb.contents[0].kind&&(o.shift(),o[0].opSize-=this.OP_SIZE_REVEAL/2),ex.createEstimateInstanceFromProperties(o)})}increasePaidStorage(t){var{fee:e,storageLimit:i,gasLimit:r}=t,s=J(t,["fee","storageLimit","gasLimit"]);return $(this,void 0,void 0,function*(){if(s.amount<0)throw new c.xE(s.amount.toString());let t=yield this.context.readProvider.getProtocolConstants("head"),n=yield this.prepare.increasePaidStorage(Object.assign({fee:e,storageLimit:i,gasLimit:r},s)),o=yield this.calculateEstimates(n,t);return"reveal"===n.opOb.contents[0].kind&&(o.shift(),o[0].opSize-=this.OP_SIZE_REVEAL/2),ex.createEstimateInstanceFromProperties(o)})}updateConsensusKey(t){return $(this,void 0,void 0,function*(){let e=yield this.context.readProvider.getProtocolConstants("head"),i=yield this.prepare.updateConsensusKey(t),r=yield this.calculateEstimates(i,e);return"reveal"===i.opOb.contents[0].kind&&(r.shift(),r[0].opSize-=this.OP_SIZE_REVEAL/2),ex.createEstimateInstanceFromProperties(r)})}smartRollupAddMessages(t){return $(this,void 0,void 0,function*(){let e=yield this.context.readProvider.getProtocolConstants("head"),i=yield this.prepare.smartRollupAddMessages(t),r=yield this.calculateEstimates(i,e);return"reveal"===i.opOb.contents[0].kind&&(r.shift(),r[0].opSize-=this.OP_SIZE_REVEAL/2),ex.createEstimateInstanceFromProperties(r)})}smartRollupOriginate(t){return $(this,void 0,void 0,function*(){let e=yield this.context.readProvider.getProtocolConstants("head"),i=yield this.prepare.smartRollupOriginate(t),r=yield this.calculateEstimates(i,e);return"reveal"===i.opOb.contents[0].kind&&(r.shift(),r[0].opSize-=this.OP_SIZE_REVEAL/2),ex.createEstimateInstanceFromProperties(r)})}smartRollupExecuteOutboxMessage(t){return $(this,void 0,void 0,function*(){let e=yield this.context.readProvider.getProtocolConstants("head"),i=yield this.prepare.smartRollupExecuteOutboxMessage(t),r=yield this.calculateEstimates(i,e);return"reveal"===i.opOb.contents[0].kind&&r.shift(),ex.createEstimateInstanceFromProperties(r)})}contractCall(t){return $(this,void 0,void 0,function*(){let e=yield this.context.readProvider.getProtocolConstants("head"),i=yield this.prepare.contractCall(t),r=yield this.calculateEstimates(i,e);return"reveal"===i.opOb.contents[0].kind&&(r.shift(),r[0].opSize-=this.OP_SIZE_REVEAL/2),ex.createEstimateInstanceFromProperties(r)})}constructor(){super(...arguments),this.OP_SIZE_REVEAL=324,this.MILLIGAS_BUFFER=1e5,this.STORAGE_BUFFER=20,this.prepare=new eb(this.context)}}class ek extends t4{get operationResults(){let t=Array.isArray(this.results)&&this.results.find(t=>"delegation"===t.kind);return t&&t.metadata&&t.metadata.operation_result||void 0}get status(){var t,e;return null!==(e=null===(t=this.operationResults)||void 0===t?void 0:t.status)&&void 0!==e?e:"unknown"}get delegate(){return this.params.delegate}get isRegisterOperation(){return this.delegate===this.source}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedGas(){return Y.O.config({DECIMAL_PLACES:0,ROUNDING_MODE:Y.O.ROUND_UP}),this.consumedMilliGas?new Y.O(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return null===(t=this.operationResults)||void 0===t?void 0:t.consumed_milligas}get errors(){var t;return null===(t=this.operationResults)||void 0===t?void 0:t.errors}constructor(t,e,i,r,s,n){super(t,r,s,n),this.params=e,this.source=i}}class eL extends t4{get status(){var t,e;return null!==(e=null===(t=this.operationResults)||void 0===t?void 0:t.status)&&void 0!==e?e:"unknown"}get operationResults(){let t=Array.isArray(this.results)&&this.results.find(t=>"origination"===t.kind);return t&&tK(t)&&t.metadata.operation_result||void 0}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedGas(){return Y.O.config({DECIMAL_PLACES:0,ROUNDING_MODE:Y.O.ROUND_UP}),this.consumedMilliGas?new Y.O(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return null===(t=this.operationResults)||void 0===t?void 0:t.consumed_milligas}get storageDiff(){return this.operationResults&&this.operationResults.paid_storage_size_diff||void 0}get storageSize(){return this.operationResults&&this.operationResults.storage_size||void 0}get errors(){var t;return null===(t=this.operationResults)||void 0===t?void 0:t.errors}contract(t,e){return $(this,void 0,void 0,function*(){if(!this.contractAddress)throw new t$("No contract was originated in this operation");return yield this.confirmation(t,e),this.contractProvider.at(this.contractAddress)})}constructor(t,e,i,r,s,n){super(t,i,r,s),this.params=e,this.contractProvider=n;let o=this.operationResults&&this.operationResults.originated_contracts;Array.isArray(o)&&(this.contractAddress=o[0])}}class eC extends t4{get operationResults(){let t=Array.isArray(this.results)&&this.results.find(t=>"register_global_constant"===t.kind);return t&&t.metadata&&t.metadata.operation_result||void 0}get status(){var t,e;return null!==(e=null===(t=this.operationResults)||void 0===t?void 0:t.status)&&void 0!==e?e:"unknown"}get registeredExpression(){return this.params.value}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get errors(){var t;return null===(t=this.operationResults)||void 0===t?void 0:t.errors}get consumedGas(){return Y.O.config({DECIMAL_PLACES:0,ROUNDING_MODE:Y.O.ROUND_UP}),this.consumedMilliGas?new Y.O(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return null===(t=this.operationResults)||void 0===t?void 0:t.consumed_milligas}constructor(t,e,i,r,s,n){super(t,r,s,n),this.params=e,this.source=i,this.globalConstantHash=this.operationResults&&this.operationResults.global_address}}class eT extends t4{get operationResults(){let t=Array.isArray(this.results)&&this.results.find(t=>"reveal"===t.kind);return t?[t]:[]}get status(){let t=this.operationResults[0];return t?t.metadata.operation_result.status:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get publicKey(){return this.params.public_key}sumProp(t,e){return t.reduce((t,i)=>e in i?Number(i[e])+t:t,0)}get consumedGas(){return Y.O.config({DECIMAL_PLACES:0,ROUNDING_MODE:Y.O.ROUND_UP}),new Y.O(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(tX({contents:this.operationResults}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(tX({contents:this.operationResults}),"paid_storage_size_diff"))}get storageSize(){return String(this.sumProp(tX({contents:this.operationResults}),"storage_size"))}get errors(){return tJ({contents:this.operationResults})}constructor(t,e,i,r,s,n){super(t,r,s,n),this.params=e,this.source=i}}class eD extends t4{get operationResults(){let t=Array.isArray(this.results)&&this.results.find(t=>"transaction"===t.kind);return t?[t]:[]}get status(){let t=this.operationResults[0];return t?t.metadata.operation_result.status:"unknown"}get amount(){return new Y.Z(this.params.amount)}get destination(){return this.params.destination}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}sumProp(t,e){return t.reduce((t,i)=>e in i?Number(i[e])+t:t,0)}get consumedGas(){return Y.Z.config({DECIMAL_PLACES:0,ROUNDING_MODE:Y.Z.ROUND_UP}),new Y.Z(this.consumedMilliGas).dividedBy(1e3).toString()}get consumedMilliGas(){return String(this.sumProp(tX({contents:this.operationResults}),"consumed_milligas"))}get storageDiff(){return String(this.sumProp(tX({contents:this.operationResults}),"paid_storage_size_diff"))}get storageSize(){return String(this.sumProp(tX({contents:this.operationResults}),"storage_size"))}get errors(){return tJ({contents:this.operationResults})}constructor(t,e,i,r,s,n){super(t,r,s,n),this.params=e,this.source=i}}class eM extends t4{get operationResults(){let t=Array.isArray(this.results)&&this.results.find(t=>"increase_paid_storage"===t.kind);return t&&t.metadata&&t.metadata.operation_result||void 0}get status(){var t,e;return null!==(e=null===(t=this.operationResults)||void 0===t?void 0:t.status)&&void 0!==e?e:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get errors(){var t;return null===(t=this.operationResults)||void 0===t?void 0:t.errors}get consumedMilliGas(){var t;return null===(t=this.operationResults)||void 0===t?void 0:t.consumed_milligas}get amount(){return this.params.amount}get destination(){return this.params.destination}constructor(t,e,i,r,s,n){super(t,r,s,n),this.params=e,this.source=i}}class ej extends t4{get operationResults(){let t=Array.isArray(this.results)&&this.results.find(t=>"update_consensus_key"===t.kind);return t&&t.metadata&&t.metadata.operation_result||void 0}get status(){var t,e;return null!==(e=null===(t=this.operationResults)||void 0===t?void 0:t.status)&&void 0!==e?e:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get pk(){return this.params.pk}get consumedMilliGas(){var t;return null===(t=this.operationResults)||void 0===t?void 0:t.consumed_milligas}get errors(){var t;return null===(t=this.operationResults)||void 0===t?void 0:t.errors}constructor(t,e,i,r,s,n){super(t,r,s,n),this.params=e,this.source=i}}class eB extends t4{get operationResults(){let t=Array.isArray(this.results)&&this.results.find(t=>"smart_rollup_add_messages"===t.kind);return t&&t.metadata&&t.metadata.operation_result||void 0}get status(){var t,e;return null!==(e=null===(t=this.operationResults)||void 0===t?void 0:t.status)&&void 0!==e?e:"unknown"}get message(){return this.params.message}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedMilliGas(){var t;return null===(t=this.operationResults)||void 0===t?void 0:t.consumed_milligas}get errors(){var t;return null===(t=this.operationResults)||void 0===t?void 0:t.errors}constructor(t,e,i,r,s,n){super(t,r,s,n),this.params=e,this.source=i}}class eH extends t4{get operationResults(){let t=Array.isArray(this.results)&&this.results.find(t=>t.kind===l.Qg.SMART_ROLLUP_ORIGINATE);return t&&t.metadata&&t.metadata.operation_result||void 0}get status(){var t,e;return null!==(e=null===(t=this.operationResults)||void 0===t?void 0:t.status)&&void 0!==e?e:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedMilliGas(){var t;return null===(t=this.operationResults)||void 0===t?void 0:t.consumed_milligas}get pvmKind(){return this.params.pvm_kind}get kernel(){return this.params.kernel}get errors(){var t;return null===(t=this.operationResults)||void 0===t?void 0:t.errors}constructor(t,e,i,r,s,n){super(t,r,s,n),this.params=e,this.source=i}}class eG extends t4{get operationResults(){return Array.isArray(this.results)&&this.results.find(t=>"ballot"===t.kind)||void 0}get period(){var t;return null===(t=this.operationResults)||void 0===t?void 0:t.period}get proposal(){return this.params.proposal}get ballot(){return this.params.ballot}constructor(t,e,i,r,s,n){super(t,r,s,n),this.params=e,this.source=i}}class eF extends t4{get operationResults(){let t=Array.isArray(this.results)&&this.results.find(t=>"drain_delegate"===t.kind);return t&&t.metadata&&t.metadata.balance_updates||void 0}get consensusKey(){return this.params.consensus_key}get delegate(){return this.params.delegate}get destination(){return this.params.destination}constructor(t,e,i,r,s){super(t,i,r,s),this.params=e}}class eU extends t4{get operationResults(){return Array.isArray(this.results)&&this.results.find(t=>"proposals"===t.kind)||void 0}get proposals(){return this.params.proposals}get period(){var t;return null===(t=this.operationResults)||void 0===t?void 0:t.period}constructor(t,e,i,r,s,n){super(t,r,s,n),this.params=e,this.source=i}}class eQ extends t4{get operationResults(){let t=Array.isArray(this.results)&&this.results.find(t=>t.kind===l.Qg.TRANSFER_TICKET);return t&&t.metadata&&t.metadata.operation_result||void 0}get status(){var t,e;return null!==(e=null===(t=this.operationResults)||void 0===t?void 0:t.status)&&void 0!==e?e:"unknown"}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedGas(){return Y.O.config({DECIMAL_PLACES:0,ROUNDING_MODE:Y.O.ROUND_UP}),this.consumedMilliGas?new Y.O(this.consumedMilliGas).dividedBy(1e3).toString():void 0}get consumedMilliGas(){var t;return null===(t=this.operationResults)||void 0===t?void 0:t.consumed_milligas}constructor(t,e,i,r,s,n){super(t,r,s,n),this.params=e,this.source=i}}class eV extends t4{get operationResults(){let t=Array.isArray(this.results)&&this.results.find(t=>t.kind===l.Qg.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE);return t&&t.metadata&&t.metadata.operation_result||void 0}get status(){var t,e;return null!==(e=null===(t=this.operationResults)||void 0===t?void 0:t.status)&&void 0!==e?e:"unknown"}get rollup(){return this.params.rollup}get cementedCommitment(){return this.params.cemented_commitment}get outputProof(){return this.params.output_proof}get fee(){return Number(this.params.fee)}get gasLimit(){return Number(this.params.gas_limit)}get storageLimit(){return Number(this.params.storage_limit)}get consumedMilliGas(){var t;return null===(t=this.operationResults)||void 0===t?void 0:t.consumed_milligas}get errors(){var t;return null===(t=this.operationResults)||void 0===t?void 0:t.errors}constructor(t,e,i,r,s,n){super(t,r,s,n),this.params=e,this.source=i}}class eK extends t7{getStorage(t,e){return $(this,void 0,void 0,function*(){let i=(0,Z.rY)(t);if(i!==Z.nd.VALID)throw new c.JH(t,(0,Z.f4)(i));let r=yield this.context.readProvider.getScript(t,"head");return e||(e=r),(z.V_.isSchema(e)?e:z.V_.fromRPCResponse({script:e})).Execute(r.storage,ef(this))})}getBigMapKey(t,e,i){return $(this,void 0,void 0,function*(){let r;let s=(0,Z.rY)(t);if(s!==Z.nd.VALID)throw new c.JH(t,(0,Z.f4)(s));i||(i=(yield this.rpc.getContract(t)).script);let n=(r=z.V_.isSchema(i)?i:z.V_.fromRPCResponse({script:i})).EncodeBigMapKey(e),o=yield this.rpc.getBigMapKey(t,n);return r.ExecuteOnBigMapValue(o)})}getBigMapKeyByID(t,e,i,r){return $(this,void 0,void 0,function*(){let{key:s,type:n}=i.EncodeBigMapKey(e),{packed:o}=yield this.context.packer.packData({data:s,type:n}),a=(0,Z.Y$)(o),l=r?yield this.context.readProvider.getBigMapValue({id:t.toString(),expr:a},r):yield this.context.readProvider.getBigMapValue({id:t.toString(),expr:a},"head");return i.ExecuteOnBigMapValue(l,ef(this))})}getBigMapKeysByID(t,e,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5;return $(this,void 0,void 0,function*(){let n=yield this.getBlockForRequest(e,r),o=new z.TH,a=0,l=[];for(;a<e.length;){let r=e.slice(a,a+s).map(e=>this.getBigMapValueOrUndefined(e,t,i,n));l=[...l,...yield Promise.all(r)],a+=s}for(let t=0;t<l.length;t++)o.set(e[t],l[t]);return o})}getBlockForRequest(t,e){return $(this,void 0,void 0,function*(){return 1===t.length||void 0!==e?e:yield this.context.readProvider.getBlockLevel("head")})}getBigMapValueOrUndefined(t,e,i,r){return $(this,void 0,void 0,function*(){try{return yield this.getBigMapKeyByID(e,t,i,r)}catch(t){if(t instanceof d.mk&&t.status===d.MU.NOT_FOUND)return;throw t}})}getSaplingDiffByID(t,e){return $(this,void 0,void 0,function*(){return e?yield this.context.readProvider.getSaplingDiffById({id:t.toString()},e):yield this.context.readProvider.getSaplingDiffById({id:t.toString()},"head")})}originate(t){return $(this,void 0,void 0,function*(){let e=yield this.estimate(t,this.estimator.originate.bind(this.estimator)),i=yield this.prepare.originate(Object.assign(Object.assign({},t),e)),r=i.opOb.contents.find(t=>t.kind===l.Qg.ORIGINATION),s=yield this.forge(i),{hash:n,context:o,forgedBytes:a,opResponse:d}=yield this.signAndInject(s);return new eL(n,r,a,d,o,this)})}setDelegate(t){var e;return $(this,void 0,void 0,function*(){let i=(0,Z.YN)(t.source);if(t.source&&i!==Z.nd.VALID)throw new c.bS(t.source,(0,Z.f4)(i));let r=(0,Z.YN)(null!==(e=t.delegate)&&void 0!==e?e:"");if(t.delegate&&r!==Z.nd.VALID)throw new c.bS(t.delegate,(0,Z.f4)(r));if(/kt1/i.test(t.source))throw new tu(t.source);let s=yield this.signer.publicKeyHash(),n=t.source||s,o=yield this.estimate(t,this.estimator.setDelegate.bind(this.estimator)),a=yield this.prepare.delegation(Object.assign(Object.assign({},t),o)),d=a.opOb.contents.find(t=>t.kind===l.Qg.DELEGATION),h=yield this.forge(a),{hash:u,context:g,forgedBytes:p,opResponse:m}=yield this.signAndInject(h);return new ek(u,d,n,p,m,g)})}registerDelegate(t){return $(this,void 0,void 0,function*(){let e=yield this.estimate(t,this.estimator.registerDelegate.bind(this.estimator)),i=yield this.signer.publicKeyHash(),r=yield this.prepare.registerDelegate(Object.assign(Object.assign({},t),e)),s=r.opOb.contents.find(t=>t.kind===l.Qg.DELEGATION),n=yield this.forge(r),{hash:o,context:a,forgedBytes:d,opResponse:c}=yield this.signAndInject(n);return new ek(o,s,i,d,c,a)})}transfer(t){var e;return $(this,void 0,void 0,function*(){let i=(0,Z.YN)(t.to);if(i!==Z.nd.VALID)throw new c.bS(t.to,(0,Z.f4)(i));let r=(0,Z.YN)(null!==(e=t.source)&&void 0!==e?e:"");if(t.source&&r!==Z.nd.VALID)throw new c.bS(t.source,(0,Z.f4)(r));if(t.amount<0)throw new c.xE(t.amount.toString());let s=yield this.signer.publicKeyHash(),n=yield this.estimate(t,this.estimator.transfer.bind(this.estimator)),o=t.source||s,a=yield this.prepare.transaction(Object.assign(Object.assign({},t),n)),d=a.opOb.contents.find(t=>t.kind===l.Qg.TRANSACTION),h=yield this.forge(a),{hash:u,context:g,forgedBytes:p,opResponse:m}=yield this.signAndInject(h);return new eD(u,d,o,p,m,g)})}transferTicket(t){var e,i;return $(this,void 0,void 0,function*(){let r=(0,Z.YN)(t.destination);if(r!==Z.nd.VALID)throw new c.bS(t.destination,(0,Z.f4)(r));let s=(0,Z.YN)(null!==(e=t.source)&&void 0!==e?e:"");if(t.source&&s!==Z.nd.VALID)throw new c.bS(t.source,(0,Z.f4)(s));let n=yield this.signer.publicKeyHash(),o=null!==(i=t.source)&&void 0!==i?i:n,a=yield this.estimate(t,this.estimator.transferTicket.bind(this.estimator)),d=yield this.prepare.transferTicket(Object.assign(Object.assign({},t),a)),h=d.opOb.contents.find(t=>t.kind===l.Qg.TRANSFER_TICKET),u=yield this.forge(d),{hash:g,context:p,forgedBytes:m,opResponse:v}=yield this.signAndInject(u);return new eQ(g,h,o,m,v,p)})}reveal(t){return $(this,void 0,void 0,function*(){let e=yield this.signer.publicKeyHash(),i=yield this.estimator.reveal(t);if(i){let r=yield this.estimate(t,()=>$(this,void 0,void 0,function*(){return i})),s=yield this.prepare.reveal(Object.assign(Object.assign({},t),r)),n=s.opOb.contents.find(t=>t.kind===l.Qg.REVEAL),o=yield this.forge(s),{hash:a,context:d,forgedBytes:c,opResponse:h}=yield this.signAndInject(o);return new eT(a,n,e,c,h,d)}throw new tb("The publicKeyHash '".concat(e,"' has already been revealed."))})}registerGlobalConstant(t){return $(this,void 0,void 0,function*(){let e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.registerGlobalConstant.bind(this.estimator)),r=yield this.prepare.registerGlobalConstant(Object.assign(Object.assign({},t),i)),s=r.opOb.contents.find(t=>t.kind===l.Qg.REGISTER_GLOBAL_CONSTANT),n=yield this.forge(r),{hash:o,context:a,forgedBytes:d,opResponse:c}=yield this.signAndInject(n);return new eC(o,s,e,d,c,a)})}increasePaidStorage(t){return $(this,void 0,void 0,function*(){if(t.amount<0)throw new c.xE(t.amount.toString());let e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.increasePaidStorage.bind(this.estimator)),r=yield this.prepare.increasePaidStorage(Object.assign(Object.assign({},t),i)),s=r.opOb.contents.find(t=>t.kind===l.Qg.INCREASE_PAID_STORAGE),n=yield this.forge(r),{hash:o,context:a,forgedBytes:d,opResponse:h}=yield this.signAndInject(n);return new eM(o,s,e,d,h,a)})}drainDelegate(t){return $(this,void 0,void 0,function*(){let e=yield this.prepare.drainDelegate(t),i=e.opOb.contents.find(t=>t.kind===l.Qg.DRAIN_DELEGATE),r=yield this.forge(e),{hash:s,context:n,forgedBytes:o,opResponse:a}=yield this.signAndInject(r);return new eF(s,i,o,a,n)})}ballot(t){var e,i;return $(this,void 0,void 0,function*(){let r=yield this.signer.publicKeyHash(),s=(0,Z.YN)(null!==(e=t.source)&&void 0!==e?e:"");if(t.source&&s!==Z.nd.VALID)throw new c.bS(t.source,(0,Z.f4)(s));let n=null!==(i=t.source)&&void 0!==i?i:r,o=yield this.prepare.ballot(Object.assign(Object.assign({},t),{source:n})),a=o.opOb.contents.find(t=>t.kind===l.Qg.BALLOT),d=yield this.forge(o),{hash:h,context:u,forgedBytes:g,opResponse:p}=yield this.signAndInject(d);return new eG(h,a,r,g,p,u)})}proposals(t){var e,i;return $(this,void 0,void 0,function*(){let r=yield this.signer.publicKeyHash(),s=(0,Z.YN)(null!==(e=t.source)&&void 0!==e?e:"");if(t.source&&s!==Z.nd.VALID)throw new c.bS(t.source,(0,Z.f4)(s));let n=null!==(i=t.source)&&void 0!==i?i:r,o=yield this.prepare.proposals(Object.assign(Object.assign({},t),{source:n})),a=o.opOb.contents.find(t=>t.kind===l.Qg.PROPOSALS),d=yield this.forge(o),{hash:h,context:u,forgedBytes:g,opResponse:p}=yield this.signAndInject(d);return new eU(h,a,r,g,p,u)})}updateConsensusKey(t){return $(this,void 0,void 0,function*(){let e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.updateConsensusKey.bind(this.estimator)),r=yield this.prepare.updateConsensusKey(Object.assign(Object.assign({},t),i)),s=r.opOb.contents.find(t=>t.kind===l.Qg.UPDATE_CONSENSUS_KEY),n=yield this.forge(r),{hash:o,context:a,forgedBytes:d,opResponse:c}=yield this.signAndInject(n);return new ej(o,s,e,d,c,a)})}smartRollupAddMessages(t){return $(this,void 0,void 0,function*(){let e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.smartRollupAddMessages.bind(this.estimator)),r=yield this.prepare.smartRollupAddMessages(Object.assign(Object.assign({},t),i)),s=r.opOb.contents.find(t=>t.kind===l.Qg.SMART_ROLLUP_ADD_MESSAGES),n=yield this.forge(r),{hash:o,context:a,forgedBytes:d,opResponse:c}=yield this.signAndInject(n);return new eB(o,s,e,d,c,a)})}smartRollupOriginate(t){return $(this,void 0,void 0,function*(){let e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.smartRollupOriginate.bind(this.estimator)),r=yield this.prepare.smartRollupOriginate(Object.assign(Object.assign({},t),i)),s=r.opOb.contents.find(t=>t.kind===l.Qg.SMART_ROLLUP_ORIGINATE),n=yield this.forge(r),{hash:o,context:a,forgedBytes:d,opResponse:c}=yield this.signAndInject(n);return new eH(o,s,e,d,c,a)})}smartRollupExecuteOutboxMessage(t){return $(this,void 0,void 0,function*(){let e=yield this.signer.publicKeyHash(),i=yield this.estimate(t,this.estimator.smartRollupExecuteOutboxMessage.bind(this.estimator)),r=yield this.prepare.smartRollupExecuteOutboxMessage(Object.assign(Object.assign({},t),i)),s=r.opOb.contents.find(t=>t.kind===l.Qg.SMART_ROLLUP_EXECUTE_OUTBOX_MESSAGE),n=yield this.forge(r),{hash:o,context:a,forgedBytes:d,opResponse:c}=yield this.signAndInject(n);return new eV(o,s,e,d,c,a)})}failingNoop(t){return $(this,void 0,void 0,function*(){let e={kind:l.Qg.FAILING_NOOP,arbitrary:t.arbitrary},i=yield this.context.readProvider.getBlockHash(t.basedOnBlock),r=yield this.context.forger.forge({branch:i,contents:[e]}),{prefixSig:s}=yield this.signer.sign(r,new Uint8Array([3]));return{signature:s,bytes:r,signedContent:{branch:i,contents:[{kind:l.Qg.FAILING_NOOP,arbitrary:t.arbitrary}]}}})}at(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t=>t;return $(this,void 0,void 0,function*(){let i=(0,Z.rY)(t);if(i!==Z.nd.VALID)throw new c.JH(t,(0,Z.f4)(i));let r=this.context.withExtensions().rpc,s=this.context.withExtensions().readProvider,n=yield s.getScript(t,"head"),o=yield s.getEntrypoints(t);return e(new ep(t,n,this,this,o,r,s),this.context)})}batch(t){let e=new eO(this.context,this.estimator);return Array.isArray(t)&&e.with(t),e}constructor(t,e){super(t),this.estimator=e,this.contractProviderTypeSymbol=Symbol.for("taquito-contract-provider-type-symbol"),this.prepare=new eb(this.context)}}class ez{getNextProto(){return $(this,void 0,void 0,function*(){if(!this.context.proto){let t=yield this.context.readProvider.getNextProtocol("head");this.context.proto=t}return this.context.proto})}parseScript(t){return $(this,void 0,void 0,function*(){return new W._b({protocol:yield this.getNextProto()}).parseScript(t)})}parseMichelineExpression(t){return $(this,void 0,void 0,function*(){return new W._b({protocol:yield this.getNextProto()}).parseMichelineExpression(t)})}parseJSON(t){return $(this,void 0,void 0,function*(){return new W._b({protocol:yield this.getNextProto()}).parseJSON(t)})}prepareCodeOrigination(t){return $(this,void 0,void 0,function*(){if(t.code=yield this.formatCodeParam(t.code),t.init)t.init=yield this.formatInitParam(t.init);else if(t.storage){let e=t.code.find(t=>"prim"in t&&"storage"===t.prim);if(!(null==e?void 0:e.args))throw new tg("The storage section is missing from the script",t.code);let i=new z.V_(e.args[0]),r=yield this.findGlobalConstantsHashAndValue(i);if(0!==Object.keys(r).length){let i=new W._b({expandGlobalConstant:r}).parseJSON(e.args[0]),s=new z.V_(i);t.init=s.Encode(t.storage)}else t.init=i.Encode(t.storage);delete t.storage}return t})}formatCodeParam(t){return $(this,void 0,void 0,function*(){let e;if("string"==typeof t){let i=yield this.parseScript(t);if(null===i)throw new tg("Unable to parse",t);e=i}else{let i=yield this.parseJSON(t),r=["parameter","storage","code"];e=i.sort((t,e)=>r.indexOf(t.prim)-r.indexOf(e.prim))}return e})}formatInitParam(t){return $(this,void 0,void 0,function*(){let e;if("string"==typeof t){let i=yield this.parseMichelineExpression(t);if(null===i)throw new tp("Invalid init parameter",t);e=i}else e=yield this.parseJSON(t);return e})}findGlobalConstantsHashAndValue(t){return $(this,void 0,void 0,function*(){let e=t.findToken("constant"),i={};if(0!==e.length)for(let t of e){let e=t.tokenVal.args;if(e){let t=e[0];if(t.string){let e=t.string,r=yield this.context.globalConstantsProvider.getGlobalConstantByHash(e);Object.assign(i,{[e]:r})}}}return i})}constructor(t){this.context=t}}class eZ{packData(t){return $(this,void 0,void 0,function*(){return this.context.rpc.packData(t)})}constructor(t){this.context=t}}class eY extends c.rJ{constructor(){super(),this.name="UnconfiguredGlobalConstantsProviderError",this.message="No global constants provider has been configured. Please configure one by calling setGlobalConstantsProvider({globalConstantsProvider}) on your TezosToolkit instance."}}class eW{getGlobalConstantByHash(t){return $(this,void 0,void 0,function*(){throw new eY})}}class eX{getBalance(t,e){return $(this,void 0,void 0,function*(){return this.rpc.getBalance(t,{block:String(e)})})}getDelegate(t,e){return $(this,void 0,void 0,function*(){return this.rpc.getDelegate(t,{block:String(e)})})}getNextProtocol(t){return $(this,void 0,void 0,function*(){return(yield this.rpc.getProtocols({block:String(t)})).next_protocol})}getProtocolConstants(t){return $(this,void 0,void 0,function*(){let{time_between_blocks:e,minimal_block_delay:i,hard_gas_limit_per_operation:r,hard_gas_limit_per_block:s,hard_storage_limit_per_operation:n,cost_per_byte:o,smart_rollup_origination_size:a}=yield this.rpc.getConstants({block:String(t)});return{time_between_blocks:e,minimal_block_delay:i,hard_gas_limit_per_operation:r,hard_gas_limit_per_block:s,hard_storage_limit_per_operation:n,cost_per_byte:o,smart_rollup_origination_size:a}})}getScript(t,e){return $(this,void 0,void 0,function*(){let{script:i}=yield this.rpc.getContract(t,{block:String(e)});return i})}getStorage(t,e){return $(this,void 0,void 0,function*(){return this.rpc.getStorage(t,{block:String(e)})})}getBlockHash(t){return $(this,void 0,void 0,function*(){let{hash:e}=yield this.rpc.getBlockHeader({block:String(t)});return e})}getBlockLevel(t){return $(this,void 0,void 0,function*(){let{level:e}=yield this.rpc.getBlockHeader({block:String(t)});return e})}getCounter(t,e){return $(this,void 0,void 0,function*(){let{counter:i}=yield this.rpc.getContract(t,{block:String(e)});return i||"0"})}getBlockTimestamp(t){return $(this,void 0,void 0,function*(){let{timestamp:e}=yield this.rpc.getBlockHeader({block:String(t)});return e})}getBigMapValue(t,e){return $(this,void 0,void 0,function*(){return this.rpc.getBigMapExpr(t.id,t.expr,{block:String(e)})})}getSaplingDiffById(t,e){return $(this,void 0,void 0,function*(){return this.rpc.getSaplingDiffById(t.id,{block:String(e)})})}getSaplingDiffByContract(t,e){return $(this,void 0,void 0,function*(){return this.rpc.getSaplingDiffByContract(t,{block:String(e)})})}getEntrypoints(t){return $(this,void 0,void 0,function*(){return this.rpc.getEntrypoints(t)})}getChainId(){return $(this,void 0,void 0,function*(){return this.rpc.getChainId()})}isAccountRevealed(t,e){return $(this,void 0,void 0,function*(){let i=yield this.rpc.getManagerKey(t,{block:String(e)});return i&&"object"==typeof i?!!i.key:!!i})}getBlock(t){return $(this,void 0,void 0,function*(){return this.rpc.getBlock({block:String(t)})})}getLiveBlocks(t){return this.rpc.getLiveBlocks({block:String(t)})}constructor(t){this.rpc=t}}class eJ extends c.Yy{constructor(t){super(),this.type=t,this.name="UnsupportedEventError",this.message='Unsupported event type "'.concat(t,'" expecting one of the "data", "error", or "close".')}}class e$ extends c.Yy{constructor(t){super(),this.invalidExpression=t,this.name="InvalidFilterExpressionError",this.message="Invalid filter expression expecting the object to contain either and/or property"}}let eq=(t,e)=>t.hash===e.opHash,e0=(t,e)=>{switch(t.kind){case"attestation":case"endorsement":return"metadata"in t&&t.metadata.delegate===e.source;case"activate_account":return"metadata"in t&&t.pkh===e.source;default:return"source"in t&&t.source===e.source}},e1=(t,e)=>"kind"in t&&t.kind===e.kind,e2=(t,e)=>{switch(t.kind){case"delegation":return t.delegate===e.destination;case"origination":if("metadata"in t&&"operation_result"in t.metadata&&"originated_contracts"in t.metadata.operation_result&&Array.isArray(t.metadata.operation_result.originated_contracts))return t.metadata.operation_result.originated_contracts.some(t=>t===e.destination);break;case"transaction":return t.destination===e.destination;default:return!1}},e4=(t,e,i,r)=>"event"===t.kind&&(!i||t.tag===i)&&(!e||t.source===e)&&(!r||"applied"===t.result.status),e3=(t,e)=>"opHash"in e?eq(t,e):"source"in e?e0(t,e):"kind"in e?e1(t,e):"destination"in e&&e2(t,e),e7=(t,e)=>{if(Array.isArray(e.and))return e.and.every(e=>e8(t,e));if(Array.isArray(e.or))return e.or.some(e=>e8(t,e));throw new e$(e)},e8=(t,e)=>{let i=[];return Array.isArray(e)?i.push(...e):i.push(e),i.every(e=>"and"in e||"or"in e?e7(t,e):e3(t,e))};class e5{call(t,e){for(let i of t)try{i(e)}catch(t){console.error(t)}}remove(t,e){let i=t.indexOf(e);-1!==i&&t.splice(i,1)}on(t,e){switch(t){case"data":this.messageListeners.push(e);break;case"error":this.errorListeners.push(e);break;case"close":this.closeListeners.push(e);break;default:throw new eJ(t)}}off(t,e){switch(t){case"data":this.remove(this.messageListeners,e);break;case"error":this.remove(this.errorListeners,e);break;case"close":this.remove(this.closeListeners,e);break;default:throw new eJ(t)}}close(){this.completed$.next()}constructor(t,e=!1,i=(0,G.X)()){this.shouldRetry=e,this.operatorFunction=i,this.errorListeners=[],this.messageListeners=[],this.closeListeners=[],this.completed$=new w.x,t.pipe((0,F.R)(this.completed$),(0,k.b)(t=>{this.call(this.messageListeners,t)},t=>{this.call(this.errorListeners,t)},()=>{this.call(this.closeListeners)}),this.shouldRetry?i:(0,k.b)(),(0,T.K)(()=>P.C)).subscribe()}}let e9={shouldObservableSubscriptionRetry:!1,observableSubscriptionRetryFunction:(0,G.X)()},e6=t=>(0,_.D)(t.rpc.getBlock()).pipe((0,R.P)()),it=t=>(0,I.b)(e=>new h.y(i=>{for(let r of e.operations)for(let e of r)for(let r of e.contents)e8(Object.assign({hash:e.hash},r),t)&&i.next(Object.assign({hash:e.hash},r));i.complete()})),ie=t=>(0,I.b)(e=>new h.y(i=>{for(let r of e.operations)for(let s of r)for(let r of s.contents){let n=r.metadata.internal_operation_results;if(n)for(let r of n)e4(r,null==t?void 0:t.address,null==t?void 0:t.tag,null==t?void 0:t.excludeFailedOperations)&&i.next(Object.assign({opHash:s.hash,blockHash:e.hash,level:e.header.level},r))}i.complete()}));class ii{get config(){return this._config$.getValue()}getConfirmationPollingInterval(){return $(this,void 0,void 0,function*(){if(!this.config.pollingIntervalMilliseconds)try{let t=yield this.context.readProvider.getProtocolConstants("head"),e=(t.minimal_block_delay?t.minimal_block_delay.multipliedBy(1e3):t.time_between_blocks?t.time_between_blocks[0].multipliedBy(1e3):new Y.Z(5e3)).dividedBy(3);this.config.pollingIntervalMilliseconds=0===e.toNumber()?1e3:e.toNumber()}catch(t){return 5e3}return this.config.pollingIntervalMilliseconds})}subscribeBlock(t){return new e5(this.newBlock$,this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribe(t){return new e5(this.newBlock$.pipe((0,U.j)("hash")),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribeOperation(t){return new e5(this.newBlock$.pipe(it(t)),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}subscribeEvent(t){return new e5(this.newBlock$.pipe(ie(t)),this.config.shouldObservableSubscriptionRetry,this.config.observableSubscriptionRetryFunction)}constructor(t,e={}){this.context=t,this._config$=new g.X(Object.assign(Object.assign({},e9),e)),this.timer$=this._config$.pipe((0,U.j)("pollingIntervalMilliseconds"),(0,E.w)(t=>t?(0,A.H)(0,t):(0,_.D)(this.getConfirmationPollingInterval()).pipe((0,E.w)(t=>(0,A.H)(0,t))))),this.newBlock$=this.timer$.pipe((0,E.w)(()=>e6(this.context)),(0,Q.g)("hash"),(0,V.n)(),(0,K.x)())}}class ir{getNextProto(){return $(this,void 0,void 0,function*(){if(!this.context.proto){let t=yield this.context.readProvider.getNextProtocol("head");this.context.proto=t}return this.context.proto})}forge(t){let{branch:e,contents:i}=t;return $(this,void 0,void 0,function*(){return new X.P$((yield this.getNextProto())).forge({branch:e,contents:i})})}constructor(t){this.context=t}}let is={defaultConfirmationCount:1,confirmationPollingTimeoutSecond:180};class io{get config(){return this._config.getValue()}set config(t){this._config.next(Object.assign({},t))}setPartialConfig(t){this._config.next(Object.assign(Object.assign({},this._config.getValue()),t))}get rpc(){return this._rpcClient}set rpc(t){this._rpcClient=t}get injector(){return this._injector}set injector(t){this._injector=t}get forger(){return this._forger}set forger(t){this._forger=t}get signer(){return this._signer}set signer(t){this._signer=t}get walletProvider(){return this._walletProvider}set walletProvider(t){this._walletProvider=t}set proto(t){this._proto=t}get proto(){return this._proto}get parser(){return this._parser}set parser(t){this._parser=t}get packer(){return this._packer}set packer(t){this._packer=t}get globalConstantsProvider(){return this._globalConstantsProvider}set globalConstantsProvider(t){this._globalConstantsProvider=t}get readProvider(){return this._readProvider}set readProvider(t){this._readProvider=t}get stream(){return this._stream}set stream(t){this._stream=t}isAnyProtocolActive(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return $(this,void 0,void 0,function*(){if(this._proto)return t.includes(this._proto);{let e=yield this.readProvider.getNextProtocol("head");return t.includes(e)}})}isAnySignerConfigured(){return!(this.signer instanceof tr)}clone(){return new io(this.rpc,this.signer,this.proto,this._config,this.forger,this._injector,this.packer,this._walletProvider,this._parser,this._globalConstantsProvider,this._readProvider,this._stream)}registerProviderDecorator(t){this.providerDecorator.push(t)}constructor(t,e=new tr,i,r=new g.X(Object.assign({},is)),s,n,o,a,d,c,h,u){this._rpc=t,this._signer=e,this._proto=i,this._config=r,this.providerDecorator=[],this.tz=new eR(this),this.estimate=new eN(this),this.contract=new eK(this,this.estimate),this.prepare=new eb(this),this.batch=new ew(this,this.estimate),this.wallet=new t5(this),this.withExtensions=()=>{let t=this.clone();return this.providerDecorator.forEach(e=>{t=e(t)}),t},"string"==typeof this._rpc?this._rpcClient=new l.Dl(this._rpc):this._rpcClient=this._rpc,this._forger=s||new ir(this),this._injector=n||new te(this),this.operationFactory=new eS(this),this._walletProvider=a||new en(this),this._parser=d||new ez(this),this._packer=o||new eZ(this),this._globalConstantsProvider=c||new eW,this._readProvider=h||new eX(this._rpcClient),this._stream=u||new ii(this)}}let ia={commitHash:"bb48f61207e1806442b0874365e98c7283ba1f68",version:"19.1.0"};class il{setProvider(t){let{rpc:e,stream:i,signer:r,protocol:s,config:n,forger:o,wallet:a,packer:l,globalConstantsProvider:d,readProvider:c,parserProvider:h,injectorProvider:u}=t;this.setRpcProvider(e),this.setStreamProvider(i),this.setSignerProvider(r),this.setForgerProvider(o),this.setWalletProvider(a),this.setPackerProvider(l),this.setGlobalConstantsProvider(d),this.setReadProvider(c),this.setParserProvider(h),this.setInjectorProvider(u),this._context.proto=s,n&&this._context.setPartialConfig(n)}setSignerProvider(t){this._options.signer||void 0!==t?void 0!==t&&(this._context.signer=t,this._options.signer=t):(this._context.signer=new tr,this._options.signer=t)}setRpcProvider(t){"string"==typeof t?this._rpcClient=new l.Dl(t):void 0===t||(this._rpcClient=t),this._options.rpc=this._rpcClient,this._context.rpc=this._rpcClient}setForgerProvider(t){if(void 0!==t)this._options.forger=t,this._context.forger=t;else if(void 0===this._options.forger){let t=this.getFactory(ir)();this._options.forger=t,this._context.forger=t}}setStreamProvider(t){if("string"==typeof t){let e=new ii(new io(new l.Dl(t)));this._options.stream=e,this._context.stream=e}else if(void 0!==t)this._options.stream=t,this._context.stream=t;else if(void 0===this._options.stream){let t=this.getFactory(ii)();this._options.stream=t,this._context.stream=t}}setWalletProvider(t){if(this._options.wallet||void 0!==t)void 0!==t&&(this._options.wallet=t,this._context.walletProvider=t);else{let t=this.getFactory(en)();this._options.wallet=t,this._context.walletProvider=t}}setPackerProvider(t){if(this._options.packer||void 0!==t)void 0!==t&&(this._context.packer=t,this._options.packer=t);else{let t=this.getFactory(eZ)();this._context.packer=t,this._options.packer=t}}setGlobalConstantsProvider(t){if(this._options.globalConstantsProvider||void 0!==t)void 0!==t&&(this._context.globalConstantsProvider=t,this._options.globalConstantsProvider=t);else{let t=new eW;this._context.globalConstantsProvider=t,this._options.globalConstantsProvider=t}}setReadProvider(t){let e=t||new eX(this._context.rpc);this._options.readProvider=e,this._context.readProvider=e}setParserProvider(t){if(this._options.parserProvider||void 0!==t)void 0!==t&&(this._context.parser=t,this._options.parserProvider=t);else{let t=new ez(this._context);this._context.parser=t,this._options.parserProvider=t}}setInjectorProvider(t){if(this._options.injectorProvider||void 0!==t)void 0!==t&&(this._context.injector=t,this._options.injectorProvider=t);else{let t=new te(this._context);this._context.injector=t,this._options.injectorProvider=t}}get tz(){return this._context.tz}get contract(){return this._context.contract}get prepare(){return this._context.prepare}get wallet(){return this._wallet}get operation(){return this._context.operationFactory}get estimate(){return this._context.estimate}get stream(){return this._context.stream}get rpc(){return this._context.rpc}get signer(){return this._context.signer}get globalConstants(){return this._context.globalConstantsProvider}addExtension(t){Array.isArray(t)?t.forEach(t=>t.configureContext(this._context)):t.configureContext(this._context)}getFactory(t){var e=this;return function(){for(var i=arguments.length,r=Array(i),s=0;s<i;s++)r[s]=arguments[s];return new t(e._context,...r)}}getVersionInfo(){return ia}constructor(t){this._rpc=t,this._options={},this.format=Z.WU,"string"==typeof this._rpc?this._rpcClient=new l.Dl(this._rpc):this._rpcClient=this._rpc,this._context=new io(t),this._wallet=new t5(this._context),this.setProvider({rpc:this._rpcClient}),this.batch=this._context.batch.batch.bind(this._context.batch)}}}}]);