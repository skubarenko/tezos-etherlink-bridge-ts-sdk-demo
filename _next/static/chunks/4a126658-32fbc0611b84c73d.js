"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[283],{55549:function(t,e,r){r.d(e,{cz:function(){return ea}});var i,n,a,s,c,o,l,p,u,f,g,m,h=r(41086);let d=Symbol("source_reference");class w extends h.WO{constructor(t,e,r){super(),this.src=t,this.idx=e,this.message=r,this.name="ScanError"}}(i=l||(l={}))[i.Comment=0]="Comment",i[i.Number=1]="Number",i[i.String=2]="String",i[i.Bytes=3]="Bytes",i[i.Ident=4]="Ident";let b=RegExp("\\s"),y=RegExp("[:@%_A-Za-z]"),E=RegExp("[@%_\\.A-Za-z0-9]"),P=/[0-9]/,A=/[0-9a-fA-F]/;function*v(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=0;for(;r<t.length;){for(;r<t.length&&b.test(t[r]);)r++;if(r===t.length)return;let i=t[r],n=r;if(y.test(i)){for(r++;r<t.length&&E.test(t[r]);)r++;yield{t:l.Ident,v:t.slice(n,r),first:n,last:r}}else if(t.length-r>1&&"0x"===t.substring(r,r+2)){for(r+=2;r<t.length&&A.test(t[r]);)r++;if((r-n&1)!=0)throw new w(t,r,"Bytes literal length is expected to be power of two");yield{t:l.Bytes,v:t.slice(n,r),first:n,last:r}}else if(P.test(i)||"-"===i){"-"===i&&r++;let e=r;for(;r<t.length&&P.test(t[r]);)r++;if(e===r)throw new w(t,r,"Number literal is too short");yield{t:l.Number,v:t.slice(n,r),first:n,last:r}}else if('"'===i){r++;let e=!1;for(;r<t.length&&(e||'"'!==t[r]);r++)e=!e&&"\\"===t[r];if(r===t.length)throw new w(t,r,"Unterminated string literal");r++,yield{t:l.String,v:t.slice(n,r),first:n,last:r}}else if("#"===i){for(r++;r<t.length&&"\n"!==t[r];)r++;e&&(yield{t:l.Comment,v:t.slice(n,r),first:n,last:r})}else if(t.length-r>1&&"/*"===t.substring(r,r+2)){for(r+=2;r<t.length&&!(t.length-r>1&&"*/"===t.substring(r,r+2));)r++;if(r===t.length)throw new w(t,r,"Unterminated C style comment");r+=2,e&&(yield{t:l.Comment,v:t.slice(n,r),first:n,last:r})}else if("("===i||")"===i||"{"===i||"}"===i||";"===i)r++,yield{t:i,v:i,first:n,last:r};else throw new w(t,r,"Invalid character at offset ".concat(r,": `").concat(i,"'"))}}let S=Symbol("ref_contract");(n=p||(p={})).Ps9mPmXa="Ps9mPmXaRzmzk35gbAYNCAw6UXdE2qoABTHbN2oEEc1qM7CwT9P",n.PtCJ7pwo="PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY",n.PsYLVpVv="PsYLVpVvgbLhAhoqAkMFUo6gudkJ9weNXhUYCiLDzcUpFpkk8Wt",n.PsddFKi3="PsddFKi32cMJ2qPjf43Qv5GDWLDPZb3T3bF6fLKiF5HtvHNU7aP",n.Pt24m4xi="Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd",n.PsBABY5H="PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU",n.PsBabyM1="PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS",n.PsCARTHA="PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb",n.PsDELPH1="PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo",n.PtEdoTez="PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq",n.PtEdo2Zk="PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA",n.PsFLorena="PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i",n.PtGRANADs="PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV",n.PtHangzH="PtHangzHogokSuiMHemCuowEavgYTP8J5qQ9fQS793MHYFpCY3r",n.PtHangz2="PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx",n.PsiThaCa="PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP",n.Psithaca2="Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A",n.PtJakarta="PtJakartaiDz69SfDDLXJSiuZqTSeSKRDbKVZC8MNzJnvRjvnGw",n.PtJakart2="PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY",n.PtKathman="PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg",n.PtLimaPtL="PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW",n.PtMumbaii="PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc",n.PtMumbai2="PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1",n.PtNairobi="PtNairobiyssHuh87hEhfVBGCVrK3WnS8Z2FT4ymB5tAa4r1nQf",n.ProxfordY="ProxfordYmVfjWnRcgjWH36fW6PArwqykTFzotUxRs6gmTcZDuH",n.ProtoALpha="ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK";let T=p.Psithaca2,_={Ps9mPmXaRzmzk35gbAYNCAw6UXdE2qoABTHbN2oEEc1qM7CwT9P:0,PtCJ7pwoxe8JasnHY8YonnLYjcVHmhiARPJvqcC6VfHT5s8k8sY:1,PsYLVpVvgbLhAhoqAkMFUo6gudkJ9weNXhUYCiLDzcUpFpkk8Wt:2,PsddFKi32cMJ2qPjf43Qv5GDWLDPZb3T3bF6fLKiF5HtvHNU7aP:3,Pt24m4xiPbLDhVgVfABUjirbmda3yohdN82Sp9FeuAXJ4eV9otd:4,PsBABY5HQTSkA4297zNHfsZNKtxULfL18y95qb3m53QJiXGmrbU:5,PsBabyM1eUXZseaJdmXFApDSBqj8YBfwELoxZHHW77EMcAbbwAS:5,PsCARTHAGazKbHtnKfLzQg3kms52kSRpgnDY982a9oYsSXRLQEb:6,PsDELPH1Kxsxt8f9eWbxQeRxkjfbxoqM52jvs5Y5fBxWWh4ifpo:7,PtEdoTezd3RHSC31mpxxo1npxFjoWWcFgQtxapi51Z8TLu6v6Uq:8,PtEdo2ZkT9oKpimTah6x2embF25oss54njMuPzkJTEi5RqfdZFA:8,PsFLorenaUUuikDWvMDr6fGBRG8kt3e3D3fHoXK1j1BFRxeSH4i:9,PtGRANADsDU8R9daYKAgWnQYAJ64omN1o3KMGVCykShA97vQbvV:10,PtHangzHogokSuiMHemCuowEavgYTP8J5qQ9fQS793MHYFpCY3r:11,PtHangz2aRngywmSRGGvrcTyMbbdpWdpFKuS4uMWxg2RaH9i1qx:11,PsiThaCaT47Zboaw71QWScM8sXeMM7bbQFncK9FLqYc6EKdpjVP:12,Psithaca2MLRFYargivpo7YvUr7wUDqyxrdhC5CQq78mRvimz6A:12,PtJakartaiDz69SfDDLXJSiuZqTSeSKRDbKVZC8MNzJnvRjvnGw:13,PtJakart2xVj7pYXJBXrqHgd82rdkLey5ZeeGwDgPp9rhQUbSqY:13,PtKathmankSpLLDALzWw7CGD2j2MtyveTwboEYokqUCP4a1LxMg:14,PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW:15,PtMumbaiiFFEGbew1rRjzSPyzRbA51Tm3RVZL5suHPxSZYDhCEc:16,PtMumbai2TmsJHNGRkD8v8YDbtao7BLUC3wjASn1inAKLFCjaH1:16,PtNairobiyssHuh87hEhfVBGCVrK3WnS8Z2FT4ymB5tAa4r1nQf:17,ProxfordYmVfjWnRcgjWH36fW6PArwqykTFzotUxRs6gmTcZDuH:19,ProtoALphaALphaALphaALphaALphaALphaALphaALphaDdp3zK:20};function I(t,e){return _[t]<_[e]}class C extends h.WO{constructor(t,e){super(),this.prim=t,this.message=e,this.name="MacroError"}}function x(t,e){var r,i;if(0===e&&void 0===t.args||(null===(r=t.args)||void 0===r?void 0:r.length)===e)return!0;throw new C(t,"macro ".concat(t.prim," expects ").concat(e," arguments, was given ").concat(null===(i=t.args)||void 0===i?void 0:i.length))}function N(t){if(void 0===t.annots)return!0;throw new C(t,"unexpected annotation on macro ".concat(t.prim,": ").concat(t.annots))}function O(t,e){if("int"in e)return!0;throw new C(t,"macro ".concat(t.prim," expects int argument"))}function R(t,e,r,i){let n,a,s=0,c=0,o=[null,null];if(0===e.length)throw new C(t,"unexpected end: ".concat(t.prim));let l=e[s++];switch(l){case"P":{let{r:a,n:o,an:l}=R(t,e.slice(s),r.slice(c),i);n=a,s+=o,c+=l;break}case"A":c!==r.length&&(o[0]=r[c++]);break;default:throw new C(t,"".concat(t.prim,": unexpected character: ").concat(l))}if(s===e.length)throw new C(t,"unexpected end: ".concat(t.prim));switch(l=e[s++]){case"P":{let{r:n,n:o,an:l}=R(t,e.slice(s),r.slice(c),i);a=n.map(t=>{let[e,r]=t;return[e+1,r]}),s+=o,c+=l;break}case"I":c!==r.length&&(o[1]=r[c++]);break;default:throw new C(t,"".concat(t.prim,": unexpected character: ").concat(l))}return{r:i(n,a,[0,o]),n:s,an:c}}function L(t,e,r,i){let n=e[0];switch(n){case"A":return e.length>1?[{prim:"DUP"},{prim:"DIP",args:[[{prim:"CAR",annots:["@%%"]},L(t,e.slice(1),[],i)]]},{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:["%@","%@",...r]}]:i.a;case"D":return e.length>1?[{prim:"DUP"},{prim:"DIP",args:[[{prim:"CDR",annots:["@%%"]},L(t,e.slice(1),[],i)]]},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@","%@",...r]}]:i.d;default:throw new C(t,"".concat(t.prim,": unexpected character: ").concat(n))}}function D(t){let e=[],r=[];if(void 0!==t)for(let i of t)(0!==i.length&&"%"===i[0]?e:r).push(i);return{fields:e,rest:r}}function k(t){let{prim:e,annots:r,args:i}=t;return Object.assign(Object.assign({prim:e},r&&{annots:r}),i&&{args:i})}let U=/^P[PAI]{3,}R$/,M=/^UNP[PAI]{2,}R$/,K=/^C[AD]{2,}R$/,H=/^SET_C[AD]+R$/,F=/^MAP_C[AD]+R$/,G=/^DI{2,}P$/,B=/^DU+P$/;class J extends h.WO{constructor(t,e){super(),this.token=t,this.message=e,this.name="MichelineParseError"}}class j extends h.WO{constructor(t,e){super(),this.node=t,this.message=e,this.name="JSONParseError"}}let Y=new J(null,"Unexpected EOF");function W(t){return t.t===l.Ident&&("@"===t.v[0]||"%"===t.v[0]||":"===t.v[0])}let z=RegExp("^-?[0-9]+$"),V=RegExp("^([0-9a-fA-F]{2})*$");class q{expand(t){var e,r,i,n;if((null===(e=this.opt)||void 0===e?void 0:e.expandGlobalConstant)!==void 0&&"constant"===t.prim){let e=(n=this.opt.expandGlobalConstant,void 0!==t.args&&1===t.args.length&&"string"in t.args[0]&&t.args[0].string in n?n[t.args[0].string]:t);return e!==t&&(e[d]=Object.assign(Object.assign({},t[d]||{first:0,last:0}),{globalConstant:t})),e}if((null===(r=this.opt)||void 0===r?void 0:r.expandMacros)!==void 0&&(null===(i=this.opt)||void 0===i||!i.expandMacros))return t;{let e=function(t,e){let r=(null==e?void 0:e.protocol)||T;function i(t){return void 0!==t?[{prim:"RENAME",annots:t}]:[]}switch(t.prim){case"CMPEQ":case"CMPNEQ":case"CMPLT":case"CMPGT":case"CMPLE":case"CMPGE":if(x(t,0))return[{prim:"COMPARE"},k({prim:t.prim.slice(3),annots:t.annots})];break;case"IFEQ":case"IFNEQ":case"IFLT":case"IFGT":case"IFLE":case"IFGE":if(x(t,2))return[{prim:t.prim.slice(2)},k({prim:"IF",annots:t.annots,args:t.args})];break;case"IFCMPEQ":case"IFCMPNEQ":case"IFCMPLT":case"IFCMPGT":case"IFCMPLE":case"IFCMPGE":if(x(t,2))return[{prim:"COMPARE"},{prim:t.prim.slice(5)},k({prim:"IF",annots:t.annots,args:t.args})];break;case"FAIL":if(x(t,0)&&N(t))return[{prim:"UNIT"},{prim:"FAILWITH"}];break;case"ASSERT":if(x(t,0)&&N(t))return[{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_EQ":case"ASSERT_NEQ":case"ASSERT_LT":case"ASSERT_GT":case"ASSERT_LE":case"ASSERT_GE":if(x(t,0)&&N(t))return[{prim:t.prim.slice(7)},{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_CMPEQ":case"ASSERT_CMPNEQ":case"ASSERT_CMPLT":case"ASSERT_CMPGT":case"ASSERT_CMPLE":case"ASSERT_CMPGE":if(x(t,0)&&N(t))return[[{prim:"COMPARE"},{prim:t.prim.slice(10)}],{prim:"IF",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_NONE":if(x(t,0)&&N(t))return[{prim:"IF_NONE",args:[[],[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_SOME":if(x(t,0))return[{prim:"IF_NONE",args:[[[{prim:"UNIT"},{prim:"FAILWITH"}]],i(t.annots)]}];break;case"ASSERT_LEFT":if(x(t,0))return[{prim:"IF_LEFT",args:[i(t.annots),[[{prim:"UNIT"},{prim:"FAILWITH"}]]]}];break;case"ASSERT_RIGHT":if(x(t,0))return[{prim:"IF_LEFT",args:[[[{prim:"UNIT"},{prim:"FAILWITH"}]],i(t.annots)]}];break;case"IF_SOME":if(x(t,2))return[k({prim:"IF_NONE",annots:t.annots,args:[t.args[1],t.args[0]]})];break;case"IF_RIGHT":if(x(t,2))return[k({prim:"IF_LEFT",annots:t.annots,args:[t.args[1],t.args[0]]})];break;case"CAR":case"CDR":if(void 0===t.args)return t;if(x(t,1)&&O(t,t.args[0])){let e=parseInt(t.args[0].int,10);return k({prim:"GET",args:[{int:"CAR"===t.prim?String(2*e+1):String(2*e)}],annots:t.annots})}}if(U.test(t.prim)&&x(t,0)){let{fields:e,rest:r}=D(t.annots),{r:i}=R(t,t.prim.slice(1),e,(t,e,r)=>[...t||[],...e||[],r]);return i.map((t,e)=>{let[n,a]=t,s=[...(function(t,e){let r=t.length;for(;r>0&&null===t[r-1];)r--;return t.slice(0,r)})(a,0).map(t=>null===t?"%":t),...0===n&&e===i.length-1?r:[]],c=k({prim:"PAIR",annots:0!==s.length?s:void 0});return 0===n?c:{prim:"DIP",args:1===n?[[c]]:[{int:String(n)},[c]]}})}if(M.test(t.prim)){if(I(r,p.PtEdo2Zk)&&x(t,0)){let{r:e}=R(t,t.prim.slice(3),t.annots||[],(t,e,r)=>[r,...e||[],...t||[]]);return e.map(t=>{let[e,r]=t,i=[{prim:"DUP"},k({prim:"CAR",annots:null!==r[0]?[r[0]]:void 0}),{prim:"DIP",args:[[k({prim:"CDR",annots:null!==r[1]?[r[1]]:void 0})]]}];return 0===e?i:{prim:"DIP",args:1===e?[[i]]:[{int:String(e)},[i]]}})}if("UNPAIR"===t.prim)return t;if(x(t,0)){let{r:e}=R(t,t.prim.slice(3),[],(t,e,r)=>[r,...e||[],...t||[]]);return e.map(t=>{let[e]=t,r=k({prim:"UNPAIR"});return 0===e?r:{prim:"DIP",args:1===e?[[r]]:[{int:String(e)},[r]]}})}}if(K.test(t.prim)&&x(t,0)){let e=[...t.prim.slice(1,t.prim.length-1)];return e.map((r,i)=>{let n=i===e.length-1?t.annots:void 0;switch(r){case"A":return k({prim:"CAR",annots:n});case"D":return k({prim:"CDR",annots:n});default:throw new C(t,"unexpected character: ".concat(r))}})}if(H.test(t.prim)&&x(t,0)){let{fields:e,rest:r}=D(t.annots);if(e.length>1)throw new C(t,"unexpected annotation on macro ".concat(t.prim,": ").concat(e));let i=0!==e.length?{a:[{prim:"DUP"},{prim:"CAR",annots:e},{prim:"DROP"},{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:[e[0],"%@"]}],d:[{prim:"DUP"},{prim:"CDR",annots:e},{prim:"DROP"},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@",e[0]]}]}:{a:[{prim:"CDR",annots:["@%%"]},{prim:"SWAP"},{prim:"PAIR",annots:["%","%@"]}],d:[{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@","%"]}]};return L(t,t.prim.slice(5,t.prim.length-1),r,i)}if(F.test(t.prim)&&x(t,1)){let{fields:e}=D(t.annots);if(e.length>1)throw new C(t,"unexpected annotation on macro ".concat(t.prim,": ").concat(e));let r={a:[{prim:"DUP"},{prim:"CDR",annots:["@%%"]},{prim:"DIP",args:[[k({prim:"CAR",annots:0!==e.length?["@"+e[0].slice(1)]:void 0}),t.args[0]]]},{prim:"SWAP"},{prim:"PAIR",annots:[0!==e.length?e[0]:"%","%@"]}],d:[{prim:"DUP"},k({prim:"CDR",annots:0!==e.length?["@"+e[0].slice(1)]:void 0}),t.args[0],{prim:"SWAP"},{prim:"CAR",annots:["@%%"]},{prim:"PAIR",annots:["%@",0!==e.length?e[0]:"%"]}]};return L(t,t.prim.slice(5,t.prim.length-1),[],r)}if(G.test(t.prim)&&x(t,1)){let e=0;for(;"I"===t.prim[1+e];)e++;return k({prim:"DIP",args:[{int:String(e)},t.args[0]]})}if(B.test(t.prim)){let e=0;for(;"U"===t.prim[1+e];)e++;if(I(r,p.PtEdo2Zk)){if(1===e){if(void 0===t.args)return t;x(t,1)&&O(t,t.args[0])&&(e=parseInt(t.args[0].int,10))}else x(t,0);return 1===e?[k({prim:"DUP",annots:t.annots})]:2===e?[{prim:"DIP",args:[[k({prim:"DUP",annots:t.annots})]]},{prim:"SWAP"}]:[{prim:"DIP",args:[{int:String(e-1)},[k({prim:"DUP",annots:t.annots})]]},{prim:"DIG",args:[{int:String(e)}]}]}if(1===e)return t;if(x(t,0))return k({prim:"DUP",args:[{int:String(e)}],annots:t.annots})}return t}(t,this.opt);return e!==t&&(e[d]=Object.assign(Object.assign({},t[d]||{first:0,last:0}),{macro:t})),e}}parseListExpr(t,e){var r;let i;let n={first:e.first,last:e.last},a="("===e.t;if(a){if((i=t.next()).done)throw Y;n.last=i.value.last}else i={value:e};if(i.value.t!==l.Ident)throw new J(i.value,"not an identifier: ".concat(i.value.v));let s={prim:i.value.v,[d]:n};for(;;){let e=t.next();if(e.done){if(a)throw Y;break}if(")"===e.value.t){if(!a)throw new J(e.value,"unexpected closing bracket");n.last=e.value.last;break}if(W(e.value))s.annots=s.annots||[],s.annots.push(e.value.v),n.last=e.value.last;else{s.args=s.args||[];let i=this.parseExpr(t,e.value);n.last=(null===(r=i[d])||void 0===r?void 0:r.last)||n.last,s.args.push(i)}}return this.expand(s)}parseArgs(t,e){var r;let i={first:e.first,last:e.last},n={prim:e.v,[d]:i};for(;;){let e=t.next();if(e.done||"}"===e.value.t||";"===e.value.t)return[n,e];if(W(e.value))i.last=e.value.last,n.annots=n.annots||[],n.annots.push(e.value.v);else{let a=this.parseExpr(t,e.value);i.last=(null===(r=a[d])||void 0===r?void 0:r.last)||i.last,n.args=n.args||[],n.args.push(a)}}}parseSequenceExpr(t,e){var r,i;let n={first:e.first,last:e.last},a=[];a[d]=n;let s="{"===e.t,c="{"===e.t?null:{value:e};for(;;){if(null!==c||(c=t.next()).done||(n.last=c.value.last),c.done){if(!s)return a;throw Y}if("}"===c.value.t){if(s)return a;throw new J(c.value,"unexpected closing bracket")}if(c.value.t===l.Ident){let[e,i]=this.parseArgs(t,c.value);n.last=(null===(r=e[d])||void 0===r?void 0:r.last)||n.last,a.push(this.expand(e)),c=i}else{let e=this.parseExpr(t,c.value);n.last=(null===(i=e[d])||void 0===i?void 0:i.last)||n.last,a.push(e),c=null}null!==c||(c=t.next()).done||(n.last=c.value.last),c.done||";"!==c.value.t||(c=null)}}parseExpr(t,e){switch(e.t){case l.Ident:return this.expand({prim:e.v,[d]:{first:e.first,last:e.last}});case l.Number:return{int:e.v,[d]:{first:e.first,last:e.last}};case l.String:return{string:JSON.parse(e.v),[d]:{first:e.first,last:e.last}};case l.Bytes:return{bytes:e.v.slice(2),[d]:{first:e.first,last:e.last}};case"{":return this.parseSequenceExpr(t,e);default:return this.parseListExpr(t,e)}}parseSequence(t){if("string"!=typeof t)throw TypeError("string type was expected, got ".concat(typeof t," instead"));let e=v(t),r=e.next();return r.done?null:this.parseSequenceExpr(e,r.value)}parseList(t){if("string"!=typeof t)throw TypeError("string type was expected, got ".concat(typeof t," instead"));let e=v(t),r=e.next();return r.done?null:this.parseListExpr(e,r.value)}parseMichelineExpression(t){if("string"!=typeof t)throw TypeError("string type was expected, got ".concat(typeof t," instead"));let e=v(t),r=e.next();return r.done?null:this.parseExpr(e,r.value)}parseScript(t){return this.parseSequence(t)}parseData(t){return this.parseList(t)}parseJSON(t){if("object"!=typeof t)throw TypeError("object type was expected, got ".concat(typeof t," instead"));if(Array.isArray(t)){let e=[];for(let r of t){if(null===r||"object"!=typeof r)throw new j(r,"unexpected sequence element: ".concat(r));e.push(this.parseJSON(r))}return e}if("prim"in t){if("string"==typeof t.prim&&(void 0===t.annots||Array.isArray(t.annots))&&(void 0===t.args||Array.isArray(t.args))){let e={prim:t.prim};if(void 0!==t.annots){for(let e of t.annots)if("string"!=typeof e)throw new j(e,"string expected: ".concat(e));e.annots=t.annots}if(void 0!==t.args)for(let r of(e.args=[],t.args)){if(null===r||"object"!=typeof r)throw new j(r,"unexpected argument: ".concat(r));e.args.push(this.parseJSON(r))}return this.expand(e)}throw new j(t,"malformed prim expression: ".concat(t))}if("string"in t){if("string"==typeof t.string)return{string:t.string};throw new j(t,"malformed string literal: ".concat(t))}if("int"in t){if("string"==typeof t.int&&z.test(t.int))return{int:t.int};throw new j(t,"malformed int literal: ".concat(t))}if("bytes"in t){if("string"==typeof t.bytes&&V.test(t.bytes))return{bytes:t.bytes};throw new j(t,"malformed bytes literal: ".concat(t))}throw new j(t,"unexpected object: ".concat(t))}constructor(t){this.opt=t}}let Q=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],Z=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998];class X extends h.WO{constructor(t){super(),this.message=t,this.name="Base58DecodingError"}}function $(t){let e=(t.length+9)%64;if(t.length>268435455)throw new h.f7("",": Invalid length ".concat(t.length," is too big -- SHA-256."));let r=t.length<<3,i=[...t,128,...Array(0===e?0:64-e).fill(0),0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r];function n(t,e){return t>>>e|t<<32-e}let a=[...Q],s=Array(64),c=Array(8);for(let t=0;t<i.length;t+=64){let e=t,r=0;for(;r<16;)s[r]=i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3],e+=4,r++;for(;r<64;){let t=n(s[r-15],7)^n(s[r-15],18)^s[r-15]>>>3,e=n(s[r-2],17)^n(s[r-2],19)^s[r-2]>>>10;s[r]=(0|e)+s[r-7]+t+s[r-16]|0,r++}for(let t=0;t<8;t++)c[t]=a[t];for(let t=0;t<64;t++){let e=n(c[0],2)^n(c[0],13)^n(c[0],22),r=n(c[4],6)^n(c[4],11)^n(c[4],25),i=c[7]+r+(c[4]&c[5]^~c[4]&c[6])+Z[t]+s[t]|0,a=e+(c[0]&c[1]^c[0]&c[2]^c[1]&c[2])|0;c[7]=c[6],c[6]=c[5],c[5]=c[4],c[4]=c[3]+i|0,c[3]=c[2],c[2]=c[1],c[1]=c[0],c[0]=i+a|0}for(let t=0;t<8;t++)a[t]=a[t]+c[t]|0}let o=[];for(let t of a)o.push(t>>24&255),o.push(t>>16&255),o.push(t>>8&255),o.push(255&t);return o}let tt=[0,1,2,3,4,5,6,7,8,-1,-1,-1,-1,-1,-1,-1,9,10,11,12,13,14,15,16,-1,17,18,19,20,21,-1,22,23,24,25,26,27,28,29,30,31,32,-1,-1,-1,-1,-1,-1,33,34,35,36,37,38,39,40,41,42,43,-1,44,45,46,47,48,49,50,51,52,53,54,55,56,57],te=[0,1,2,3,4,5,6,7,8,16,17,18,19,20,21,22,23,25,26,27,28,29,31,32,33,34,35,36,37,38,39,40,41,48,49,50,51,52,53,54,55,56,57,58,60,61,62,63,64,65,66,67,68,69,70,71,72,73];function tr(t,e){let r=t.charCodeAt(e)-49;if(r>=tt.length||-1===tt[r])throw new X("Unexpected character at position ".concat(e,": ").concat(t[e]));return tt[r]}function ti(t){let e=function(t){let e=[],r=0;for(;r<t.length&&0===tr(t,r);)r++;let i=r;for(;r<t.length;){let i=tr(t,r++),n=0;for(;0!==i||n<e.length;){let t=58*(e[n]||0)+i;e[n++]=t%256,i=Math.floor(t/256)}}for(;i-- >0;)e.push(0);return e.reverse()}(t);if(e.length<4)throw new X("Data is too short ".concat(e.length));let r=e.slice(0,e.length-4),i=e.slice(e.length-4),n=$($(r));if(i[0]!==n[0]||i[1]!==n[1]||i[2]!==n[2]||i[3]!==n[3])throw new X("Invalid checksum");return r}class tn extends h.Yy{constructor(t){super(),this.message=t,this.name="InvalidMichelsonError"}}class ta extends h.Yy{constructor(t){super(),this.message=t,this.name="InvalidTypeExpressionError"}}class ts extends h.Yy{constructor(t){super(),this.message=t,this.name="InvalidDataExpressionError"}}class tc extends h.Yy{constructor(t){super(),this.entrypoint=t,this.name="InvalidEntrypointError",this.message='Contract has no entrypoint named: "'.concat(t,'"')}}class to extends h.Yy{constructor(t){super(),this.message=t,this.name="TezosIdEncodeError"}}class tl extends h.WO{constructor(t){super(),this.message=t,this.name="LongIntegerError"}}class tp extends h.WO{constructor(t){super(),this.hexByte=t,this.name="HexParseError",this.message='Unable to parse hex byte "'.concat(t,'"')}}class tu extends h.WO{constructor(t,e){super(),this.val=t,this.message=e,this.name="MichelsonError"}}class tf extends tu{constructor(t,e,r){super(t,e),this.val=t,this.message=e,this.name="MichelsonTypeError",void 0!==r&&(this.data=r)}}class tg{append(t){let e=0;for(;0!==t||e<this.buf.length;){let r=10*(this.buf[e]||0)+t;this.buf[e++]=r%256,t=Math.floor(r/256)}}cmp(t){if(this.neg!==t.neg)return(t.neg?1:0)-(this.neg?1:0);{let e=0;if(this.buf.length!==t.buf.length)e=this.buf.length<t.buf.length?-1:1;else if(0!==this.buf.length){let r=t.buf.length-1;for(;r>=0&&this.buf[r]===t.buf[r];)r--;e=r<0?0:this.buf[r]<t.buf[r]?-1:1}return this.neg?0===e?0:-e:e}}get sign(){return 0===this.buf.length?0:this.neg?-1:1}constructor(t){if(this.neg=!1,this.buf=[],void 0===t)return;if("string"==typeof t)for(let e=0;e<t.length;e++){let r=t.charCodeAt(e);if(0===e&&45===r)this.neg=!0;else{if(r<48||r>57)throw new tl('unexpected character in integer constant "'.concat(t[e],'"'));this.append(r-48)}}else t<0?(this.neg=!0,this.append(-t)):this.append(t)}}function tm(t){let e=[];for(let r=0;r<t.length;r+=2){let i=parseInt(t.slice(r,r+2),16);if(Number.isNaN(i))return null;e.push(i)}return e}function th(t){try{return new tg(t),!0}catch(t){return!1}}function td(t){try{return new tg(t).sign>=0}catch(t){return!1}}let tw=/^(@%|@%%|%@|[@:%]([_0-9a-zA-Z][_0-9a-zA-Z.%@]*)?)$/;function tb(t,e){let r,i,n;if(Array.isArray(t))return{};if(void 0!==t.annots){for(let a of t.annots)if(0!==a.length){if(!tw.test(a)||!(null==e?void 0:e.specialVar)&&("@%"===a||"@%%"===a)||!(null==e?void 0:e.specialFields)&&"%@"===a)throw new tu(t,"".concat(t.prim,": unexpected annotation: ").concat(a));switch(a[0]){case"%":((null==e?void 0:e.emptyFields)||a.length>1)&&(r=r||[]).push(a);break;case":":a.length>1&&(i=i||[]).push(a);break;case"@":((null==e?void 0:e.emptyVar)||a.length>1)&&(n=n||[]).push(a)}}}return{f:r,t:i,v:n}}let ty={BlockHash:[32,[1,52]],OperationHash:[32,[5,116]],OperationListHash:[32,[133,233]],OperationListListHash:[32,[29,159,109]],ProtocolHash:[32,[2,170]],ContextHash:[32,[79,199]],ED25519PublicKeyHash:[20,[6,161,159]],SECP256K1PublicKeyHash:[20,[6,161,161]],P256PublicKeyHash:[20,[6,161,164]],ContractHash:[20,[2,90,121]],CryptoboxPublicKeyHash:[16,[153,103]],ED25519Seed:[32,[13,15,58,7]],ED25519PublicKey:[32,[13,15,37,217]],SECP256K1SecretKey:[32,[17,162,224,201]],P256SecretKey:[32,[16,81,238,189]],ED25519EncryptedSeed:[56,[7,90,60,179,41]],SECP256K1EncryptedSecretKey:[56,[9,237,241,174,150]],P256EncryptedSecretKey:[56,[9,48,57,115,171]],SECP256K1PublicKey:[33,[3,254,226,86]],P256PublicKey:[33,[3,178,139,127]],SECP256K1Scalar:[33,[38,248,136]],SECP256K1Element:[33,[5,92,0]],ED25519SecretKey:[64,[43,246,78,7]],ED25519Signature:[64,[9,245,205,134,18]],SECP256K1Signature:[64,[13,115,101,19,63]],P256Signature:[64,[54,240,44,52]],GenericSignature:[64,[4,130,43]],ChainID:[4,[87,82,0]],RollupAddress:[20,[1,128,120,31]]};function tE(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];let n=ti(t);for(let t of r){let[e,r]=ty[t];if(n.length===e+r.length){let e=0;for(;e<r.length&&n[e]===r[e];)e++;if(e===r.length)return[t,n.slice(r.length)]}}return null}function tP(t,e){let[r,i]=ty[t];if(e.length!==r)throw new to("Incorrect data length for ".concat(t,": ").concat(e.length));return function(t){let e=$($(t));return function(t){let e=[],r=0;for(;r<t.length&&0===t[r];)r++;let i=r;for(;r<t.length;){let i=t[r++],n=0;for(;0!==i||n<e.length;){let t=256*(e[n]||0)+i;e[n++]=t%58,i=Math.floor(t/58)}}for(;i-- >0;)e.push(0);return e.reverse(),String.fromCharCode(...e.map(t=>te[t]+49))}([...t,...e.slice(0,4)])}([...i,...e])}function tA(t,e){let r=Array.isArray(e)?e:e.args;return 2===r.length?"pair"===t?{prim:"pair",args:r}:{prim:"Pair",args:r}:Object.assign(Object.assign({},Array.isArray(e)?{prim:t}:e),{args:[r[0],{prim:t,args:r.slice(1)}]})}function tv(t){return Array.isArray(t)||"pair"===t.prim}function tS(t){return Array.isArray(t)||"prim"in t&&"Pair"===t.prim}let tT=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])[T ]([01][0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9]|60)(\.[0-9]+)?(Z|[+-]([01][0-9]|2[0-3]):([0-5][0-9]))$/;function t_(t){if("string"in t){if(td(t.string))return new Date(parseInt(t.string,10));if(tT.test(t.string)){let e=new Date(t.string);if(!Number.isNaN(e.valueOf))return e}}else if(th(t.int))return new Date(parseInt(t.int,10));return null}function tI(t){return t.map(t=>(t>>4&15).toString(16)+(15&t).toString(16)).join("")}let tC={ABS:!0,ADD:!0,ADDRESS:!0,AMOUNT:!0,AND:!0,APPLY:!0,BALANCE:!0,BLAKE2B:!0,CAR:!0,CDR:!0,CHAIN_ID:!0,CHECK_SIGNATURE:!0,COMPARE:!0,CONCAT:!0,CONS:!0,EDIV:!0,EQ:!0,EXEC:!0,FAILWITH:!0,GE:!0,GET_AND_UPDATE:!0,GT:!0,HASH_KEY:!0,IMPLICIT_ACCOUNT:!0,INT:!0,ISNAT:!0,JOIN_TICKETS:!0,KECCAK:!0,LE:!0,LEVEL:!0,LSL:!0,LSR:!0,LT:!0,MEM:!0,MUL:!0,NEG:!0,NEQ:!0,NEVER:!0,NOT:!0,NOW:!0,OR:!0,PACK:!0,PAIRING_CHECK:!0,READ_TICKET:!0,SAPLING_VERIFY_UPDATE:!0,SELF:!0,SELF_ADDRESS:!0,SENDER:!0,SET_DELEGATE:!0,SHA256:!0,SHA3:!0,SHA512:!0,SIZE:!0,SLICE:!0,SOME:!0,SOURCE:!0,SPLIT_TICKET:!0,SUB:!0,SWAP:!0,TICKET:!0,TICKET_DEPRECATED:!0,TOTAL_VOTING_POWER:!0,TRANSFER_TOKENS:!0,UNIT:!0,VOTING_POWER:!0,XOR:!0,RENAME:!0,OPEN_CHEST:!0,SUB_MUTEZ:!0,MIN_BLOCK_TIME:!0,BYTES:!0,NAT:!0},tx=Object.assign({},tC,{CONTRACT:!0,CREATE_CONTRACT:!0,DIG:!0,DIP:!0,DROP:!0,DUG:!0,DUP:!0,EMIT:!0,EMPTY_BIG_MAP:!0,EMPTY_MAP:!0,EMPTY_SET:!0,GET:!0,IF:!0,IF_CONS:!0,IF_LEFT:!0,IF_NONE:!0,ITER:!0,LAMBDA:!0,LAMBDA_REC:!0,LEFT:!0,LOOP:!0,LOOP_LEFT:!0,MAP:!0,NIL:!0,NONE:!0,PAIR:!0,PUSH:!0,RIGHT:!0,SAPLING_EMPTY_STATE:!0,UNPACK:!0,UNPAIR:!0,UPDATE:!0,CAST:!0,VIEW:!0}),tN={unit:!0,never:!0,bool:!0,int:!0,nat:!0,string:!0,chain_id:!0,bytes:!0,mutez:!0,key_hash:!0,key:!0,signature:!0,timestamp:!0,address:!0,tx_rollup_l2_address:!0},tO=Object.assign({},tN,{or:!0,pair:!0,set:!0,big_map:!0,contract:!0,lambda:!0,list:!0,map:!0,operation:!0,option:!0,bls12_381_g1:!0,bls12_381_g2:!0,bls12_381_fr:!0,sapling_transaction:!0,sapling_transaction_deprecated:!0,sapling_state:!0,ticket:!0,chest_key:!0,chest:!0});class tR extends tu{constructor(t,e){super(t,e),this.val=t,this.message=e,this.name="MichelsonValidationError"}}function tL(t){return"prim"in t}function tD(t){if(tL(t))return!0;throw new tR(t,"prim expression expected")}function tk(t){if(Array.isArray(t))return!0;throw new tR(t,"sequence expression expected")}function tU(t){if(Array.isArray(t)||"prim"in t)return!0;throw new tR(t,"prim or sequence expression expected")}function tM(t){if("-"===t.int[0])throw new tR(t,"natural number expected")}function tK(t){if("int"in t)return!0;throw new tR(t,"int literal expected")}function tH(t){if("string"in t)return!0;throw new tR(t,"string literal expected")}function tF(t,e){var r;if(0===e&&void 0===t.args||(null===(r=t.args)||void 0===r?void 0:r.length)===e)return!0;throw new tR(t,"".concat(e," arguments expected"))}function tG(t){var e,r;if(Array.isArray(t)){for(let e of t){if(!Array.isArray(e)&&!tL(e))throw new tR(t,"sequence or prim expected");tG(e)}return!0}if(tD(t)){if(Object.prototype.hasOwnProperty.call(tC,t.prim))return tF(t,0),!0;switch(t.prim){case"DROP":case"PAIR":case"UNPAIR":case"DUP":case"UPDATE":case"GET":void 0!==t.args&&tF(t,1)&&tK(t.args[0])&&tM(t.args[0]);break;case"DIG":case"DUG":case"SAPLING_EMPTY_STATE":tF(t,1)&&tK(t.args[0])&&tM(t.args[0]);break;case"NONE":case"LEFT":case"RIGHT":case"NIL":case"CAST":tF(t,1)&&tQ(t.args[0]);break;case"UNPACK":tF(t,1)&&tJ(t.args[0]);break;case"CONTRACT":tF(t,1)&&tW(t.args[0]);break;case"IF_NONE":case"IF_LEFT":case"IF_CONS":case"IF":tF(t,2)&&(tk(t.args[0])&&tG(t.args[0]),tk(t.args[1])&&tG(t.args[1]));break;case"MAP":case"ITER":case"LOOP":case"LOOP_LEFT":tF(t,1)&&tG(t.args[0]);break;case"CREATE_CONTRACT":tF(t,1)&&t$(t.args[0]);break;case"DIP":if((null===(e=t.args)||void 0===e?void 0:e.length)===2)tK(t.args[0])&&tM(t.args[0]),tk(t.args[1])&&tG(t.args[1]);else if((null===(r=t.args)||void 0===r?void 0:r.length)===1)tk(t.args[0])&&tG(t.args[0]);else throw new tR(t,"1 or 2 arguments expected");break;case"PUSH":tF(t,2)&&(tj(t.args[0]),tX(t.args[1]));break;case"EMPTY_SET":tF(t,1)&&tB(t.args[0]);break;case"EMPTY_MAP":tF(t,2)&&(tB(t.args[0]),tQ(t.args[1]));break;case"EMPTY_BIG_MAP":tF(t,2)&&(tB(t.args[0]),tz(t.args[1]));break;case"LAMBDA_REC":case"LAMBDA":tF(t,3)&&(tQ(t.args[0]),tQ(t.args[1]),tk(t.args[2])&&tG(t.args[2]));break;case"VIEW":tF(t,2)&&(tH(t.args[0])&&tq(t.args[0]),tQ(t.args[1])&&tj(t.args[1]));break;case"EMIT":t.args&&t.args.length>0?tF(t,1):tF(t,0);break;default:throw new tR(t,"instruction expected")}}return!0}function tB(t){if(tU(t)){if(Array.isArray(t)||"pair"===t.prim||"or"===t.prim||"option"===t.prim)tZ(t,t=>tB(t));else if(!Object.prototype.hasOwnProperty.call(tN,t.prim))throw new tR(t,"".concat(t.prim,": type is not comparable"))}return!0}function tJ(t){if(tU(t)&&tL(t)){if(!Object.prototype.hasOwnProperty.call(tO,t.prim)||"big_map"===t.prim||"operation"===t.prim||"sapling_state"===t.prim||"ticket"===t.prim)throw new tR(t,"".concat(t.prim,": type can't be used inside PACK/UNPACK instructions"));tZ(t,t=>tJ(t))}return!0}function tj(t){if(tU(t)&&tL(t)){if(!Object.prototype.hasOwnProperty.call(tO,t.prim)||"big_map"===t.prim||"operation"===t.prim||"sapling_state"===t.prim||"ticket"===t.prim||"contract"===t.prim)throw new tR(t,"".concat(t.prim,": type can't be pushed"));tZ(t,t=>tj(t))}return!0}function tY(t){if(tU(t)&&tL(t)){if(!Object.prototype.hasOwnProperty.call(tO,t.prim)||"operation"===t.prim||"contract"===t.prim)throw new tR(t,"".concat(t.prim,": type can't be used as part of a storage"));tZ(t,t=>tY(t))}return!0}function tW(t){if(tU(t)&&tL(t)){if(!Object.prototype.hasOwnProperty.call(tO,t.prim)||"operation"===t.prim)throw new tR(t,"".concat(t.prim,": type can't be used as part of a parameter"));tZ(t,t=>tW(t))}return!0}function tz(t){if(tU(t)&&tL(t)){if(!Object.prototype.hasOwnProperty.call(tO,t.prim)||"big_map"===t.prim||"operation"===t.prim||"sapling_state"===t.prim)throw new tR(t,"".concat(t.prim,": type can't be used inside a big_map"));tZ(t,t=>tz(t))}return!0}let tV=RegExp("^[a-zA-Z0-9_.%@]*$");function tq(t){if(t.string.length>31)throw new tR(t,"view name too long: ".concat(t.string));if(!tV.test(t.string))throw new tR(t,"invalid character(s) in view name: ".concat(t.string))}function tQ(t){if(tU(t)&&tL(t)){if(!Object.prototype.hasOwnProperty.call(tO,t.prim))throw new tR(t,"type expected");tZ(t,t=>tQ(t))}return!0}function tZ(t,e){if(Array.isArray(t)||"pair"===t.prim){let r=Array.isArray(t)?t:t.args;if(void 0===r||r.length<2)throw new tR(t,"at least 2 arguments expected");return r.forEach(t=>{tU(t)&&e(t)}),!0}switch(t.prim){case"option":case"list":tF(t,1)&&tU(t.args[0])&&e(t.args[0]);break;case"contract":tF(t,1)&&tW(t.args[0]);break;case"or":tF(t,2)&&tU(t.args[0])&&tU(t.args[1])&&(e(t.args[0]),e(t.args[1]));break;case"lambda":tF(t,2)&&(tQ(t.args[0]),tQ(t.args[1]));break;case"set":tF(t,1)&&tB(t.args[0]);break;case"map":tF(t,2)&&tU(t.args[0])&&tU(t.args[1])&&(tB(t.args[0]),e(t.args[1]));break;case"big_map":tF(t,2)&&tU(t.args[0])&&tU(t.args[1])&&(tB(t.args[0]),tz(t.args[1]),e(t.args[1]));break;case"ticket":tF(t,1)&&tU(t.args[0])&&tB(t.args[0]);break;case"sapling_state":case"sapling_transaction":tF(t,1)&&tK(t.args[0]);break;default:tF(t,0)}return!0}function tX(t){if("int"in t||"string"in t||"bytes"in t)return!0;if(Array.isArray(t)){let e=0;for(let r of t)tL(r)&&"Elt"===r.prim?(tF(r,2)&&(tX(r.args[0]),tX(r.args[1])),e++):tX(r);if(0!==e&&e!==t.length)throw new tR(t,"data entries and map elements can't be intermixed");return!0}if(tL(t))switch(t.prim){case"Unit":case"True":case"False":case"None":tF(t,0);break;case"Pair":if(void 0===t.args||t.args.length<2)throw new tR(t,"at least 2 arguments expected");for(let e of t.args)tX(e);break;case"Left":case"Right":case"Some":tF(t,1)&&tX(t.args[0]);break;case"Lambda_rec":t.args&&tG(t.args);break;default:if(Object.prototype.hasOwnProperty.call(tx,t.prim))tG(t);else throw new tR(t,"data entry or instruction expected")}else throw new tR(t,"data entry expected");return!0}function t$(t){if(tk(t)){let e={},r={};for(let i of t)if(tD(i)){if("view"!==i.prim){if(i.prim in e)throw new tR(t,"duplicate contract section: ".concat(i.prim));e[i.prim]=!0}switch(i.prim){case"code":tF(i,1)&&tk(i.args[0])&&tG(i.args[0]);break;case"parameter":if(tF(i,1)&&tW(i.args[0]),i.annots)throw new tR(i,"Annotation must be part of the parameter type");break;case"storage":tF(i,1)&&tY(i.args[0]);break;case"view":if(tF(i,4)){if(tH(i.args[0])){let e=i.args[0];if(e.string in r)throw new tR(t,"duplicate view name: ".concat(e.string));r[e.string]=!0,tq(e)}tj(i.args[1]),tj(i.args[2]),tk(i.args[3])&&tG(i.args[3])}break;default:throw new tR(t,"unexpected contract section: ".concat(i.prim))}}}return!0}function t0(t){return Object.prototype.hasOwnProperty.call(tx,t.prim)}function t1(t){if(!Array.isArray(t))return!1;for(let e of t)if("prim"in e){if(t0(e))throw new tu(t,"Instruction outside of a lambda: ".concat(JSON.stringify(t)));if("Elt"===e.prim)throw new tu(t,"Elt item outside of a map literal: ".concat(JSON.stringify(t)))}return!0}"function"==typeof SuppressedError&&SuppressedError;let t2=Object.assign({},...["parameter","storage","code","False","Elt","Left","None","Pair","Right","Some","True","Unit","PACK","UNPACK","BLAKE2B","SHA256","SHA512","ABS","ADD","AMOUNT","AND","BALANCE","CAR","CDR","CHECK_SIGNATURE","COMPARE","CONCAT","CONS","CREATE_ACCOUNT","CREATE_CONTRACT","IMPLICIT_ACCOUNT","DIP","DROP","DUP","EDIV","EMPTY_MAP","EMPTY_SET","EQ","EXEC","FAILWITH","GE","GET","GT","HASH_KEY","IF","IF_CONS","IF_LEFT","IF_NONE","INT","LAMBDA","LE","LEFT","LOOP","LSL","LSR","LT","MAP","MEM","MUL","NEG","NEQ","NIL","NONE","NOT","NOW","OR","PAIR","PUSH","RIGHT","SIZE","SOME","SOURCE","SENDER","SELF","STEPS_TO_QUOTA","SUB","SWAP","TRANSFER_TOKENS","SET_DELEGATE","UNIT","UPDATE","XOR","ITER","LOOP_LEFT","ADDRESS","CONTRACT","ISNAT","CAST","RENAME","bool","contract","int","key","key_hash","lambda","list","map","big_map","nat","option","or","pair","set","signature","string","bytes","mutez","timestamp","unit","operation","address","SLICE","DIG","DUG","EMPTY_BIG_MAP","APPLY","chain_id","CHAIN_ID","LEVEL","SELF_ADDRESS","never","NEVER","UNPAIR","VOTING_POWER","TOTAL_VOTING_POWER","KECCAK","SHA3","PAIRING_CHECK","bls12_381_g1","bls12_381_g2","bls12_381_fr","sapling_state","sapling_transaction_deprecated","SAPLING_EMPTY_STATE","SAPLING_VERIFY_UPDATE","ticket","TICKET_DEPRECATED","READ_TICKET","SPLIT_TICKET","JOIN_TICKETS","GET_AND_UPDATE","chest","chest_key","OPEN_CHEST","VIEW","view","constant","SUB_MUTEZ","tx_rollup_l2_address","MIN_BLOCK_TIME","sapling_transaction","EMIT","Lambda_rec","LAMBDA_REC","TICKET","BYTES","NAT"].map((t,e)=>({[t]:e})));(a=u||(u={}))[a.Int=0]="Int",a[a.String=1]="String",a[a.Sequence=2]="Sequence",a[a.Prim0=3]="Prim0",a[a.Prim0Annot=4]="Prim0Annot",a[a.Prim1=5]="Prim1",a[a.Prim1Annot=6]="Prim1Annot",a[a.Prim2=7]="Prim2",a[a.Prim2Annot=8]="Prim2Annot",a[a.Prim=9]="Prim",a[a.Bytes=10]="Bytes";class t5{get length(){return this.buffer.length}writeBytes(t){this.buffer.push(...t.map(t=>255&t))}writeUint8(t){this.buffer.push(255&(0|t))}writeUint16(t){let e=0|t;this.buffer.push(e>>8&255),this.buffer.push(255&e)}writeUint32(t){let e=0|t;this.buffer.push(e>>24&255),this.buffer.push(e>>16&255),this.buffer.push(e>>8&255),this.buffer.push(255&e)}writeInt8(t){this.writeUint8(t)}writeInt16(t){this.writeUint16(t)}writeInt32(t){this.writeUint32(t)}constructor(){this.buffer=[]}}let t3=Error("bounds out of range");class t6{get length(){return this.cap-this.idx}readBytes(t){if(this.cap-this.idx<t)throw t3;let e=this.buffer.slice(this.idx,this.idx+t);return this.idx+=t,e}reader(t){if(this.cap-this.idx<t)throw t3;let e=new t6(this.buffer,this.idx,this.idx+t);return this.idx+=t,e}copy(){return new t6(this.buffer,this.idx,this.cap)}readUint8(){if(this.cap-this.idx<1)throw t3;return this.buffer[this.idx++]>>>0}readUint16(){if(this.cap-this.idx<2)throw t3;return(this.buffer[this.idx++]<<8|this.buffer[this.idx++])>>>0}readUint32(){if(this.cap-this.idx<4)throw t3;let t=this.buffer[this.idx++];return(t<<24|this.buffer[this.idx++]<<16|this.buffer[this.idx++]<<8|this.buffer[this.idx++])>>>0}readInt8(){if(this.cap-this.idx<1)throw t3;return this.buffer[this.idx++]<<24>>24}readInt16(){if(this.cap-this.idx<2)throw t3;return(this.buffer[this.idx++]<<8|this.buffer[this.idx++])<<16>>16}readInt32(){if(this.cap-this.idx<4)throw t3;let t=this.buffer[this.idx++];return t<<24|this.buffer[this.idx++]<<16|this.buffer[this.idx++]<<8|this.buffer[this.idx++]}constructor(t,e=0,r=t.length){this.buffer=t,this.idx=e,this.cap=r}}function t8(t){let e;let r=t.readUint8();switch(r){case g.ED25519:e="ED25519PublicKeyHash";break;case g.SECP256K1:e="SECP256K1PublicKeyHash";break;case g.P256:e="P256PublicKeyHash";break;default:throw Error("unknown public key hash tag: ".concat(r))}return{type:e,hash:t.readBytes(20)}}function t4(t){let e;let r=t.readUint8();switch(r){case f.Implicit:e=t8(t);break;case f.Originated:e={type:"ContractHash",hash:t.readBytes(20)},t.readBytes(1);break;default:throw Error("unknown address tag: ".concat(r))}if(0!==t.length){let r=new TextDecoder;e.entryPoint=r.decode(new Uint8Array(t.readBytes(t.length)))}return e}function t9(t,e){let r;switch(t.type){case"ED25519PublicKeyHash":r=g.ED25519;break;case"SECP256K1PublicKeyHash":r=g.SECP256K1;break;case"P256PublicKeyHash":r=g.P256;break;default:throw Error("unexpected address type: ".concat(t.type))}e.writeUint8(r),e.writeBytes(Array.from(t.hash))}function t7(t){let e,r;let i=t.readUint8();switch(i){case m.ED25519:r="ED25519PublicKey",e=32;break;case m.SECP256K1:r="SECP256K1PublicKey",e=33;break;case m.P256:r="P256PublicKey",e=33;break;default:throw Error("unknown public key tag: ".concat(i))}return{type:r,publicKey:t.readBytes(e)}}(s=f||(f={}))[s.Implicit=0]="Implicit",s[s.Originated=1]="Originated",(c=g||(g={}))[c.ED25519=0]="ED25519",c[c.SECP256K1=1]="SECP256K1",c[c.P256=2]="P256",(o=m||(m={}))[o.ED25519=0]="ED25519",o[o.SECP256K1=1]="SECP256K1",o[o.P256=2]="P256";let et=t=>"prim"in t&&("Left"===t.prim||"Right"===t.prim),ee=t=>"prim"in t&&("Some"===t.prim||"None"===t.prim),er=t=>{if(tv(t))return e=>{if(!tS(e))throw new tf(t,"pair expected: ".concat(JSON.stringify(e)),e);t1(e);let r=tA("pair",t);return[tA("Pair",e),function*(){for(let t of r.args)yield er(t)}()]};switch(t.prim){case"or":return e=>{if(!et(e))throw new tf(t,"or expected: ".concat(JSON.stringify(e)),e);return[e,function*(){yield er(t.args["Left"===e.prim?0:1])}()]};case"option":return e=>{if(!ee(e))throw new tf(t,"option expected: ".concat(JSON.stringify(e)),e);return[e,function*(){"Some"===e.prim&&(yield er(t.args[0]))}()]};case"list":case"set":return e=>{if(!Array.isArray(e))throw new tf(t,"".concat(t.prim," expected: ").concat(JSON.stringify(e)),e);return[e,function*(){for(let r of e)yield er(t.args[0])}()]};case"map":return e=>{if(!Array.isArray(e))throw new tf(t,"map expected: ".concat(JSON.stringify(e)),e);return[e,function*(){for(let r of e)yield e=>{if(!("prim"in e)||"Elt"!==e.prim)throw new tf(t,"map element expected: ".concat(JSON.stringify(e)),e);return[e,function*(){for(let e of t.args)yield er(e)}()]}}()]};case"chain_id":return e=>{let r;if(!("bytes"in e)&&!("string"in e))throw new tf(t,"chain id expected: ".concat(JSON.stringify(e)),e);if("string"in e){let i=tE(e.string,"ChainID");if(null===i)throw new tf(t,"chain id base58 expected: ".concat(e.string),e);r={bytes:tI(i[1])}}else r=e;return[r,[][Symbol.iterator]()]};case"signature":return e=>{let r;if(!("bytes"in e)&&!("string"in e))throw new tf(t,"signature expected: ".concat(JSON.stringify(e)),e);if("string"in e){let i=tE(e.string,"ED25519Signature","SECP256K1Signature","P256Signature","GenericSignature");if(null===i)throw new tf(t,"signature base58 expected: ".concat(e.string),e);r={bytes:tI(i[1])}}else r=e;return[r,[][Symbol.iterator]()]};case"key_hash":return e=>{let r;if(!("bytes"in e)&&!("string"in e))throw new tf(t,"key hash expected: ".concat(JSON.stringify(e)),e);if("string"in e){let i=tE(e.string,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash");if(null===i)throw new tf(t,"key hash base58 expected: ".concat(e.string),e);let n=new t5;t9({type:i[0],hash:i[1]},n),r={bytes:tI(n.buffer)}}else r=e;return[r,[][Symbol.iterator]()]};case"key":return e=>{let r;if(!("bytes"in e)&&!("string"in e))throw new tf(t,"public key expected: ".concat(JSON.stringify(e)),e);if("string"in e){let i=tE(e.string,"ED25519PublicKey","SECP256K1PublicKey","P256PublicKey");if(null===i)throw new tf(t,"public key base58 expected: ".concat(e.string),e);let n=new t5;!function(t,e){let r;switch(t.type){case"ED25519PublicKey":r=m.ED25519;break;case"SECP256K1PublicKey":r=m.SECP256K1;break;case"P256PublicKey":r=m.P256;break;default:throw Error("unexpected public key type: ".concat(t.type))}e.writeUint8(r),e.writeBytes(Array.from(t.publicKey))}({type:i[0],publicKey:i[1]},n),r={bytes:tI(n.buffer)}}else r=e;return[r,[][Symbol.iterator]()]};case"address":return e=>{let r;if(!("bytes"in e)&&!("string"in e))throw new tf(t,"address expected: ".concat(JSON.stringify(e)),e);if("string"in e){let i=e.string.split("%"),n=tE(i[0],"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash","ContractHash");if(null===n)throw new tf(t,"address base58 expected: ".concat(e.string),e);let a=new t5;!function(t,e){if("ContractHash"===t.type?(e.writeUint8(f.Originated),e.writeBytes(Array.from(t.hash)),e.writeUint8(0)):(e.writeUint8(f.Implicit),t9(t,e)),void 0!==t.entryPoint&&""!==t.entryPoint&&"default"!==t.entryPoint){let r=new TextEncoder().encode(t.entryPoint);e.writeBytes(Array.from(r))}}({type:n[0],hash:n[1],entryPoint:i.length>1?i[1]:void 0},a),r={bytes:tI(a.buffer)}}else r=e;return[r,[][Symbol.iterator]()]};case"timestamp":return e=>{let r;if(!("string"in e)&&!("int"in e))throw new tf(t,"timestamp expected: ".concat(JSON.stringify(e)),e);if("string"in e){let i=t_(e);if(null===i)throw new tf(t,"can't parse date: ".concat(e.string),e);r={int:String(Math.floor(i.getTime()/1e3))}}else r=e;return[r,[][Symbol.iterator]()]};default:return en}},ei=t=>"prim"in t&&"PUSH"===t.prim,en=t=>ei(t)?(tG(t),[t,function*(){yield en,yield er(t.args[0])}()]):[t,function*(){for(;;)yield en}()];function ea(t,e){return{bytes:tI(function(t,e){let r=new t5;return r.writeUint8(5),!function t(e,r,i){var n,a;let[s,c]=i(e);if(Array.isArray(s)){let e=new t5;for(let r of s){let i=c.next();if(i.done)throw Error("REPORT ME: iterator is done");t(r,e,i.value)}r.writeUint8(u.Sequence),r.writeUint32(e.length),r.writeBytes(e.buffer);return}if("string"in s){let t=new TextEncoder().encode(s.string);r.writeUint8(u.String),r.writeUint32(t.length),r.writeBytes(Array.from(t));return}if("int"in s){r.writeUint8(u.Int);let t=BigInt(s.int),e=t<0;e&&(t=-t);let i=0;do{let n=0===i?BigInt(6):BigInt(7),a=t&(BigInt(1)<<n)-BigInt(1);(t>>=n)&&(a|=BigInt(128)),0===i&&e&&(a|=BigInt(64)),r.writeUint8(Number(a)),i++}while(t);return}if("bytes"in s){let t=function(t){let e=[];for(let r=0;r<t.length;r+=2){let i=t.slice(r,r+2),n=parseInt(i,16);if(Number.isNaN(n))throw new tp(i);e.push(n)}return e}(s.bytes);r.writeUint8(u.Bytes),r.writeUint32(t.length),r.writeBytes(t);return}let o=t2[s.prim];if(void 0===o)throw TypeError("Can't encode primary: ".concat(s.prim));let l=3>((null===(n=s.args)||void 0===n?void 0:n.length)||0)?u.Prim0+2*((null===(a=s.args)||void 0===a?void 0:a.length)||0)+(void 0===s.annots||0===s.annots.length?0:1):u.Prim;if(r.writeUint8(l),r.writeUint8(o),void 0!==s.args){if(s.args.length<3)for(let e of s.args){let i=c.next();if(i.done)throw Error("REPORT ME: iterator is done");t(e,r,i.value)}else{let e=new t5;for(let r of s.args){let i=c.next();if(i.done)throw Error("REPORT ME: iterator is done");t(r,e,i.value)}r.writeUint32(e.length),r.writeBytes(e.buffer)}}if(void 0!==s.annots&&0!==s.annots.length){let t=new TextEncoder().encode(s.annots.join(" "));r.writeUint32(t.length),r.writeBytes(Array.from(t))}else void 0!==s.args&&s.args.length>=3&&r.writeUint32(0)}(t,r,void 0!==e?er(e):en),r.buffer}(t,e))}}let es=t=>{if(tv(t))return[e=>{if(!tS(e))throw new tf(t,"pair expected: ".concat(JSON.stringify(e)),e);let r=tA("pair",t);return function*(){for(let t of r.args)yield es(t)}()},t=>t];switch(t.prim){case"or":return[e=>{if(!et(e))throw new tf(t,"or expected: ".concat(JSON.stringify(e)),e);return function*(){yield es(t.args["Left"===e.prim?0:1])}()},t=>t];case"option":return[e=>{if(!ee(e))throw new tf(t,"option expected: ".concat(JSON.stringify(e)),e);return function*(){"Some"===e.prim&&(yield es(t.args[0]))}()},t=>t];case"list":case"set":return[e=>{if(!Array.isArray(e))throw new tf(t,"".concat(t.prim," expected: ").concat(JSON.stringify(e)),e);return function*(){for(;;)yield es(t.args[0])}()},t=>t];case"map":return[e=>{if(!Array.isArray(e))throw new tf(t,"map expected: ".concat(JSON.stringify(e)),e);return function*(){for(;;)yield[e=>{if(!("prim"in e)||"Elt"!==e.prim)throw new tf(t,"map element expected: ".concat(JSON.stringify(e)),e);return function*(){for(let e of t.args)yield es(e)}()},t=>t]}()},t=>t];case"chain_id":return[()=>[][Symbol.iterator](),e=>{if(!("bytes"in e)&&!("string"in e))throw new tf(t,"chain id expected: ".concat(JSON.stringify(e)),e);if("string"in e)return e;let r=tm(e.bytes);if(null===r)throw new tf(t,"can't parse bytes: ".concat(e.bytes),e);return{string:tP("ChainID",r)}}];case"signature":return[()=>[][Symbol.iterator](),e=>{if(!("bytes"in e)&&!("string"in e))throw new tf(t,"signature expected: ".concat(JSON.stringify(e)),e);if("string"in e)return e;let r=tm(e.bytes);if(null===r)throw new tf(t,"can't parse bytes: ".concat(e.bytes),e);return{string:tP("GenericSignature",r)}}];case"key_hash":return[()=>[][Symbol.iterator](),e=>{if(!("bytes"in e)&&!("string"in e))throw new tf(t,"key hash expected: ".concat(JSON.stringify(e)),e);if("string"in e)return e;let r=tm(e.bytes);if(null===r)throw new tf(t,"can't parse bytes: ".concat(e.bytes),e);let i=t8(new t6(new Uint8Array(r)));return{string:tP(i.type,i.hash)+(i.entryPoint?"%"+i.entryPoint:"")}}];case"key":return[()=>[][Symbol.iterator](),e=>{if(!("bytes"in e)&&!("string"in e))throw new tf(t,"public key expected: ".concat(JSON.stringify(e)),e);if("string"in e)return e;let r=tm(e.bytes);if(null===r)throw new tf(t,"can't parse bytes: ".concat(e.bytes),e);let i=t7(new t6(new Uint8Array(r)));return{string:tP(i.type,i.publicKey)}}];case"address":return[()=>[][Symbol.iterator](),e=>{if(!("bytes"in e)&&!("string"in e))throw new tf(t,"address expected: ".concat(JSON.stringify(e)),e);if("string"in e)return e;let r=tm(e.bytes);if(null===r)throw new tf(t,"can't parse bytes: ".concat(e.bytes),e);let i=t4(new t6(new Uint8Array(r)));return{string:tP(i.type,i.hash)+(i.entryPoint?"%"+i.entryPoint:"")}}];case"timestamp":return[()=>[][Symbol.iterator](),e=>{if(!("int"in e)&&!("string"in e))throw new tf(t,"address expected: ".concat(JSON.stringify(e)),e);return"string"in e?e:{string:new Date(1e3*parseInt(e.int,10)).toISOString().slice(0,19)+"Z"}}];default:return ec}},ec=[t=>ei(t)?(tG(t),function*(){yield ec,yield es(t.args[0])}()):function*(){for(;;)yield ec}(),t=>t];class eo extends tu{constructor(t,e,r){super(t,r),this.val=t,this.stackState=e,this.message=r,this.name="MichelsonInstructionError"}}function el(t){return Array.isArray(t)?"pair":t.prim}function ep(t){return"prim"in t?t.args:t}function eu(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(el(t)!==el(e))throw new tf(t,"types mismatch: ".concat(el(t)," != ").concat(el(e)),void 0);let i=[tb(t),tb(e)];if(i[0].t&&i[1].t&&i[0].t[0]!==i[1].t[0])throw new tf(t,"".concat(el(t),": type names mismatch: ").concat(i[0].t[0]," != ").concat(i[1].t[0]),void 0);if(r&&i[0].f&&i[1].f&&i[0].f[0]!==i[1].f[0])throw new tf(t,"".concat(el(t),": field names mismatch: ").concat(i[0].f[0]," != ").concat(i[1].f),void 0);if(tv(t)){let r=tA("pair",t),i=tA("pair",e);eu(r.args[0],i.args[0],!0),eu(r.args[1],i.args[1],!0);return}switch(t.prim){case"option":case"list":case"contract":case"set":case"ticket":eu(t.args[0],e.args[0]);break;case"or":eu(t.args[0],e.args[0],!0),eu(t.args[1],e.args[1],!0);break;case"lambda":case"map":case"big_map":eu(t.args[0],e.args[0]),eu(t.args[1],e.args[1]);break;case"sapling_state":case"sapling_transaction":if(parseInt(t.args[0].int,10)!==parseInt(e.args[0].int,10))throw new tf(t,"".concat(el(t),": type argument mismatch: ").concat(t.args[0].int," != ").concat(e.args[0].int),void 0)}}function ef(t,e){if(t.length!==e.length)throw new tf(t,"stack length mismatch: ".concat(t.length," != ").concat(e.length),void 0);for(let r=0;r<t.length;r++)eu(t[r],e[r])}function eg(t){var e,r,i;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Array.isArray(t)){let a=tb(t);if(((null===(e=a.t)||void 0===e?void 0:e.length)||0)>1)throw new tf(t,"".concat(t.prim,": at most one type annotation allowed: ").concat(t.annots),void 0);if(n){if(((null===(r=a.f)||void 0===r?void 0:r.length)||0)>1)throw new tf(t,"".concat(t.prim,": at most one field annotation allowed: ").concat(t.annots),void 0)}else if(((null===(i=a.f)||void 0===i?void 0:i.length)||0)>0)throw new tf(t,"".concat(t.prim,": field annotations aren't allowed: ").concat(t.annots),void 0)}if(tv(t)){for(let e of ep(t))eg(e,!0);return}switch(t.prim){case"option":case"list":case"contract":case"set":eg(t.args[0]);break;case"or":for(let e of t.args)eg(e,!0);break;case"lambda":case"map":case"big_map":eg(t.args[0]),eg(t.args[1])}}function em(t,e,r){if(tv(e)){if(tS(t)){t1(t);let i=tA("Pair",t),n=tA("pair",e);em(i.args[0],n.args[0],r),em(i.args[1],n.args[1],r);return}throw new tf(e,"pair expected: ".concat(JSON.stringify(t)),t)}switch(e.prim){case"int":if("int"in t&&th(t.int))return;throw new tf(e,"integer value expected: ".concat(JSON.stringify(t)),t);case"nat":case"mutez":if("int"in t&&td(t.int))return;throw new tf(e,"natural value expected: ".concat(JSON.stringify(t)),t);case"string":if("string"in t)return;throw new tf(e,"string value expected: ".concat(JSON.stringify(t)),t);case"bytes":case"bls12_381_g1":case"bls12_381_g2":if("bytes"in t&&null!==tm(t.bytes))return;throw new tf(e,"bytes value expected: ".concat(JSON.stringify(t)),t);case"bool":if("prim"in t&&("True"===t.prim||"False"===t.prim))return;throw new tf(e,"boolean value expected: ".concat(JSON.stringify(t)),t);case"key_hash":if("string"in t&&null!==tE(t.string,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash"))return;if("bytes"in t)try{!function(t){let e=tm(t.bytes);if(null===e)throw Error("can't parse bytes: \"".concat(t.bytes,'"'));t8(new t6(new Uint8Array(e)))}(t);return}catch(t){}throw new tf(e,"key hash expected: ".concat(JSON.stringify(t)),t);case"timestamp":if(("string"in t||"int"in t)&&null!==t_(t))return;throw new tf(e,"timestamp expected: ".concat(JSON.stringify(t)),t);case"address":if("string"in t){let e=t.string,r=t.string.indexOf("%");if(r>=0&&(e=t.string.slice(0,r)),null!==tE(e,"ED25519PublicKeyHash","SECP256K1PublicKeyHash","P256PublicKeyHash","ContractHash","RollupAddress"))return}else if("bytes"in t)try{!function(t){let e=tm(t.bytes);if(null===e)throw Error("can't parse bytes: \"".concat(t.bytes,'"'));t4(new t6(new Uint8Array(e)))}(t);return}catch(t){}throw new tf(e,"address expected: ".concat(JSON.stringify(t)),t);case"key":if("string"in t&&null!==tE(t.string,"ED25519PublicKey","SECP256K1PublicKey","P256PublicKey"))return;if("bytes"in t)try{!function(t){let e=tm(t.bytes);if(null===e)throw Error("can't parse bytes: \"".concat(t.bytes,'"'));t7(new t6(new Uint8Array(e)))}(t);return}catch(t){}throw new tf(e,"public key expected: ".concat(JSON.stringify(t)),t);case"unit":if("prim"in t&&"Unit"===t.prim)return;throw new tf(e,"unit value expected: ".concat(JSON.stringify(t)),t);case"signature":if("bytes"in t||"string"in t&&null!==tE(t.string,"ED25519Signature","SECP256K1Signature","P256Signature","GenericSignature"))return;throw new tf(e,"signature expected: ".concat(JSON.stringify(t)),t);case"chain_id":if(("bytes"in t||"string"in t)&&null!==("string"in t?ti(t.string):tm(t.bytes)))return;throw new tf(e,"chain id expected: ".concat(JSON.stringify(t)),t);case"option":if("prim"in t){if("None"===t.prim)return;if("Some"===t.prim){em(t.args[0],e.args[0],r);return}}throw new tf(e,"option expected: ".concat(JSON.stringify(t)),t);case"list":case"set":if(t1(t)){for(let i of t)em(i,e.args[0],r);return}throw new tf(e,"".concat(e.prim," expected: ").concat(JSON.stringify(t)),t);case"or":if("prim"in t){if("Left"===t.prim){em(t.args[0],e.args[0],r);return}if("Right"===t.prim){em(t.args[0],e.args[1],r);return}}throw new tf(e,"union (or) expected: ".concat(JSON.stringify(t)),t);case"lambda":if(function t(e){if(!Array.isArray(e))return!1;for(let r of e)if(!(Array.isArray(r)&&t(r)||"prim"in r&&t0(r)))return!1;return!0}(t)){let i=eh(t,[e.args[0]],r);if("failed"in i)throw new tf(e,"function is failed with error type: ".concat(i.failed),t);if(1!==i.length)throw new tf(e,"function must return a value",t);eu(e.args[1],i[0]);return}throw new tf(e,"function expected: ".concat(JSON.stringify(t)),t);case"map":case"big_map":if(Array.isArray(t)){for(let i of t){if(!("prim"in i)||"Elt"!==i.prim)throw new tf(e,"map elements expected: ".concat(JSON.stringify(t)),t);em(i.args[0],e.args[0],r),em(i.args[1],e.args[1],r)}return}throw new tf(e,"".concat(e.prim," expected: ").concat(JSON.stringify(t)),t);case"bls12_381_fr":if("int"in t&&th(t.int)||"bytes"in t&&null!==tm(t.bytes))return;throw new tf(e,"BLS12-381 element expected: ".concat(JSON.stringify(t)),t);case"sapling_state":if(Array.isArray(t))return;throw new tf(e,"sapling state expected: ".concat(JSON.stringify(t)),t);case"ticket":em(t,{prim:"pair",args:[{prim:"address"},e.args[0],{prim:"nat"}]},r);return;default:throw new tf(e,"type ".concat(el(e)," don't have Michelson literal representation"),t)}}function eh(t,e,r){let i=(null==r?void 0:r.protocol)||T;if(Array.isArray(t))return function(t,e,r){let i=e,n=e,a=0;for(let e of t){let t=eh(e,n,r);if(i=t,"failed"in t)break;n=t,a++}if("failed"in i&&0==i.level&&(!("prim"in i.failed)||"never"!==i.failed.prim)&&a!==t.length-1)throw new eo(t,i,"FAIL must appear in a tail position");if((null==r?void 0:r.traceCallback)!==void 0){let n={op:t,in:e,out:i};r.traceCallback(n)}return"failed"in i?{failed:i.failed,level:i.level+1}:i}(t,e,r);function n(r){for(var i=arguments.length,n=Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];if(e.length<n.length+r)throw new eo(t,e,"".concat(t.prim,": stack must have at least ").concat(n.length," element(s)"));let s=r;for(let r of n){if(null!==r&&0!==r.length){let i=0;for(;i<r.length&&r[i]!==el(e[s]);)i++;if(i===r.length)throw new eo(t,e,"".concat(t.prim,": stack type mismatch: [").concat(s,"] expected to be ").concat(r,", got ").concat(el(e[s])," instead"))}s++}return e.slice(r,n.length+r)}function a(r){return function(){for(var i=arguments.length,n=Array(i),a=0;a<i;a++)n[a]=arguments[a];try{return r(...n)}catch(r){if(r instanceof tu)throw new eo(t,e,r.message);throw r}}}function s(r){return i=>{try{return r(i)}catch(r){if(r instanceof tu)throw new eo(t,e,r.message);throw r}}}let c=a(tb),o=a(ef),l=a(eu),u=s(tB),f=s(tJ),g=s(tY),m=s(tj),h=s(tz);function d(r,i){let n=c(t,Object.assign(Object.assign({},i),{emptyFields:void 0!==r.f&&r.f>1,emptyVar:void 0!==r.v&&r.v>1})),a=(r,i,n)=>{if(r&&r.length>(i||0))throw new eo(t,e,"".concat(t.prim,": at most ").concat(i||0," ").concat(n," annotations allowed"))};return a(n.f,r.f,"field"),a(n.t,r.t,"type"),a(n.v,r.v,"variable"),n}function w(t,e){let r=Array.isArray(t)?{prim:"pair",args:t}:t,i=c(r),n=void 0!==e.v||void 0!==e.t||void 0!==e.f?[...(null===e.v?i.v:e.v)||[],...(null===e.t?i.t:e.t)||[],...(null===e.f?i.f:e.f)||[]]:void 0;return Object.assign(Object.assign({},function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&0>e.indexOf(i)&&(r[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)0>e.indexOf(i[n])&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}(r,["annots"])),n&&0!==n.length&&{annots:n})}function b(t,e){let r=d({v:1});return w(t,{v:void 0!==r.v?r.v:void 0!==e?[e]:null,t:null})}function y(r,i,n,a,s){var o,l,p,u;let f=null===(o=c(i).f)||void 0===o?void 0:o[0],g=null===(l=n.f)||void 0===l?void 0:l[a];if(void 0!==g&&"%"!==g&&void 0!==f&&g!==f)throw new eo(t,e,"".concat(t.prim,": field names doesn't match: ").concat(g," !== ").concat(f));let m=null===(p=n.v)||void 0===p?void 0:p[a],h=null===(u=c(r).v)||void 0===u?void 0:u[0];return w(i,{t:null,v:m?"@%"===m?f?["@"+f.slice(1)]:void 0:"@%%"===m?h?["@"+h.slice(1)+"."+(f?f.slice(1):s)]:f?["@"+f.slice(1)]:void 0:[m]:null})}let E=(t,e)=>["@"+(t.v?t.v[0].slice(1)+".":"")+e];function P(t,e){return"failed"in t||"failed"in e?"failed"in t?e:t:(o(t,e),t)}let A=(a=>{var s,A,v,T,_;switch(a.prim){case"DUP":{let t=a.args?parseInt(a.args[0].int,10):1;if(0===t)throw new eo(a,e,"DUP 0 is forbidden");let r=n(t-1,null)[0];if("ticket"===el(r))throw new eo(a,e,"ticket can't be DUPed");return[r,...e]}case"SWAP":{let t=n(0,null,null);return d({}),[t[1],t[0],...e.slice(2)]}case"SOME":return[w({prim:"option",args:[n(0,null)[0]]},d({t:1,v:1})),...e.slice(1)];case"UNIT":return[w({prim:"unit"},d({v:1,t:1})),...e];case"PAIR":{let t=a.args?parseInt(a.args[0].int,10):2;if(t<2)throw new eo(a,e,"PAIR ".concat(t," is forbidden"));let r=n(0,...Array(t).fill(null)),i=d({f:t,t:1,v:1},{specialFields:!0}),s=t=>{let e=t.lastIndexOf(".");return t.slice(e>0?e+1:1)},o=r.map((t,e)=>{var r;let n=c(t);return w(t,{v:null,t:null,f:i.f&&i.f.length>e&&"%"!==i.f[e]?"%@"===i.f[e]?n.v?["%"+s((null===(r=n.v)||void 0===r?void 0:r[0])||"")]:void 0:[i.f[e]]:void 0})});return[w({prim:"pair",args:o},{t:i.t,v:i.v}),...e.slice(t)]}case"UNPAIR":{let r=a.args?parseInt(a.args[0].int,10):2;if(r<2)throw new eo(a,e,"UNPAIR ".concat(r," is forbidden"));let i=n(0,["pair"])[0],s=d({f:2,v:2},{specialVar:!0});return[...(function r(i,n){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n,s=tA("pair",i);if(1===a)return[s.args[0]];if(2===a)return s.args;let c=s.args[1];if(tv(c))return[s.args[0],...r(c,n,a-1)];throw new eo(t,e,"".concat(t.prim,": at least ").concat(n," fields are expected"))})(i,r).map((t,e)=>y(i,t,s,e,0===e?"car":"cdr")),...e.slice(1)]}case"CAR":case"CDR":{let t=tA("pair",n(0,["pair"])[0]),r=t.args["CAR"===a.prim?0:1];return[y(t,r,d({f:1,v:1},{specialVar:!0}),0,a.prim.toLocaleLowerCase()),...e.slice(1)]}case"CONS":{let t=n(0,null,["list"]);return l(t[0],t[1].args[0]),[b({prim:"list",args:[t[1].args[0]]}),...e.slice(2)]}case"SIZE":return n(0,["string","list","set","map","bytes"]),[b({prim:"nat"}),...e.slice(1)];case"MEM":{let t=n(0,null,["set","map","big_map"]);return u(t[0]),l(t[0],t[1].args[0]),[b({prim:"bool"}),...e.slice(2)]}case"GET":if(a.args){let r=parseInt(a.args[0].int,10);return[b(function r(i,n){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n;if(0===a)return i;let s=tA("pair",i);if(1===a)return s.args[0];let c=s.args[1];if(tv(c))return r(c,n,a-2);if(2===a)return c;throw new eo(t,e,"".concat(t.prim,": at least ").concat(n+1," fields are expected"))}(n(0,["pair"])[0],r)),...e.slice(1)]}{let t=n(0,null,["map","big_map"]);return u(t[0]),l(t[0],t[1].args[0]),[b({prim:"option",args:[t[1].args[1]]}),...e.slice(2)]}case"UPDATE":if(a.args){let r=parseInt(a.args[0].int,10),i=n(0,null,["pair"]);return[b(function r(i,n,a){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a;if(0===s)return n;let c=tA("pair",i);if(1===s)return Object.assign(Object.assign({},c),{args:[n,c.args[1]]});let o=c.args[1];if(tv(o))return Object.assign(Object.assign({},c),{args:[c.args[0],r(o,n,a,s-2)]});if(2===s)return Object.assign(Object.assign({},c),{args:[c.args[0],n]});throw new eo(t,e,"".concat(t.prim,": at least ").concat(a+1," fields are expected"))}(i[1],i[0],r)),...e.slice(2)]}{let t=n(0,null,["bool","option"]);if(u(t[0]),"bool"===t[1].prim){let r=n(2,["set"]);return l(t[0],r[0].args[0]),[b({prim:"set",args:[w(t[0],{t:null})]}),...e.slice(3)]}let r=n(2,["map","big_map"]);if(l(t[0],r[0].args[0]),"map"===r[0].prim)return[b({prim:"map",args:[w(t[0],{t:null}),w(t[1].args[0],{t:null})]}),...e.slice(3)];return h(t[1].args[0]),[b({prim:"big_map",args:[w(t[0],{t:null}),w(t[1].args[0],{t:null})]}),...e.slice(3)]}case"GET_AND_UPDATE":{let t=d({v:2}),r=n(0,null,["option"],["map","big_map"]);u(r[0]),l(r[0],r[2].args[0]),l(r[1].args[0],r[2].args[1]);let i=null===(s=t.v)||void 0===s?void 0:s.map(t=>"@"!==t?[t]:void 0);if("map"===r[2].prim)return[w({prim:"option",args:[r[2].args[1]]},{v:null==i?void 0:i[0]}),w({prim:"map",args:[w(r[0],{t:null}),w(r[1].args[0],{t:null})]},{v:null==i?void 0:i[1]}),...e.slice(3)];return h(r[1].args[0]),[w({prim:"option",args:[r[2].args[1]]},{v:null==i?void 0:i[0]}),w({prim:"big_map",args:[w(r[0],{t:null}),w(r[1].args[0],{t:null})]},{v:null==i?void 0:i[1]}),...e.slice(3)]}case"EXEC":{let t=n(0,null,["lambda"]);return l(t[0],t[1].args[0]),[b(t[1].args[1]),...e.slice(2)]}case"APPLY":{let t=n(0,null,["lambda"]);if(g(t[0]),m(t[0]),!tv(t[1].args[0]))throw new eo(a,e,"".concat(a.prim,": function's argument must be a pair: ").concat(el(t[1].args[0])));let r=t[1].args[0];return l(t[0],ep(r)[0]),[b({prim:"lambda",args:[ep(r)[1],t[1].args[1]]}),...e.slice(2)]}case"FAILWITH":{let t=n(0,null)[0];return I(i,p.PtEdo2Zk)||f(t),{failed:t,level:0}}case"NEVER":return n(0,["never"]),{failed:{prim:"never"},level:0};case"RENAME":return[b(n(0,null)[0]),...e.slice(1)];case"CONCAT":{let t=n(0,["string","list","bytes"]);if("list"===t[0].prim){if("string"!==el(t[0].args[0])&&"bytes"!==el(t[0].args[0]))throw new eo(a,e,"".concat(a.prim,": can't concatenate list of ").concat(el(t[0].args[0]),"'s"));return[b(t[0].args[0]),...e.slice(1)]}let r=n(1,["string","bytes"]);if(t[0].prim!==r[0].prim)throw new eo(a,e,"".concat(a.prim,": can't concatenate ").concat(t[0].prim," with ").concat(r[0].prim));return[b(r[0]),...e.slice(2)]}case"SLICE":return[b({prim:"option",args:[n(0,["nat"],["nat"],["string","bytes"])[2]]},"@slice"),...e.slice(3)];case"PACK":return f(n(0,null)[0]),[b({prim:"bytes"},"@packed"),...e.slice(1)];case"ADD":{let t=n(0,["nat","int","timestamp","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"],["nat","int","timestamp","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"]);if("nat"===t[0].prim&&"int"===t[1].prim||"int"===t[0].prim&&"nat"===t[1].prim)return[b({prim:"int"}),...e.slice(2)];if("int"===t[0].prim&&"timestamp"===t[1].prim||"timestamp"===t[0].prim&&"int"===t[1].prim)return[b({prim:"timestamp"}),...e.slice(2)];if(("int"===t[0].prim||"nat"===t[0].prim||"mutez"===t[0].prim||"bls12_381_g1"===t[0].prim||"bls12_381_g2"===t[0].prim||"bls12_381_fr"===t[0].prim)&&t[0].prim===t[1].prim)return[b(t[0]),...e.slice(2)];throw new eo(a,e,"".concat(a.prim,": can't add ").concat(t[0].prim," to ").concat(t[1].prim))}case"SUB":{let t=I(i,p.PsiThaCa)?n(0,["nat","int","timestamp","mutez"],["nat","int","timestamp","mutez"]):n(0,["nat","int","timestamp"],["nat","int","timestamp"]);if(("nat"===t[0].prim||"int"===t[0].prim)&&("nat"===t[1].prim||"int"===t[1].prim)||"timestamp"===t[0].prim&&"timestamp"===t[1].prim)return[b({prim:"int"}),...e.slice(2)];if("timestamp"===t[0].prim&&"int"===t[1].prim)return[b({prim:"timestamp"}),...e.slice(2)];if("mutez"===t[0].prim&&"mutez"===t[1].prim)return[b({prim:"mutez"}),...e.slice(2)];throw new eo(a,e,"".concat(a.prim,": can't subtract ").concat(t[0].prim," from ").concat(t[1].prim))}case"SUB_MUTEZ":return n(0,["mutez"],["mutez"]),[b({prim:"option",args:[{prim:"mutez"}]}),...e.slice(2)];case"MUL":{let t=n(0,["nat","int","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"],["nat","int","mutez","bls12_381_g1","bls12_381_g2","bls12_381_fr"]);if("nat"===t[0].prim&&"int"===t[1].prim||"int"===t[0].prim&&"nat"===t[1].prim)return[b({prim:"int"}),...e.slice(2)];if("nat"===t[0].prim&&"mutez"===t[1].prim||"mutez"===t[0].prim&&"nat"===t[1].prim)return[b({prim:"mutez"}),...e.slice(2)];if(("bls12_381_g1"===t[0].prim||"bls12_381_g2"===t[0].prim||"bls12_381_fr"===t[0].prim)&&"bls12_381_fr"===t[1].prim||("nat"===t[0].prim||"int"===t[0].prim)&&t[0].prim===t[1].prim)return[b(t[0]),...e.slice(2)];if(("nat"===t[0].prim||"int"===t[0].prim)&&"bls12_381_fr"===t[1].prim||("nat"===t[1].prim||"int"===t[1].prim)&&"bls12_381_fr"===t[0].prim)return[b({prim:"bls12_381_fr"}),...e.slice(2)];throw new eo(a,e,"".concat(a.prim,": can't multiply ").concat(t[0].prim," by ").concat(t[1].prim))}case"EDIV":{let t=(t,e)=>({prim:"option",args:[{prim:"pair",args:[{prim:t},{prim:e}]}]}),r=n(0,["nat","int","mutez"],["nat","int","mutez"]);if("nat"===r[0].prim&&"nat"===r[1].prim)return[b(t("nat","nat")),...e.slice(2)];if(("nat"===r[0].prim||"int"===r[0].prim)&&("nat"===r[1].prim||"int"===r[1].prim))return[b(t("int","nat")),...e.slice(2)];if("mutez"===r[0].prim&&"nat"===r[1].prim)return[b(t("mutez","mutez")),...e.slice(2)];if("mutez"===r[0].prim&&"mutez"===r[1].prim)return[b(t("nat","mutez")),...e.slice(2)];throw new eo(a,e,"".concat(a.prim,": can't euclideally divide ").concat(r[0].prim," by ").concat(r[1].prim))}case"ABS":return n(0,["int"]),[b({prim:"nat"}),...e.slice(1)];case"ISNAT":return n(0,["int"]),[b({prim:"option",args:[{prim:"nat"}]}),...e.slice(1)];case"INT":return n(0,["nat","bls12_381_fr","bytes"]),[b({prim:"int"}),...e.slice(1)];case"BYTES":return n(0,["nat","int"]),[b({prim:"bytes"}),...e.slice(1)];case"NAT":return n(0,["bytes"]),[b({prim:"nat"}),...e.slice(1)];case"NEG":{let t=n(0,["nat","int","bls12_381_g1","bls12_381_g2","bls12_381_fr"])[0];if("nat"===t.prim||"int"===t.prim)return[b({prim:"int"}),...e.slice(1)];return[b(t),...e.slice(1)]}case"LSL":case"LSR":return n(0,["nat","bytes"],["nat","bytes"]),[b({prim:"nat"}),...e.slice(2)];case"OR":case"XOR":{let t=n(0,["nat","bytes","bool"],["nat","bytes","bool"]);if(t[0].prim!==t[1].prim)throw new eo(a,e,"".concat(a.prim,": both arguments must be of the same type: ").concat(t[0].prim,", ").concat(t[1].prim));return[b(t[1]),...e.slice(2)]}case"AND":{let t=n(0,["nat","bytes","bool","int"],["nat","bytes","bool"]);if(("int"!==t[0].prim||"nat"!==t[1].prim)&&t[0].prim!==t[1].prim)throw new eo(a,e,"".concat(a.prim,": both arguments must be of the same type: ").concat(t[0].prim,", ").concat(t[1].prim));return[b(t[1]),...e.slice(2)]}case"NOT":if("bool"===n(0,["nat","bytes","bool","int"])[0].prim)return[b({prim:"bool"}),...e.slice(1)];return[b({prim:"int"}),...e.slice(1)];case"COMPARE":{let t=n(0,null,null);return u(t[0]),u(t[1]),[b({prim:"int"}),...e.slice(2)]}case"EQ":case"NEQ":case"LT":case"GT":case"LE":case"GE":return n(0,["int"]),[b({prim:"bool"}),...e.slice(1)];case"SELF":{if((null==r?void 0:r.contract)===void 0)throw new eo(a,e,"".concat(a.prim,": contract required"));let t=d({f:1,v:1}),i=eb(r.contract,null===(A=t.f)||void 0===A?void 0:A[0]);if(null===i)throw new eo(a,e,"".concat(a.prim,": contract has no entrypoint ").concat(i));return[w({prim:"contract",args:[i]},{v:t.v?t.v:["@self"]}),...e]}case"TRANSFER_TOKENS":{let t=n(0,null,["mutez"],["contract"]);return l(t[0],t[2].args[0]),[b({prim:"operation"}),...e.slice(3)]}case"SET_DELEGATE":{let t=n(0,["option"])[0];if("key_hash"!==el(t.args[0]))throw new eo(a,e,"".concat(a.prim,": key hash expected: ").concat(el(t.args[0])));return[b({prim:"operation"}),...e.slice(1)]}case"IMPLICIT_ACCOUNT":return n(0,["key_hash"]),[b({prim:"contract",args:[{prim:"unit"}]}),...e.slice(1)];case"NOW":return[b({prim:"timestamp"},"@now"),...e];case"AMOUNT":return[b({prim:"mutez"},"@amount"),...e];case"BALANCE":return[b({prim:"mutez"},"@balance"),...e];case"CHECK_SIGNATURE":return n(0,["key"],["signature"],["bytes"]),[b({prim:"bool"}),...e.slice(3)];case"BLAKE2B":case"SHA256":case"SHA512":case"KECCAK":case"SHA3":return n(0,["bytes"]),[b({prim:"bytes"}),...e.slice(1)];case"HASH_KEY":return n(0,["key"]),[b({prim:"key_hash"}),...e.slice(1)];case"SOURCE":return[b({prim:"address"},"@source"),...e];case"SENDER":return[b({prim:"address"},"@sender"),...e];case"ADDRESS":{let t=n(0,["contract"])[0],r=d({v:1});return[w({prim:"address",[S]:t},{v:r.v?r.v:E(c(t),"address")}),...e.slice(1)]}case"SELF_ADDRESS":{let t={prim:"address"};return(null==r?void 0:r.contract)!==void 0&&(t[S]={prim:"contract",args:[ed(r.contract,"parameter").args[0]]}),[b(t,"@address"),...e]}case"CHAIN_ID":return[b({prim:"chain_id"}),...e];case"DROP":{d({});let t=void 0!==a.args?parseInt(a.args[0].int,10):1;return n(t-1,null),e.slice(t)}case"DIG":{d({});let t=parseInt(a.args[0].int,10);return[n(t,null)[0],...e.slice(0,t),...e.slice(t+1)]}case"DUG":{d({});let t=parseInt(a.args[0].int,10);return[...e.slice(1,t+1),n(0,null)[0],...e.slice(t+1)]}case"NONE":return eg(a.args[0]),[w({prim:"option",args:[a.args[0]]},d({t:1,v:1})),...e];case"LEFT":case"RIGHT":{let t=n(0,null)[0],r=d({f:2,t:1,v:1},{specialFields:!0}),i=c(t),s=[w(t,{t:null,v:null,f:r.f&&r.f.length>0&&"%"!==r.f[0]?"%@"===r.f[0]?i.v?["%"+i.v[0].slice(1)]:void 0:r.f:void 0}),w(a.args[0],{t:null,f:r.f&&r.f.length>1&&"%"!==r.f[1]?r.f:void 0})];return[w({prim:"or",args:"LEFT"===a.prim?s:[s[1],s[0]]},{t:r.t,v:r.v}),...e.slice(1)]}case"NIL":return eg(a.args[0]),[w({prim:"list",args:[a.args[0]]},d({t:1,v:1})),...e];case"UNPACK":return n(0,["bytes"]),eg(a.args[0]),[b({prim:"option",args:[a.args[0]]},"@unpacked"),...e.slice(1)];case"CONTRACT":{let t=n(0,["address"])[0];eg(a.args[0]);let r=d({v:1,f:1}),i=t[S];if(void 0!==i){let t=eb(i,null===(v=r.f)||void 0===v?void 0:v[0]);if(null===t)throw new eo(a,e,"".concat(a.prim,": contract has no entrypoint ").concat(t));l(t,a.args[0])}return[w({prim:"option",args:[{prim:"contract",args:[a.args[0]]}]},{v:r.v?r.v:E(c(t),"contract")}),...e.slice(1)]}case"CAST":{d({});let t=n(0,null)[0];return eg(a.args[0]),l(a.args[0],t),[a.args[0],...e.slice(1)]}case"IF_NONE":{d({});let t=n(0,["option"])[0],i=e.slice(1);return P(eh(a.args[0],i,r),eh(a.args[1],[w(t.args[0],{t:null,v:E(c(t),"some")}),...i],r))}case"IF_LEFT":{d({});let t=n(0,["or"])[0],i=c(t),s=c(t.args[0]),o=c(t.args[1]),l=e.slice(1);return P(eh(a.args[0],[w(t.args[0],{t:null,v:E(i,s.f?s.f[0].slice(1):"left")}),...l],r),eh(a.args[1],[w(t.args[1],{t:null,v:E(i,o.f?o.f[0].slice(1):"right")}),...l],r))}case"IF_CONS":{d({});let t=n(0,["list"])[0],i=c(t),s=e.slice(1);return P(eh(a.args[0],[w(t.args[0],{t:null,v:E(i,"hd")}),w(t,{t:null,v:E(i,"tl")}),...s],r),eh(a.args[1],s,r))}case"IF":{d({}),n(0,["bool"]);let t=e.slice(1);return P(eh(a.args[0],t,r),eh(a.args[1],t,r))}case"MAP":{let t=n(0,["list","map","option"])[0],i=e.slice(1),s="map"===t.prim?{prim:"pair",args:t.args}:t.args[0],l=eh(a.args[0],[w(s,{t:null,v:E(c(t),"elt")}),...i],r);if("failed"in l){if(!("prim"in l.failed)||"never"!==l.failed.prim)throw new eo(a,e,"".concat(a.prim,": FAIL is not allowed in MAP"));return{failed:l.failed,level:l.level+1}}if(l.length<1)throw new eo(a,e,"".concat(a.prim,": function must return a value"));return o(l.slice(1),i),"list"===t.prim?[b({prim:"list",args:[l[0]]}),...i]:"map"===t.prim?[b({prim:"map",args:[t.args[0],l[0]]}),...i]:[b({prim:"option",args:[l[0]]}),...i]}case"ITER":{d({});let t=n(0,["set","list","map"])[0],i=e.slice(1),s="map"===t.prim?{prim:"pair",args:t.args}:t.args[0],l=eh(a.args[0],[w(s,{t:null,v:E(c(t),"elt")}),...i],r);if("failed"in l)return{failed:l.failed,level:l.level+1};return o(l,i),i}case"LOOP":{d({}),n(0,["bool"]);let t=e.slice(1),i=eh(a.args[0],t,r);if("failed"in i)return{failed:i.failed,level:i.level+1};return o(i,[{prim:"bool"},...t]),t}case"LOOP_LEFT":{d({});let t=n(0,["or"])[0],i=e.slice(1),s=eh(a.args[0],[w(t.args[0],{t:null,v:E(c(t),"left")}),...i],r);if("failed"in s)return{failed:s.failed,level:s.level+1};return o(s,[t,...i]),[w(t.args[1],{t:null,v:d({v:1}).v}),...i]}case"DIP":{d({});let t=2===a.args.length?parseInt(a.args[0].int,10):1;n(t-1,null);let i=e.slice(0,t),s=e.slice(t),c=2===a.args.length?eh(a.args[1],s,r):eh(a.args[0],s,r);if("failed"in c)return{failed:c.failed,level:c.level+1};return[...i,...c]}case"CREATE_CONTRACT":{let t=d({v:2}),r=n(0,["option"],["mutez"],null);if("key_hash"!==el(r[0].args[0]))throw new eo(a,e,"".concat(a.prim,": key hash expected: ").concat(el(r[0].args[0])));g(r[2])&&(eE(a.args[0]),eu(ed(a.args[0],"storage").args[0],r[2]));let i=null===(T=t.v)||void 0===T?void 0:T.map(t=>"@"!==t?[t]:void 0);return[w({prim:"operation"},{v:null==i?void 0:i[0]}),w({prim:"address",[S]:{prim:"contract",args:[ed(a.args[0],"parameter").args[0]]}},{v:null==i?void 0:i[1]}),...e.slice(3)]}case"PUSH":return eg(a.args[0]),em(a.args[1],a.args[0],Object.assign(Object.assign({},r),{contract:void 0})),[b(a.args[0]),...e];case"EMPTY_SET":return eg(a.args[0]),u(a.args[0]),[w({prim:"set",args:a.args},d({t:1,v:1})),...e];case"EMPTY_MAP":return eg(a.args[0]),u(a.args[0]),eg(a.args[1]),[w({prim:"map",args:a.args},d({t:1,v:1})),...e];case"EMPTY_BIG_MAP":return eg(a.args[0]),u(a.args[0]),eg(a.args[1]),h(a.args[0]),[w({prim:"big_map",args:a.args},d({t:1,v:1})),...e];case"LAMBDA_REC":case"LAMBDA":{eg(a.args[0]),eg(a.args[1]);let t=[a.args[0]];"LAMBDA_REC"===a.prim&&t.push({prim:"lambda",args:[a.args[0],a.args[1]]});let i=eh(a.args[2],t,Object.assign(Object.assign({},r),{contract:void 0}));if("failed"in i)return{failed:i.failed,level:i.level+1};if(1!==i.length)throw new eo(a,e,"".concat(a.prim,": function must return a value"));return l(a.args[1],i[0]),[b({prim:"lambda",args:[a.args[0],a.args[1]]}),...e]}case"LEVEL":return[b({prim:"nat"},"@level"),...e];case"TOTAL_VOTING_POWER":case"MIN_BLOCK_TIME":return[b({prim:"nat"}),...e];case"VOTING_POWER":return n(0,["key_hash"]),[b({prim:"nat"}),...e.slice(1)];case"TICKET":{let t=n(0,null,["nat"])[0];if(u(t),I(i,p.PtLimaPtL))return[w({prim:"ticket",args:[t]},d({t:1,v:1})),...e.slice(2)];return[b({prim:"option",args:[w({prim:"ticket",args:[t]},d({t:1,v:1}))]}),...e.slice(2)]}case"JOIN_TICKETS":{let t=tA("pair",n(0,["pair"])[0]);if("ticket"!==el(t.args[0]))throw new eo(a,e,"".concat(a.prim,": ticket expected: ").concat(el(t.args[0])));return l(t.args[0],t.args[1]),[b({prim:"option",args:[w(t.args[0],{t:null})]}),...e.slice(1)]}case"SPLIT_TICKET":{let t=n(0,["ticket"],["pair"]),r=tA("pair",t[1]);if("nat"!==el(r.args[0]))throw new eo(a,e,"".concat(a.prim,": nat expected: ").concat(el(r.args[0])));return l(r.args[0],r.args[1]),[b({prim:"option",args:[{prim:"pair",args:[w(t[0],{t:null}),w(t[0],{t:null})]}]}),...e.slice(2)]}case"READ_TICKET":{let t=d({v:2}),r=n(0,["ticket"])[0],i=null===(_=t.v)||void 0===_?void 0:_.map(t=>"@"!==t?[t]:void 0);return[w({prim:"pair",args:[{prim:"address"},w(r.args[0],{t:null}),{prim:"nat"}]},{v:null==i?void 0:i[0]}),w(r,{v:null==i?void 0:i[1],t:null}),...e.slice(1)]}case"PAIRING_CHECK":{let t=n(0,["list"])[0].args[0];if(!tv(t))throw new eo(a,e,"".concat(a.prim,": pair expected: ").concat(el(t)));let r=tA("pair",t);if("bls12_381_g1"!==el(r.args[0]))throw new eo(a,e,"".concat(a.prim,": bls12_381_g1 expected: ").concat(el(r.args[0])));if("bls12_381_g2"!==el(r.args[1]))throw new eo(a,e,"".concat(a.prim,": bls12_381_g2 expected: ").concat(el(r.args[1])));return[b({prim:"bool"}),...e.slice(1)]}case"SAPLING_EMPTY_STATE":return[w({prim:"sapling_state",args:[a.args[0]]},d({v:1,t:1})),...e];case"SAPLING_VERIFY_UPDATE":{let t=n(0,["sapling_transaction"],["sapling_state"]);if(parseInt(t[0].args[0].int,10)!==parseInt(t[1].args[0].int,10))throw new eo(a,e,"".concat(a.prim,": sapling memo size mismatch: ").concat(t[0].args[0].int," != ").concat(t[1].args[0].int));return I(i,p.PtJakarta)?[b({prim:"option",args:[{prim:"pair",args:[{prim:"int"},w(t[1],{t:null})]}]}),...e.slice(2)]:[b({prim:"option",args:[{prim:"pair",args:[{prim:"bytes"},{prim:"pair",args:[{prim:"int"},w(t[1],{t:null})]}]}]}),...e.slice(2)]}case"OPEN_CHEST":return n(0,["chest_key"],["chest"],["nat"]),[b({prim:"or",args:[{prim:"bytes"},{prim:"bool"}]}),...e.slice(3)];case"VIEW":return m(n(0,null,["address"])[0]),[b({prim:"option",args:[a.args[1]]}),...e.slice(2)];case"EMIT":{let t=d({f:1,t:1});return a.args&&l(n(0,null)[0],a.args[0]),[w({prim:"operation"},t),...e.slice(1)]}default:throw new tu(a,"unexpected instruction: ".concat(a.prim))}})(t);return(null==r?void 0:r.traceCallback)!==void 0&&r.traceCallback({op:t,in:e,out:A}),A}function ed(t,e){for(let r of t)if(r.prim===e)return r;throw new tu(t,"missing contract section: ".concat(e))}function ew(t){if(Array.isArray(t)){for(let e of t)if("prim"in e&&("parameter"===e.prim||"storage"===e.prim||"code"===e.prim))return!0}return!1}function eb(t,e){e=e||"%default";let r=ey(t).find(t=>t[0]===e);return void 0!==r?r[1]:"%default"===e?ew(t)?ed(t,"parameter").args[0]:t:null}function ey(t){if(ew(t)){let e=ed(t,"parameter"),r=ey(e.args[0]),i=tb(e);return i.f?[[i.f[0],e.args[0]],...r]:r}if(Array.isArray(t)||"or"===t.prim){let e=ep(t),r=t=>{let r=tb(e[t]);if("or"===el(e[t])){let i=ey(e[t]);return r.f?[[r.f[0],e[t]],...i]:i}return r.f?[[r.f[0],e[t]]]:[]};return[...r(0),...r(1)]}return[]}function eE(t,e){let r=(r,i,n,a)=>{eg(r,!0),eg(i);let s=eh(a,[{prim:"pair",args:[Object.assign(Object.assign({},r),{annots:["@parameter"]}),Object.assign(Object.assign({},i),{annots:["@storage"]})]}],Object.assign(Object.assign({},e),{contract:t}));if("failed"in s)return s;try{ef(s,[n])}catch(t){if(t instanceof tu)throw new eo(a,s,t.message);throw t}return s},i=ed(t,"parameter").args[0],n=ed(t,"storage").args[0],a=r(i,n,{prim:"pair",args:[{prim:"list",args:[{prim:"operation"}]},n]},ed(t,"code").args[0]);for(let e of Object.values(function(t){let e={};for(let r of t)"view"===r.prim&&(e[r.args[0].string]=r);return e}(t)))r(e.args[1],n,e.args[2],e.args[3]);return a}function eP(t,e,r){eg(e),em(t,e,r||null)}class eA{static parse(t,e){let r=new q(e),i="string"==typeof t?r.parseScript(t):r.parseJSON(t);if(null===i)throw new tn("empty Michelson");if(t$(i))return new eA(i,e)}static parseTypeExpression(t,e){let r=new q(e),i="string"==typeof t?r.parseScript(t):r.parseJSON(t);if(null===i)throw new ta("empty type expression");if(tQ(i))return eg(i),i}static parseDataExpression(t,e){let r=new q(e),i="string"==typeof t?r.parseScript(t):r.parseJSON(t);if(null===i)throw new ts("empty data expression");if(tX(i))return i;throw void 0}section(t){return ed(this.contract,t)}entryPoints(){return ey(this.contract)}entryPoint(t){return eb(this.contract,t)}assertDataValid(t,e){eP(t,e,this.ctx)}isDataValid(t,e){return function(t,e,r){try{return eP(t,e,r),!0}catch(t){return!1}}(t,e,this.ctx)}assertParameterValid(t,e){let r=this.entryPoint(t||void 0);if(null===r)throw new tc(null==t?void 0:t.toString());this.assertDataValid(e,r)}isParameterValid(t,e){try{return this.assertParameterValid(t,e),!0}catch(t){return!1}}functionType(t,e){return function(t,e,r){for(let t of e)eg(t);if((null==r?void 0:r.contract)!==void 0)for(let t of["parameter","storage"])eg(ed(r.contract,t).args[0]);return eh(t,e,r||null)}(t,e,this.ctx)}constructor(t,e){this.contract=t,this.ctx=Object.assign({contract:t},e),this.output=eE(t,this.ctx)}}new eA([{prim:"parameter",args:[{prim:"unit"}]},{prim:"storage",args:[{prim:"unit"}]},{prim:"code",args:[[{prim:"CAR"},{prim:"NIL",args:[{prim:"operation"}]},{prim:"PAIR"}]]}])}}]);