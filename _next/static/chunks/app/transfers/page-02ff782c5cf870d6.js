(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[892],{62968:function(e,t,a){Promise.resolve().then(a.bind(a,79700))},79700:function(e,t,a){"use strict";let n;a.r(t),a.d(t,{default:function(){return h}});var r=a(3827),s=a(56842),l=a(64090);let i=e=>(!n||e.timestamp>=n)&&(n=e.timestamp,!0),d=(e,t)=>{switch(t.type){case"loaded":{let a=new Map(e);for(let e of t.payload){let t=s.P6.getInitialOperation(e);i(t),a.set(t.hash,e)}return a}case"added":{let a=s.P6.getInitialOperation(t.payload);i(a);let n=new Map(e);return n.set(a.hash,t.payload),n}case"updated":{let a=s.P6.getInitialOperation(t.payload);if(!e.has(a.hash))return e;let n=new Map(e);return n.set(a.hash,t.payload),n}case"added-or-updated":{let a=s.P6.getInitialOperation(t.payload);if(!i(a)&&!e.has(a.hash))return e;let n=new Map(e);return n.set(a.hash,t.payload),n}case"cleared":return n=void 0,new Map}},o=()=>{let[e,t]=(0,l.useReducer)(d,new Map),a=(0,l.useMemo)(()=>[...e.values()].sort((e,t)=>{let a=s.P6.getInitialOperation(e);return s.P6.getInitialOperation(t).timestamp.localeCompare(a.timestamp)}),[e]);return(0,l.useMemo)(()=>[a,t],[a])};var c=a(59074),u=a(24370),p=a(85021);function h(){let e=(0,p.bp)(),t=null==e?void 0:e.tokenBridge,{localTokenTransfers:a,dispatch:n}=(0,p.vU)(),[i,d]=o(),{address:h}=(0,p.Mw)(),{address:m}=(0,p.EP)(),[f,g]=(0,l.useState)(!0),w=(0,l.useRef)(0),y=(0,l.useRef)(i.length),k=(0,l.useCallback)(e=>{console.log("Token Transfer Created",s.P6.getInitialOperationHash(e),e.kind,e.status),d({type:"added",payload:e}),n({type:"deleted",payload:e})},[d,n]),v=(0,l.useCallback)(e=>{console.log("Token Transfer Updated",s.P6.getInitialOperationHash(e),e.kind,e.status),d({type:"added-or-updated",payload:e}),n({type:"deleted",payload:e})},[d,n]);(0,l.useEffect)(()=>{d({type:"loaded",payload:[...a.values()]})},[a,d]),(0,l.useEffect)(()=>{y.current=i.length-a.size},[i.length,a.size]),(0,l.useEffect)(()=>{y.current=0},[h,m]),(0,l.useEffect)(()=>{if(!t||!(h||m)){g(!1),d({type:"cleared"});return}let e=h&&m?[h,m]:h||m,a=async()=>{if(0!==w.current)return;g(!0),w.current=1;let a=await t.data.getAccountTokenTransfers(e,y.current,25);d({type:"loaded",payload:a}),g(!1),w.current=a.length?0:2},n=()=>{document.documentElement.scrollTop+document.documentElement.clientHeight>=document.documentElement.scrollHeight-5&&a()};return t.addEventListener("tokenTransferCreated",k),t.addEventListener("tokenTransferUpdated",v),a(),t.stream.subscribeToAccountTokenTransfers(e),window.addEventListener("scroll",n),()=>{t.removeEventListener("tokenTransferCreated",k),t.removeEventListener("tokenTransferUpdated",v),t.stream.unsubscribeFromAllSubscriptions(),d({type:"cleared"}),window.removeEventListener("scroll",n)}},[t,h,m,k,v,d]);let E=(0,l.useCallback)(async e=>{if(!t)return;let a=await t.finishWithdraw(e);await t.waitForStatus(a.tokenTransfer,s.hj.Finished)},[t]);return(0,r.jsx)("main",{className:"flex flex-col items-center md:mt-6",children:(0,r.jsxs)(r.Fragment,{children:[i.length?i.map(e=>(0,r.jsx)(c.Gv,{bridgeTokenTransfer:e,onFinishWithdrawing:E},s.P6.getInitialOperationHash(e))):!f&&(0,r.jsx)("span",{children:"No transfers"}),f&&(i.length?(0,r.jsx)(u.x,{className:"animate-spin h-5 w-5 mb-4 text-white"}):(0,r.jsxs)("div",{className:"flex items-center text-lg mt-10",children:[(0,r.jsx)(u.x,{className:"animate-spin h-5 w-5 mr-2 text-white"}),(0,r.jsx)("span",{children:"Loading transfers..."})]}))]})})}}},function(e){e.O(0,[283,663,579,212,544,74,971,69,744],function(){return e(e.s=62968)}),_N_E=e.O()}]);