(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[892],{62968:function(e,t,a){Promise.resolve().then(a.bind(a,79700))},79700:function(e,t,a){"use strict";let n;a.r(t),a.d(t,{default:function(){return h}});var r=a(3827),s=a(65185),l=a(64090);let i=e=>(!n||e.timestamp>=n)&&(n=e.timestamp,!0),d=(e,t)=>{switch(t.type){case"loaded":{let a=new Map(e);for(let e of t.payload){let t=s.P6.getInitialOperation(e),n=s.P6.getTokenTransferIdOrInitialOperationHash(e);i(t),a.has(t.hash)&&a.delete(t.hash),a.set(n,e)}return a}case"added":{let a=s.P6.getInitialOperation(t.payload),n=s.P6.getTokenTransferIdOrInitialOperationHash(t.payload);i(a);let r=new Map(e);return r.has(a.hash)&&r.delete(a.hash),r.set(n,t.payload),r}case"updated":{let a=s.P6.getInitialOperation(t.payload).hash,n=e.has(a),r=s.P6.getTokenTransferIdOrInitialOperationHash(t.payload);if(!n&&!e.has(r))return e;let l=new Map(e);return n&&l.delete(a),l.set(r,t.payload),l}case"added-or-updated":{let a=s.P6.getInitialOperation(t.payload),n=e.has(a.hash),r=s.P6.getTokenTransferIdOrInitialOperationHash(t.payload);if(!i(a)&&!n&&!e.has(r))return e;let l=new Map(e);return n&&l.delete(a.hash),l.set(r,t.payload),l}case"cleared":return n=void 0,new Map}},o=()=>{let[e,t]=(0,l.useReducer)(d,new Map),a=(0,l.useMemo)(()=>[...e.values()].sort((e,t)=>{let a=s.P6.getInitialOperation(e);return s.P6.getInitialOperation(t).timestamp.localeCompare(a.timestamp)}),[e]);return(0,l.useMemo)(()=>[a,t],[a])};var p=a(8377),c=a(24370),u=a(85021);function h(){let e=(0,u.bp)(),t=null==e?void 0:e.tokenBridge,{localTokenTransfers:a,dispatch:n}=(0,u.vU)(),[i,d]=o(),{address:h}=(0,u.Mw)(),{address:f}=(0,u.EP)(),[m,T]=(0,l.useState)(!0),g=(0,l.useRef)(0),y=(0,l.useRef)(i.length),k=(0,l.useCallback)(e=>{console.log("Token Transfer Created",s.P6.getTokenTransferIdOrInitialOperationHash(e),e.kind,e.status),d({type:"added",payload:e}),n({type:"deleted",payload:e})},[d,n]),w=(0,l.useCallback)(e=>{console.log("Token Transfer Updated",s.P6.getTokenTransferIdOrInitialOperationHash(e),e.kind,e.status),d({type:"added-or-updated",payload:e}),n({type:"deleted",payload:e})},[d,n]);(0,l.useEffect)(()=>{d({type:"loaded",payload:[...a.values()]})},[a,d]),(0,l.useEffect)(()=>{y.current=i.length-a.size},[i.length,a.size]),(0,l.useEffect)(()=>{y.current=0},[h,f]),(0,l.useEffect)(()=>{if(!t||!(h||f)){T(!1),d({type:"cleared"});return}let e=h&&f?[h,f]:h||f,a=async()=>{if(0!==g.current)return;T(!0),g.current=1;let a=await t.data.getAccountTokenTransfers(e,{offset:y.current,limit:25});for(let e of(d({type:"loaded",payload:a}),a))n({type:"deleted",payload:e});T(!1),g.current=a.length?0:2},r=()=>{document.documentElement.scrollTop+document.documentElement.clientHeight>=document.documentElement.scrollHeight-5&&a()};return t.addEventListener("tokenTransferCreated",k),t.addEventListener("tokenTransferUpdated",w),a(),t.stream.subscribeToAccountTokenTransfers(e),window.addEventListener("scroll",r),()=>{t.removeEventListener("tokenTransferCreated",k),t.removeEventListener("tokenTransferUpdated",w),t.stream.unsubscribeFromAllSubscriptions(),d({type:"cleared"}),window.removeEventListener("scroll",r)}},[t,h,f,k,w,d,n]);let O=(0,l.useCallback)(async e=>{if(!t)return;let a=await t.finishWithdraw(e);await t.waitForStatus(a.tokenTransfer,s.hj.Finished)},[t]);return(0,r.jsx)("main",{className:"flex flex-col items-center md:mt-6",children:(0,r.jsxs)(r.Fragment,{children:[i.length?i.map(e=>(0,r.jsx)(p.Gv,{bridgeTokenTransfer:e,onFinishWithdrawing:O},s.P6.getTokenTransferIdOrInitialOperationHash(e))):!m&&(0,r.jsx)("span",{children:"No transfers"}),m&&(i.length?(0,r.jsx)(c.x,{className:"animate-spin h-5 w-5 mb-4 text-white"}):(0,r.jsxs)("div",{className:"flex items-center text-lg mt-10",children:[(0,r.jsx)(c.x,{className:"animate-spin h-5 w-5 mr-2 text-white"}),(0,r.jsx)("span",{children:"Loading transfers..."})]}))]})})}}},function(e){e.O(0,[813,663,170,212,770,377,971,69,744],function(){return e(e.s=62968)}),_N_E=e.O()}]);