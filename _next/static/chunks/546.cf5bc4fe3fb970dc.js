(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[546],{46601:function(){},89214:function(){},69951:function(){},32652:function(e,t,r){"use strict";r.r(t),r.d(t,{App:function(){return m}});var s=r(1937),n=r(56842),i=r(27645),a=r(19497),o=r(31015),l=r(5446),d=r(95387),c=r(75410);class h{async sign(e,t){let r=await this.wallet.sign(e,t),s=(0,c.sA)(r,c.O4.edsig);return{sig:r,prefixSig:r,bytes:e,sbytes:e+(0,c.Cw)(s)}}publicKey(){return this.wallet.getPK()}publicKeyHash(){return this.wallet.getPKH()}secretKey(){throw Error("Method not implemented.")}constructor(e){this.wallet=e}}var p=r(73983);class k extends n.wy{async deposit(e,t,r,s){let n=await this.getTezosSignerAddress(),i="string"==typeof r?r:await this.getEtherlinkSignerAddress();if(!n)throw Error("The Tezos signer address is unavailable");if(!i)throw Error("The Etherlink receiver address is undefined");return{tokenTransfer:await this.options.bridgeDataProviders.transfers.deposit(e,t,n,i)}}async startWithdraw(e,t,r){let s=await this.getEtherlinkSignerAddress(),n="string"==typeof r?r:await this.getTezosSignerAddress();if(!s)throw Error("The Etherlink signer address is unavailable");if(!n)throw Error("The Tezos receiver address is undefined");return{tokenTransfer:await this.options.bridgeDataProviders.transfers.startWithdraw(e,t,s,n)}}async finishWithdraw(e){return this.options.bridgeDataProviders.transfers.finishWithdraw(e)}constructor(e){super(e),this.options=e}}class u{entries(){return this.store.entries}values(){return this.store.values()}keys(){return this.store.keys()}get(e){return this.store.get(e)}save(e){this.store.set(this.keyGetter(e),e),this.saveStore()}find(e){for(let[t,r]of this.store)if(e(r,t))return[t,r]}loadStore(){let e=new Map,t=localStorage.getItem(this.storeName+".data");if(t)try{let r=JSON.parse(t,this.deserializer);if(Array.isArray(r))for(let t of r)e.set(this.keyGetter(t),t)}catch(e){console.warn(e)}return e}saveStore(){let e=[];for(let t of this.store.values()){let r=JSON.stringify(t,this.serializer);e.push(r)}try{let t=JSON.stringify(e);localStorage.setItem(this.storeName+".data",t)}catch(e){}}constructor(e,t,r,s,n){this.storeName=e,this.keyGetter=t,this.deserializer=r,this.serializer=s,this.store=n||this.loadStore()}}var T=r(89521);let g=["tezosOperation","etherlinkOperation"],f=["amount","fee"];class v{async getTokenTransfer(e){let t=n.P6.convertTokenTransferIdToOperationData(e);return t?(await (0,T.Dc)(1e3),this.tokenTransfersStore.get(t[0])||null):null}async getTokenTransfers(e,t){return this.getTokenTransfersInternal(null,e,t)}async getAccountTokenTransfers(e,t,r){return this.getTokenTransfersInternal(e,t,r)}async getOperationTokenTransfers(e){let t="string"==typeof e?e:n.P6.getInitialOperation(e).hash;await (0,T.Dc)(1e3);let r=this.tokenTransfersStore.get(t);return r?[r]:[]}subscribeToTokenTransfer(e){}unsubscribeFromTokenTransfer(e){}subscribeToTokenTransfers(){}unsubscribeFromTokenTransfers(){}subscribeToAccountTokenTransfers(e){}unsubscribeFromAccountTokenTransfers(e){}subscribeToOperationTokenTransfers(e){}unsubscribeFromOperationTokenTransfers(e){}unsubscribeFromAllSubscriptions(){}async getBalance(e,t){return{address:e,token:t,balance:1000000n}}async getBalances(e,t,r){return{address:e,tokenBalances:("number"!=typeof t&&t?t:(await this.tokensProvider.getRegisteredTokenPairs()).flatMap(e=>[e.tezos,e.etherlink])).map(e=>({token:e,balance:1000000n}))}}async deposit(e,t,r,s){await (0,T.Dc)(1e3);let i={kind:n.gu.Deposit,status:n.hj.Pending,source:r,receiver:s,tezosOperation:{amount:e,token:t,hash:this.getTezosOperationHash(),timestamp:new Date().toLocaleString()}};return this.runDepositCycle(i),i}async startWithdraw(e,t,r,s){await (0,T.Dc)(1e3);let i={kind:n.gu.Withdrawal,status:n.hj.Pending,source:r,receiver:s,etherlinkOperation:{amount:e,token:t,hash:this.getEtherlinkOperationHash(),timestamp:this.getOperationTimestamp()}};return this.runWithdrawalCycle(i),i}async finishWithdraw(e){await (0,T.Dc)(3e3);let t=await this.tokensProvider.getRegisteredTokenPair(e.etherlinkOperation.token);this.updateTokenTransfer({...e,status:n.hj.Finished,tezosOperation:{blockId:0,hash:this.getTezosOperationHash(),counter:this.getTezosOperationCounter(),nonce:this.getTezosOperationNonce(),amount:e.etherlinkOperation.amount,token:t.tezos,timestamp:this.getOperationTimestamp()}})}async runDepositCycle(e){await (0,T.Dc)(1e4);let t=this.getTezosOperationCounter(),r=this.getTezosOperationNonce(),s=n.P6.convertOperationDataToTokenTransferId(e.tezosOperation.hash,t,r);this.updateTokenTransfer({...e,id:s,status:n.hj.Created,tezosOperation:{...e.tezosOperation,blockId:0,counter:t,nonce:r}}),await (0,T.Dc)(5e3);let i=await this.tokensProvider.getRegisteredTokenPair(e.tezosOperation.token);this.updateTokenTransfer({...e,id:s,status:n.hj.Finished,tezosOperation:{...e.tezosOperation,blockId:0,counter:t,nonce:r},etherlinkOperation:{blockId:0,hash:this.getEtherlinkOperationHash(),amount:e.tezosOperation.amount,token:i.etherlink,timestamp:this.getOperationTimestamp(),logIndex:this.getEtherlinkOperationLogIndex()}})}async runWithdrawalCycle(e){await (0,T.Dc)(3e3);let t=this.getEtherlinkOperationLogIndex(),r=n.P6.convertOperationDataToTokenTransferId(e.etherlinkOperation.hash,t),s={outboxMessageLevel:3006623,outboxMessageIndex:0,commitment:"src12...",proof:"0300..."},i={...e.etherlinkOperation,blockId:0,logIndex:t};this.updateTokenTransfer({...e,id:r,status:n.hj.Created,etherlinkOperation:i,rollupData:{outboxMessageLevel:s.outboxMessageLevel,outboxMessageIndex:s.outboxMessageIndex}}),await (0,T.Dc)(5e3),this.updateTokenTransfer({...e,id:r,status:n.hj.Sealed,etherlinkOperation:i,rollupData:s})}async getTokenTransfersInternal(e,t,r){t=t&&t>0?t:0,r=r&&r>0?r:this.defaultLoadDataLimit;let s=[];for(let t of this.tokenTransfersStore.values())(!e||("string"==typeof e?n.P6.isBridgeTokenTransferOwner(t,e):e.some(e=>n.P6.isBridgeTokenTransferOwner(t,e))))&&s.push(t);return s.sort((e,t)=>{let r=n.P6.getInitialOperation(e);return n.P6.getInitialOperation(t).timestamp.localeCompare(r.timestamp)}),s.slice(t,t+r),await (0,T.Dc)(1e3),s}updateTokenTransfer(e){this.tokenTransfersStore.save(e),this.events.tokenTransferUpdated.emit(e)}getTezosOperationHash(){return(0,c.kM)(this.generateBytesString(64),c.O4.o)}getTezosOperationCounter(){return Math.floor(1e5*Math.random())+1}getTezosOperationNonce(){let e=Math.floor(100*Math.random())+1;return e>70?null:e}getEtherlinkOperationHash(){return"0x".concat(this.generateBytesString(64))}getEtherlinkOperationLogIndex(){return Math.floor(100*Math.random())+1}getOperationTimestamp(){return new Date().toLocaleString()}generateBytesString(e){return[...Array(e)].map(()=>Math.floor(16*Math.random()).toString(16)).join("")}[Symbol.dispose](){}constructor(e){this.tokensProvider=e,this.defaultLoadDataLimit=100,this.tokenTransfersStore=new u("mock.transfers",e=>n.P6.getInitialOperation(e).hash,(e,t)=>{if(!e)return t;let r=JSON.parse(t);for(let e of g)if(r[e])for(let t of f)r[e][t]&&(r[e][t]=BigInt(r[e][t]));return r},(e,t)=>"bigint"==typeof t?t.toString(10):t),this.events={tokenTransferCreated:new n.vp,tokenTransferUpdated:new n.vp},window.bridgeDataProviderMock=this}}var w=r(6143);class m{createTokenBridgeMock(){let e=new n.xh(w.bX),t=new v(e);return new k({tezosBridgeBlockchainService:new n.ft({tezosToolkit:this.tezosToolkit,smartRollupAddress:p.v.bridge.smartRollupAddress}),etherlinkBridgeBlockchainService:new n.jC({web3:this.etherlinkToolkit}),bridgeDataProviders:{tokens:e,transfers:t,balances:t}})}createTokenBridge(){let e=new n.Pl({tokenPairs:w.bX,dipDup:{baseUrl:p.v.providers.dipDup.baseUrl,webSocketApiBaseUrl:p.v.providers.dipDup.webSocketApiBaseUrl},tzKTApiBaseUrl:p.v.providers.tzKT.baseUrl,etherlinkRpcUrl:p.v.etherlink.network.rpcUrl});return new n.wy({tezosBridgeBlockchainService:new n.ft({tezosToolkit:this.tezosToolkit,smartRollupAddress:p.v.bridge.smartRollupAddress}),etherlinkBridgeBlockchainService:new n.jC({web3:this.etherlinkToolkit}),bridgeDataProviders:{transfers:e,balances:e,tokens:e}})}constructor(){this.etherlinkToolkit=new d.ZPm(l.EthersStoreUtil.state.provider),this.web3Modal=(0,o.O)({ethersConfig:(0,o.u)({metadata:{name:p.v.app.name,description:p.v.app.description,url:p.v.app.url,icons:[]}}),chains:[{chainId:p.v.etherlink.network.chainId,name:p.v.etherlink.network.name,currency:p.v.etherlink.network.nativeCurrency.symbol,rpcUrl:p.v.etherlink.network.rpcUrl,explorerUrl:p.v.etherlink.network.blockExplorerUrl}],projectId:p.v.walletConnectProjectId,enableAnalytics:!1}),this.tezosToolkit=new a.$N(p.v.tezos.network.rpcUrl),this.beaconWallet=new i.kx({name:p.v.app.name,description:p.v.app.description,network:{type:s.td.CUSTOM,rpcUrl:p.v.tezos.network.rpcUrl},featuredWallets:["temple","atomex","metamask","trust"],colorMode:s.UX.DARK,walletConnectOptions:{projectId:p.v.walletConnectProjectId}}),this.tezosWalletSigner=new h(this.beaconWallet),this.tezosToolkit.setWalletProvider(this.beaconWallet),this.tezosToolkit.setSignerProvider(this.tezosWalletSigner),this.beaconTezosWallet=this.beaconWallet.client,n.xz.setLogLevel(n.in.Debug),this.tokenBridge=p.v.isMock?this.createTokenBridgeMock():this.createTokenBridge(),window.sdkLoggerProvider=n.xz,window.app=this}}},6143:function(e,t,r){"use strict";r.d(t,{uk:function(){return h},c3:function(){return l},OB:function(){return o},bX:function(){return a},TV:function(){return d}});var s={src:"/_next/static/media/ctez.76dc7655.png"},n={src:"/_next/static/media/fxhash.adc967f1.png"},i={src:"/_next/static/media/xtz.7960d41d.png"};let a=[{tezos:{type:"native",name:"Tezos",ticker:"XTZ",decimals:6,iconUrl:i.src,ticketHelperContractAddress:"KT1DWVsu4Jtu2ficZ1qtNheGPunm5YVniegT"},etherlink:{type:"native",name:"Tezos",ticker:"XTZ",decimals:18,iconUrl:i.src}},{tezos:{type:"fa1.2",name:"Ctez",ticker:"CTEZ",address:"KT1LpdETWYvPWCQTR2FEW6jE6dVqJqxYjdeW",decimals:0,iconUrl:s.src,ticketerContractAddress:"KT1RvSp4yDKUABqWmv3pKGE9fA6iCGy7bqGh",ticketHelperContractAddress:"KT1DHLWJorW9WB6ztkx1XcoaJKWXeTu9yoR1"},etherlink:{type:"erc20",name:"Ctez",ticker:"CTEZ",address:"0x87dcBf128677ba36E79D47dAf4eb4e51610e0150",decimals:0,iconUrl:s.src}},{tezos:{type:"fa2",name:"fxhash, token: 42",ticker:"FXHASH_42",address:"KT195Eb8T524v5VJ99ZzH2wpnPfQ2wJfMi6h",tokenId:"42",decimals:0,iconUrl:n.src,ticketerContractAddress:"KT1VybveLaWhpQHKph28WcGwSy1ud22KSEan",ticketHelperContractAddress:"KT1DNtHLr9T9zksZjZvQwgtx5XJwrW9wzETB"},etherlink:{type:"erc20",name:"fxhash, token: 42",ticker:"FXHASH_42",address:"0xcB5d40c6B1bdf5Cd51b3801351b0A68D101a561b",decimals:0,iconUrl:n.src}}],o=a[0].tezos,l=a[0].etherlink,d=a.reduce((e,t)=>(e.push(t.tezos),e.push(t.etherlink),e),[]),c={};for(let e of a)"native"===e.tezos.type?(c.native||(c.native={}),c.native.tezos=e.tezos):(c[e.tezos.type]||(c[e.tezos.type]={}),"fa1.2"===e.tezos.type?c[e.tezos.type][e.tezos.address]=e.tezos:(c[e.tezos.type][e.tezos.address]||(c[e.tezos.type][e.tezos.address]={}),c[e.tezos.type][e.tezos.address][e.tezos.tokenId]=e.tezos)),"native"===e.etherlink.type?(c.native||(c.native={}),c.native.etherlink=e.etherlink):(c[e.etherlink.type]||(c[e.etherlink.type]={}),"erc20"===e.etherlink.type&&(c[e.etherlink.type][e.etherlink.address]=e.etherlink));let h=(e,t)=>{var r,s,n,i,a;return"native"===e.type?t?null===(r=c[e.type])||void 0===r?void 0:r.tezos:null===(s=c[e.type])||void 0===s?void 0:s.etherlink:e.address?"fa1.2"===e.type||"erc20"===e.type?null===(n=c[e.type])||void 0===n?void 0:n[e.address]:"fa2"===e.type&&e.tokenId?null===(a=c[e.type])||void 0===a?void 0:null===(i=a[e.address])||void 0===i?void 0:i[e.tokenId]:void 0:void 0}}}]);